!function t(e,n,r){function i(s,a){if(!n[s]){if(!e[s]){var c="function"==typeof require&&require;if(!a&&c)return c(s,!0);if(o)return o(s,!0);var u=new Error("Cannot find module '"+s+"'");throw u.code="MODULE_NOT_FOUND",u}var h=n[s]={exports:{}};e[s][0].call(h.exports,function(t){var n=e[s][1][t];return i(n?n:t)},h,h.exports,t,e,n,r)}return n[s].exports}for(var o="function"==typeof require&&require,s=0;s<r.length;s++)i(r[s]);return i}({1:[function(t,e,n){},{}],2:[function(t,e,n){"use strict";function r(){r.super.apply(this,arguments)}var i=t("./Coordinate");r.Prototype=function(){this.isAnchor=function(){return!0}},i.extend(r),e.exports=r},{"./Coordinate":7}],3:[function(t,e,n){"use strict";function r(t){this.doc=t,this.byPath=new o.Arrays,this.byId={}}var i=t("lodash/filter"),o=t("../util/TreeIndex"),s=t("./DocumentIndex");r.Prototype=function(){this.select=function(t){return t._isContainerAnnotation},this.reset=function(t){this.byPath.clear(),this.byId={},this._initialize(t)},this.get=function(t,e){var n=this.byPath.getAll(t);return e?i(n,function(t){return t.containerId===e}):n.slice(0)},this.create=function(t){var e=t.getStartAnchor(),n=t.getEndAnchor();this.byPath.add(e.path,e),this.byPath.add(n.path,n),this.byId[t.id]=t},this.delete=function(t){var e=t.getStartAnchor(),n=t.getEndAnchor();this.byPath.remove(e.path,e),this.byPath.remove(n.path,n),delete this.byId[t.id]},this.update=function(t,e,n,r){if(this.select(t)){var i=null;if("startPath"===e[1])i=t.getStartAnchor();else{if("endPath"!==e[1])return;i=t.getEndAnchor()}this.byPath.remove(r,i),this.byPath.add(i.path,i)}}},s.extend(r),e.exports=r},{"../util/TreeIndex":336,"./DocumentIndex":11,"lodash/filter":201}],4:[function(t,e,n){"use strict";function r(){this.byPath=new c,this.byType=new c}var i=t("lodash/isString"),o=t("lodash/isNumber"),s=t("lodash/map"),a=t("lodash/filter"),c=t("../util/TreeIndex"),u=t("./DocumentIndex");r.Prototype=function(){this.property="path",this.select=function(t){return Boolean(t._isPropertyAnnotation)},this.reset=function(t){this.byPath.clear(),this.byType.clear(),this._initialize(t)},this.get=function(t,e,n,c){var h;return h=i(t)||1===t.length?this.byPath.getAll(t)||{}:this.byPath.get(t),h=s(h),o(e)&&(h=a(h,r.filterByRange(e,n))),c&&(h=a(h,u.filterByType(c))),h},this.create=function(t){this.byType.set([t.type,t.id],t),this.byPath.set(t.path.concat([t.id]),t)},this.delete=function(t){this.byType.delete([t.type,t.id]),this.byPath.delete(t.path.concat([t.id]))},this.update=function(t,e,n,r){this.select(t)&&e[1]===this.property&&(this.delete({id:t.id,type:t.type,path:r}),this.create(t))}},u.extend(r),r.filterByRange=function(t,e){return function(n){var r=n.startOffset,i=n.endOffset,s=i>=t;return o(e)&&(s=s&&r<=e),s}},e.exports=r},{"../util/TreeIndex":336,"./DocumentIndex":11,"lodash/filter":201,"lodash/isNumber":218,"lodash/isString":221,"lodash/map":227}],5:[function(t,e,n){"use strict";function r(){this.byId=new a}var i=t("lodash/isString"),o=t("lodash/map"),s=t("lodash/filter"),a=t("../util/TreeIndex"),c=t("./DocumentIndex");r.Prototype=function(){this.select=function(t){return Boolean(t._isContainerAnnotation)},this.reset=function(t){this.byId.clear(),this._initialize(t)},this.get=function(t,e){var n=o(this.byId.get(t));return i(e)&&(n=s(n,c.filterByType)),n},this.create=function(t){this.byId.set([t.containerId,t.id],t)},this.delete=function(t){this.byId.delete([t.containerId,t.id])},this.update=function(t,e,n,r){}},c.extend(r),e.exports=r},{"../util/TreeIndex":336,"./DocumentIndex":11,"lodash/filter":201,"lodash/isString":221,"lodash/map":227}],6:[function(t,e,n){"use strict";function r(t,e,n,r,o,a,h){if(s.call(this),this.containerId=t,this.startPath=e,this.startOffset=n,this.endPath=r,this.endOffset=o,this.reverse=Boolean(a),this.surfaceId=h,!(this.containerId&&this.startPath&&i(this.startOffset)&&this.endPath&&i(this.endOffset)))throw new Error("Invalid arguments: `containerId`, `startPath`, `startOffset`, `endPath`, and `endOffset` are mandatory");this._internal.start=new c(this,"startPath","startOffset"),this._internal.end=new c(this,"endPath","endOffset"),this._internal.range=new u(this)}var i=t("lodash/isNumber"),o=t("./Coordinate"),s=t("./Selection"),a=t("./PropertySelection"),c=a.CoordinateAdapter,u=a.RangeAdapter;r.Prototype=function(){function t(t,e,n){var i=new r(t.containerId,e.path,e.offset,n.path,n.offset,(!1),t.surfaceId),o=t._internal.doc;return o&&i.attach(o),i}this.toJSON=function(){return{type:"container",containerId:this.containerId,startPath:this.startPath,startOffset:this.startOffset,endPath:this.endPath,endOffset:this.endOffset,reverse:this.reverse,surfaceId:this.surfaceId}},this._isContainerSelection=!0,this.isContainerSelection=function(){return!0},this.getType=function(){return"container"},this.isNull=function(){return!1},this.isCollapsed=function(){return this.start.equals(this.end)},this.isReverse=function(){return this.reverse},this.equals=function(t){return s.prototype.equals.call(this,t)&&this.containerId===t.containerId&&this.start.equals(t.start)&&this.end.equals(t.end)},this.toString=function(){return"ContainerSelection("+JSON.stringify(this.startPath)+":"+this.startOffset+" -> "+JSON.stringify(this.endPath)+":"+this.endOffset+(this.reverse?", reverse":"")+")"},this.getContainer=function(){return this._internal.container||(this._internal.container=this.getDocument().get(this.containerId)),this._internal.container},this.isInsideOf=function(t,e){if(t.isNull())return!1;e=Boolean(e);var n=this._range(this),r=this._range(t);return r.start.isBefore(n.start,e)&&n.end.isBefore(r.end,e)},this.contains=function(t,e){if(t.isNull())return!1;e=Boolean(e);var n=this._range(this),r=this._range(t);return n.start.isBefore(r.start,e)&&r.end.isBefore(n.end,e)},this.containsNodeFragment=function(t,e){var n=this.getContainer(),r=new o([t],0),i=n.getAddress(r),s=this._range(this),a=s.start.isBefore(i,e);return a&&(i.offset=1,a=s.end.isAfter(i,e)),a},this.overlaps=function(t){var e=this._range(this),n=this._range(t);return!(e.end.isBefore(n.start,!1)||n.end.isBefore(e.start,!1))},this.isLeftAlignedWith=function(t){var e=this._range(this),n=this._range(t);return e.start.isEqual(n.start)},this.isRightAlignedWith=function(t){var e=this._range(this),n=this._range(t);return e.end.isEqual(n.end)},this.containsNode=function(t){var e=this.getContainer(),n=e.getPosition(this.startPath[0]),r=e.getPosition(this.endPath[0]),i=e.getPosition(t);return!(n>i||r<i||n===i&&1===this.startPath.length&&this.startOffset>0||r===i&&1===this.endPath.length&&this.endOffset<1)},this.collapse=function(e){var n;return n="left"===e?this.start:this.end,t(this,n,n)},this.expand=function(e){var n,r,i=this._range(this),s=this._range(e);return n=i.start.isEqual(s.start)?new o(this.start.path,Math.min(this.start.offset,e.start.offset)):i.start.isAfter(s.start)?new o(e.start.path,e.start.offset):this.start,r=i.end.isEqual(s.end)?new o(this.end.path,Math.max(this.end.offset,e.end.offset)):i.end.isBefore(s.end,!1)?new o(e.end.path,e.end.offset):this.end,t(this,n,r)},this.truncateWith=function(e){if(e.isInsideOf(this,"strict"))throw new Error("Can not truncate with a contained selections");if(!this.overlaps(e))return this;var n,r,i=this._range(this),o=this._range(e);if(o.start.isBefore(i.start,"strict")&&o.end.isBefore(i.end,"strict"))n=e.end,r=this.end;else if(i.start.isBefore(o.start,"strict")&&i.end.isBefore(o.end,"strict"))n=this.start,r=e.start;else if(i.start.isEqual(o.start)){if(!o.end.isBefore(i.end,"strict"))return s.nullSelection;n=e.end,r=this.end}else{if(!i.end.isEqual(o.end)){if(this.isInsideOf(e))return s.nullSelection;throw new Error("Could not determine coordinates for truncate. Check input")}if(!i.start.isBefore(o.start,"strict"))return s.nullSelection;n=this.start,r=e.start}return t(this,n,r)},this.getFragments=function(){if(this._internal.fragments)return this._internal.fragments;var t,e,n,r,i,o,a,c=[],u=this.getDocument(),h=this.getContainer(),l=h.getPosition(this.startPath[0]),f=h.getPosition(this.endPath[0]);if(l!==f){if(t=this.start,i=t.path,o=t.offset,n=i[0],e=u.get(n),!e)throw new Error("Node does not exist:"+n);t.isPropertyCoordinate()?(a=u.get(i),r=new s.Fragment(i,o,a.length,0===o),c.push(r)):t.isNodeCoordinate()&&0===o&&c.push(new s.NodeFragment(e.id));for(var d=l+1;d<f;d++)e=h.getChildAt(d),e.isText()?(i=[e.id,"content"],a=u.get(i),c.push(new s.Fragment(i,0,a.length,(!0)))):c.push(new s.NodeFragment(h.nodes[d]));if(t=this.end,i=t.path,o=t.offset,n=i[0],e=u.get(n),!e)throw new Error("Node does not exist:"+n);t.isPropertyCoordinate()?(a=u.get(i),r=new s.Fragment(i,0,o,o===a.length),c.push(r)):t.isNodeCoordinate()&&o>0&&c.push(new s.NodeFragment(e.id))}else{i=this.start.path,n=i[0],e=u.get(n);var p=this.start.isNodeCoordinate(),g=this.end.isNodeCoordinate();e.isText()?p&&g&&this.startOffset<this.endOffset?c.push(new s.NodeFragment(n)):!p&&g&&this.endOffset>0?(a=u.get(this.startPath),c.push(new s.Fragment(i,this.startOffset,a.length,0===this.startOffset))):p&&!g&&0===this.startOffset?(a=u.get(this.endPath),c.push(new s.Fragment(i,0,this.endOffset,this.endOffset===a.length))):p||g||(a=u.get(this.startPath),c.push(new s.Fragment(i,this.startOffset,this.endOffset,0===this.startOffset&&this.endOffset===a.length))):c.push(new s.NodeFragment(n))}return this._internal.fragments=c,c},this.splitIntoPropertySelections=function(){var t=[],e=this.getFragments();return e.forEach(function(e){e instanceof s.Fragment&&t.push(new a(e.path,e.startOffset,e.endOffset,(!1),this.containerId,this.surfaceId))}.bind(this)),t},this._clone=function(){return new r(this.containerId,this.startPath,this.startOffset,this.endPath,this.endOffset,this.reverse,this.surfaceId)},this._range=function(t){if(t._internal.addressRange)return t._internal.addressRange;var e,n=this.getContainer(),r=n.getAddress(t.start);e=t.isCollapsed()?r:n.getAddress(t.end);var i={start:r,end:e};return t._isContainerSelection&&(t._internal.addressRange=i),i}},s.extend(r),Object.defineProperties(r.prototype,{path:{get:function(){throw new Error("ContainerSelection has no path property. Use startPath and endPath instead")},set:function(){throw new Error("ContainerSelection has no path property. Use startPath and endPath instead.")}},start:{get:function(){return this._internal.start},set:function(){throw new Error("ContainerSelection.prototype.start is read-only.")}},end:{get:function(){return this._internal.end},set:function(){throw new Error("ContainerSelection.prototype.end is read-only.")}},range:{get:function(){return this._internal.range},set:function(){throw new Error("ContainerSelection.prototype.range is read-only.")}}}),r.fromJSON=function(t){var e=t.containerId,n=t.startPath,i=t.endPath||t.startPath,o=t.startOffset,s=t.endOffset,a=Boolean(t.reverse),c=t.surfaceId,u=new r(e,n,o,i,s,a,c);return u},e.exports=r},{"./Coordinate":7,"./PropertySelection":19,"./Selection":21,"lodash/isNumber":218}],7:[function(t,e,n){"use strict";function r(t,e,n){if(this.path=t,this.offset=e,this.after=n,!i(t))throw new Error("Invalid arguments: path should be an array.");if(!o(e)||e<0)throw new Error("Invalid arguments: offset must be a positive number.");Object.isFrozen(t)||Object.freeze(t)}var i=t("lodash/isArray"),o=t("lodash/isNumber"),s=t("lodash/isEqual"),a=t("../util/oo");r.Prototype=function(){this._isCoordinate=!0,this.equals=function(t){return t===this||s(t.path,this.path)&&t.offset===this.offset},this.withCharPos=function(t){return new r(this.path,t)},this.getNodeId=function(){return this.path[0]},this.getPath=function(){return this.path},this.getOffset=function(){return this.offset},this.toJSON=function(){return{path:this.path,offset:this.offset,after:this.after}},this.toString=function(){return"("+this.path.join(".")+", "+this.offset+")"},this.isPropertyCoordinate=function(){return this.path.length>1},this.isNodeCoordinate=function(){return 1===this.path.length}},a.initClass(r),e.exports=r},{"../util/oo":342,"lodash/isArray":209,"lodash/isEqual":214,"lodash/isNumber":218}],8:[function(t,e,n){"use strict";function r(t,e,n){s.call(this),this.customType=t,this.data=e,this.surfaceId=n}var i=t("lodash/cloneDeep"),o=t("lodash/isEqual"),s=t("./Selection");r.Prototype=function(){this.toString=function(){return"custom("+this.customType+", "+JSON.stringify(this.data)+")"},this.isCustomSelection=function(){return!0},this.getType=function(){return"custom"},this.getCustomType=function(){return this.customType},this.toJSON=function(){return{type:"custom",customType:this.customType,data:i(this.data),surfaceId:this.surfaceId}},this.equals=function(t){return s.prototype.equals.call(this,t)&&t.isCustomSelection()&&o(this.data,t.data)}},s.extend(r),r.fromJSON=function(t){return new r(t.customType,t.data||{},t.surfaceId)},e.exports=r},{"./Selection":21,"lodash/cloneDeep":197,"lodash/isEqual":214}],9:[function(t,e,n){"use strict";function r(t){if(r.super.apply(this),this.__id__=O++,!t)throw new Error("A document needs a schema for reflection.");this.schema=t,this.nodeFactory=new y(this),this.data=new v(t,{nodeFactory:this.nodeFactory}),this.addIndex("type",l.create({property:"type"})),this.addIndex("annotations",new f),this.addIndex("container-annotations",new d),this.addIndex("container-annotation-anchors",new p),this.eventProxies={path:new m(this)},this.on("document:changed",this._updateEventProxies,this)}var i=t("lodash/isEqual"),o=t("lodash/isObject"),s=t("lodash/isArray"),a=t("lodash/isString"),c=t("lodash/each"),u=t("../util/uuid"),h=t("../util/EventEmitter"),l=t("./DocumentIndex"),f=t("./AnnotationIndex"),d=t("./ContainerAnnotationIndex"),p=t("./AnchorIndex"),g=t("./DocumentChange"),m=t("./PathEventProxy"),v=t("./data/IncrementalData"),y=t("./DocumentNodeFactory"),_=t("./Selection"),x=t("./Coordinate"),w=t("./Range"),b=t("./documentHelpers"),C=t("./JSONConverter"),E=new C,O=0;r.Prototype=function(){function e(){var e,r,c,u,h,l=t("./PropertySelection"),f=t("./ContainerSelection"),d=t("./NodeSelection"),p=this;if(1===arguments.length&&null===arguments[0])return _.nullSelection;if(arguments[0]instanceof x)return e=arguments[0],e.isNodeCoordinate()?d._createFromCoordinate(e):new l(e.path,e.offset,e.offset);if(arguments[0]instanceof w){r=arguments[0];var g=i(r.start.path,r.end.path);return g?r.start.isNodeCoordinate()?d._createFromRange(r):new l(r.start.path,r.start.offset,r.end.offset,r.reverse,r.containerId):new f(r.containerId,r.start.path,r.start.offset,r.end.path,r.end.offset,r.reverse)}return 1===arguments.length&&o(arguments[0])?n(p,arguments[0]):2===arguments.length&&s(arguments[0])?(c=arguments[0],u=arguments[1],new l(c,u,u)):3===arguments.length&&s(arguments[0])?(c=arguments[0],u=arguments[1],h=arguments[2],new l(c,u,h,u>h)):5===arguments.length&&a(arguments[0])?n(p,{type:"container",containerId:arguments[0],startPath:arguments[1],startOffset:arguments[2],endPath:arguments[3],endOffset:arguments[4]}):(console.error("Illegal arguments for Selection.create().",arguments),_.nullSelection)}function n(e,n){var i,o=t("./PropertySelection"),s=t("./ContainerSelection"),a=t("./NodeSelection"),c=t("./CustomSelection");if("property"===n.type)return null!==n.endOffset&&void 0!==n.endOffset||(n.endOffset=n.startOffset),n.hasOwnProperty("reverse")||(n.startOffset>n.endOffset?(i=n.startOffset,n.startOffset=n.endOffset,n.endOffset=i,n.reverse=!0):n.reverse=!1),new o(n.path,n.startOffset,n.endOffset,n.reverse,n.containerId,n.surfaceId);if("container"===n.type){var u=e.get(n.containerId,"strict"),h=new x(n.startPath,n.startOffset),l=new x(n.endPath,n.endOffset),f=u.getAddress(h),d=u.getAddress(l),p=n.reverse;if(!f)throw new Error("Invalid arguments for ContainerSelection: ",h.toString());if(!d)throw new Error("Invalid arguments for ContainerSelection: ",l.toString());return n.hasOwnProperty("reverse")||(p=d.isBefore(f,"strict"),p&&(i=h,h=l,l=i)),r(e,h,!0),r(e,l,!1),new s(u.id,h.path,h.offset,l.path,l.offset,p,n.surfaceId)}if("node"===n.type)return a.fromJSON(n);if("custom"===n.type)return c.fromJSON(n);throw new Error("Illegal selection type",n)}function r(t,e,n){if(!e.isNodeCoordinate()){var r=e.getNodeId(),i=t.get(r);i.isText()||(console.warn("Selecting a non-textish node partially is not supported. Select the full node."),e.path=[r],e.offset=n?0:1)}}this._isDocument=!0,this.addIndex=function(t,e){return this.data.addIndex(t,e)},this.getIndex=function(t){return this.data.getIndex(t)},this.getNodes=function(){return this.data.nodes},this.getSchema=function(){return this.schema},this.contains=function(t){this.data.contains(t)},this.get=function(t,e){return this.data.get(t,e)},this.getNodes=function(){return this.data.getNodes()},this.import=function(t){try{this.data._stopIndexing(),t(this),this.data._startIndexing()}finally{this.data.queue=[],this.data._startIndexing()}},this.create=function(t){t.id||(t.id=u(t.type));var e=this._create(t),n=new g([e],{},{});return n._extractInformation(this),this._notifyChangeListeners(n),this.data.get(t.id)},this.delete=function(t){var e=this.get(t),n=this._delete(t),r=new g([n],{},{});return r._extractInformation(this),this._notifyChangeListeners(r),e},this.set=function(t,e){var n=this.get(t),r=this._set(t,e),i=new g([r],{},{});return i._extractInformation(this),this._notifyChangeListeners(i),n},this.update=function(t,e){var n=this._update(t,e),r=new g([n],{},{});return r._extractInformation(this),this._notifyChangeListeners(r),n},this.addIndex=function(t,e){return this.data.addIndex(t,e)},this.getIndex=function(t){return this.data.getIndex(t)},this.createSelection=function(){var t=e.apply(this,arguments);return t.isNull()||t.attach(this),t},this.getEventProxy=function(t){return this.eventProxies[t]},this.newInstance=function(){var t=this.constructor;return new t(this.schema)},this.fromSnapshot=function(t){var e=this.newInstance();return e.loadSeed(t),e},this.getDocumentMeta=function(){return this.get("document")},this._apply=function(t){c(t.ops,function(t){this.data.apply(t),this.emit("operation:applied",t)}.bind(this)),t._extractInformation(this)},this._notifyChangeListeners=function(t,e){e=e||{},this.emit("document:changed",t,e,this)},this._updateEventProxies=function(t,e){c(this.eventProxies,function(n){n.onDocumentChanged(t,e,this)}.bind(this))},this.loadSeed=function(t){c(this.data.nodes,function(t){this.delete(t.id)}.bind(this)),c(t.nodes,function(t){this.create(t)}.bind(this))},this.toJSON=function(){return E.exportDocument(this)},this.getTextForSelection=function(t){return console.warn("DEPRECATED: use docHelpers.getTextForSelection() instead."),b.getTextForSelection(this,t)},this.setText=function(t,e,n){var r,i=this.getIndex("annotations").get(t);for(r=0;r<i.length;r++)this.delete(i[r].id);for(this.set(t,e),r=0;r<n.length;r++)this.create(n[r])},this._create=function(t){var e=this.data.create(t);return e},this._delete=function(t){var e=this.data.delete(t);return e},this._update=function(t,e){var n=this.data.update(t,e);return n},this._set=function(t,e){var n=this.data.set(t,e);return n}},h.extend(r),e.exports=r},{"../util/EventEmitter":335,"../util/uuid":344,"./AnchorIndex":3,"./AnnotationIndex":4,"./ContainerAnnotationIndex":5,"./ContainerSelection":6,"./Coordinate":7,"./CustomSelection":8,"./DocumentChange":10,"./DocumentIndex":11,"./DocumentNodeFactory":13,"./JSONConverter":15,"./NodeSelection":16,"./PathEventProxy":17,"./PropertySelection":19,"./Range":20,"./Selection":21,"./data/IncrementalData":29,"./documentHelpers":37,"lodash/each":198,"lodash/isArray":209,"lodash/isEqual":214,"lodash/isObject":219,"lodash/isString":221}],10:[function(t,e,n){"use strict";function r(t,e,n){if(1===arguments.length&&u(arguments[0])){var r=arguments[0];this.sha=r.sha,this.timestamp=r.timestamp,this.before=r.before,this.ops=r.ops,this.info=r.info,this.after=r.after}else{if(3!==arguments.length)throw new Error("Illegal arguments.");this.sha=m(),this.info={},this.timestamp=Date.now(),this.ops=t.slice(0),this.before=e,this.after=n}this.updated=null,this.created=null,this.deleted=null}function i(t,e){for(var n=0;n<t.ops.length;n++)for(var r=t.ops[n],i=0;i<e.ops.length;i++){var o=e.ops[i];y.transform(r,o,{inplace:!0})}t.before&&s(t.before.selection,e),t.after&&s(t.after.selection,e),e.before&&s(e.before.selection,t),e.after&&s(e.after.selection,t)}function o(t,e){h(t)||(t=[t]),h(e)||(e=[e]);for(var n=0;n<t.length;n++)for(var r=t[n],o=0;o<e.length;o++){var s=e[o];i(r,s)}}function s(t,e){if(!t||!t.isPropertySelection()&&!t.isContainerSelection())return!1;for(var n=e.ops,r=!1,i=t.isCollapsed(),o=0;o<n.length;o++){var s=n[o];r|=a(t.start,s),i?(t.isContainerSelection()&&(t.endPath=t.startPath),t.endOffset=t.startOffset):r|=a(t.end,s)}return r}function a(t,e){if(!c(e.path,t.path))return!1;var n=!1;if("update"===e.type&&"string"===e.propertyType){var r,i=e.diff;i.isInsert()&&i.pos<=t.offset?(r=t.offset+i.str.length,t.offset=r,n=!0):i.isDelete()&&i.pos<=t.offset&&(r=Math.max(i.pos,t.offset-i.str.length),t.offset=r,n=!0)}return n}var c=t("lodash/isEqual"),u=t("lodash/isObject"),h=t("lodash/isArray"),l=t("lodash/map"),f=t("lodash/forEach"),d=t("lodash/clone"),p=t("lodash/cloneDeep"),g=t("../util/oo"),m=t("../util/uuid"),v=t("./data/OperationSerializer"),y=t("./data/ObjectOperation"),_=t("./Selection");r.Prototype=function(){this._extractInformation=function(t){function e(e){var n,r,a=e.val;switch(e.type){case"create":case"delete":a.hasOwnProperty("startOffset")&&(n=a.path||a.startPath,o[n]=!0),a.hasOwnProperty("endPath")&&(n=a.endPath,o[n]=!0);break;case"update":case"set":a=t.get(e.path[0]),a&&(r=e.path[1],a.isPropertyAnnotation()?"path"!==r&&"startOffset"!==r&&"endOffset"!==r||i[a.path[0]]||(o[a.path]=!0):a.isContainerAnnotation()&&("startPath"!==r&&"startOffset"!==r&&"endPath"!==r&&"endOffset"!==r||s.push(a)));break;default:throw new Error("Illegal state")}}for(var n=this.ops,r={},i={},o={},s=[],a=0;a<n.length;a++){var c=n[a];"create"===c.type&&(r[c.val.id]=c.val,delete i[c.val.id]),"delete"===c.type&&(delete r[c.val.id],i[c.val.id]=c.val),"set"!==c.type&&"update"!==c.type||(o[c.path]=!0),e(c)}s.forEach(function(e){for(var n=t.get(e.containerId,"strict"),r=n.getPosition(e.startPath[0]),s=n.getPosition(e.endPath[0]),a=r;a<=s;a++){var c,u=n.getChildAt(a);c=u.isText()?[u.id,"content"]:[u.id],i[u.id]||(o[c]=!0)}}),Object.keys(i).length>0&&f(o,function(t,e){var n=e.split(",")[0];i[n]&&delete o[e]}),this.created=r,this.deleted=i,this.updated=o},this.invert=function(){var t=this.toJSON();t.ops=[];var e=t.before;t.before=t.after,t.after=e;for(var n=r.fromJSON(t),i=[],o=this.ops.length-1;o>=0;o--)i.push(this.ops[o].invert());return n.ops=i,n},this.isAffected=function(t){return this.updated[t]},this.isUpdated=this.isAffected,this.serialize=function(){var t=new v,e=this.toJSON();return e.ops=this.ops.map(function(e){return t.serialize(e)}),JSON.stringify(e)},this.clone=function(){return r.fromJSON(this.toJSON())},this.toJSON=function(){var t={sha:this.sha,before:d(this.before),ops:l(this.ops,function(t){return t.toJSON()}),info:this.info,after:d(this.after)};t.after.selection=void 0,t.before.selection=void 0;var e=this.before.selection;return e&&e._isSelection&&(t.before.selection=e.toJSON()),e=this.after.selection,e&&e._isSelection&&(t.after.selection=e.toJSON()),t}},g.initClass(r),r.deserialize=function(t){var e=new v,n=JSON.parse(t);return n.ops=n.ops.map(function(t){return e.deserialize(t)}),n.before.selection&&(n.before.selection=_.fromJSON(n.before.selection)),n.after.selection&&(n.after.selection=_.fromJSON(n.after.selection)),new r(n)},r.fromJSON=function(t){var e=p(t);return e.ops=t.ops.map(function(t){return y.fromJSON(t)}),e.before.selection=_.fromJSON(t.before.selection),e.after.selection=_.fromJSON(t.after.selection),new r(e)},r.transformInplace=function(t,e){o(t,e)},r.transformSelection=function(t,e){var n=t.clone(),r=s(n,e);return r?n:t},e.exports=r},{"../util/oo":342,"../util/uuid":344,"./Selection":21,"./data/ObjectOperation":33,"./data/OperationSerializer":35,"lodash/clone":196,"lodash/cloneDeep":197,"lodash/forEach":204,"lodash/isArray":209,"lodash/isEqual":214,"lodash/isObject":219,"lodash/map":227}],11:[function(t,e,n){"use strict";function r(){}var i=t("./data/NodeIndex");i.extend(r),r.filterByType=i.filterByType,e.exports=i},{"./data/NodeIndex":32}],12:[function(t,e,n){"use strict";function r(t,e){if(o.call(this,e),!t)throw new Error("Document instance is mandatory.");this.document=t}var i=t("lodash/each"),o=t("./data/Node");r.Prototype=function(){function t(t){return/([a-zA-Z_0-9]+):changed/.exec(t)}this._isDocumentNode=!0;var e=r.super.prototype;this.getDocument=function(){return this.document},this.hasParent=function(){return Boolean(this.parent)},this.getParent=function(){return this.document.get(this.parent)},this.hasChildren=function(){return!1},this.getChildIndex=function(t){return-1},this.getChildAt=function(t){return null},this.getChildCount=function(){return 0},this.getRoot=function(){for(var t=this;t.hasParent();)t=t.getParent();return t},this.getAddressablePropertyNames=function(){var t=this.constructor.static.addressablePropertyNames;return t||[]},this.hasAddressableProperties=function(){return this.getAddressablePropertyNames().length>0},this.getPropertyNameAt=function(t){var e=this.constructor.static.addressablePropertyNames||[];return e[t]},this.setHighlighted=function(t,e){this.highlighted!==t&&(this.highlightedScope=e,this.highlighted=t,this.emit("highlighted",t))},this.on=function(n,r,i){var o=t(n);if(o){var s=o[1];if(this.constructor.static.schema[s]){var a=this.getDocument();a.getEventProxy("path").on([this.id,s],r,i)}}e.on.apply(this,arguments)},this.off=function(n,r,i){var o=this.getDocument(),s=!1;if(r?s=t(r):o.getEventProxy("path").off(n),s){var a=s[1];o.getEventProxy("path").off(n,[this.id,a],i)}e.off.apply(this,arguments)},this.connect=function(t,e){console.warn("DEPRECATED: use Node.on() instead"),i(e,function(e,n){this.on(n,e,t)}.bind(this))},this.disconnect=function(t){console.warn("DEPRECATED: use Node.off() instead"),this.off(t)},this._onPropertyChange=function(t){var e=[t+":changed"].concat(Array.prototype.slice.call(arguments,1));this.emit.apply(this,e)},this.isBlock=function(){return this.constructor.static.isBlock},this.isText=function(){return this.constructor.static.isText},this.isPropertyAnnotation=function(){return this.constructor.static.isPropertyAnnotation},this.isInline=function(){return this.constructor.static.isInline},this.isContainerAnnotation=function(){return this.constructor.static.isContainerAnnotation}},o.extend(r),r.static.name="node",r.static.isBlock=!1,r.static.isText=!1,r.static.isPropertyAnnotation=!1,r.static.isContainerAnnotation=!1,r.static.isInline=!1,e.exports=r},{"./data/Node":30,"lodash/each":198}],13:[function(t,e,n){"use strict";function r(t){this.doc=t}var i=t("../util/oo");r.Prototype=function(){this.create=function(t,e){var n=this.doc.schema.getNodeClass(t);if(!n)throw new Error("No node registered by that name: "+t);return new n(this.doc,e)}},i.initClass(r),e.exports=r},{"../util/oo":342}],14:[function(t,e,n){"use strict";function r(t){o(this,t)}var i=t("../util/oo"),o=t("lodash/extend"),s=t("lodash/each"),a=t("lodash/isString"),c=1,u=-1,h=-2;r.Prototype=function(){function t(t){var i=[],o=[];s(t,function(t){var e=!!t.isAnchor&&t.isAnchor();if(e)i.push({mode:h,pos:t.offset,id:t.id,level:r.ALWAYS_ON_TOP,type:"anchor",node:t,counter:-1,length:0});else{var n=r.NORMAL,s=!!t.isInline&&t.isInline();s?n=Number.MAX_VALUE:t.constructor.static&&t.constructor.static.hasOwnProperty("fragmentation")?n=t.constructor.static.fragmentation:t.hasOwnProperty("fragmentationHint")&&(n=t.fragmentationHint);var a=Math.min(t.startOffset,t.endOffset),l=Math.max(t.startOffset,t.endOffset),f={pos:a,mode:c,level:n,id:t.id,type:t.type,node:t,length:0,counter:-1};i.push(f),o.push({pos:l,mode:u,level:n,id:t.id,type:t.type,node:t,opener:f})}}),i.sort(e);for(var a=i.length-1;a>=0;a--)i[a].idx=a;o.sort(n);for(var l=new Array(i.length+o.length),f=0,d=0,p=0,g=i[d],m=o[p];g||m;)g&&m?m.pos<=g.pos&&m.opener!==g?(l[f]=m,p++):(l[f]=g,d++):g?(l[f]=g,d++):m&&(l[f]=m,p++),g=i[d],m=o[p],f++;return l}function e(t,e){if(t.pos<e.pos)return-1;if(t.pos>e.pos)return 1;if(t.mode<e.mode)return-1;if(t.mode>e.mode)return 1;if(t.mode===e.mode){if(t.level<e.level)return-1;if(t.level>e.level)return 1}return 0}function n(t,e){return t.pos<e.pos?-1:t.pos>e.pos?1:t.pos===t.opener.pos&&e.pos===e.opener.pos?t.opener.idx<e.opener.idx?-1:1:t.opener.idx>e.opener.idx?-1:t.opener.idx<e.opener.idx?1:0}this.start=function(t,e,n){if(!a(e))throw new Error("Illegal argument: 'text' must be a String, but was "+e);this._start(t,e,n)},this.onText=function(t,e,n){},this.onEnter=function(t,e){return null},this.onExit=function(t,e,n){},this._enter=function(t,e){return t.counter++,this.onEnter(t,e)},this._exit=function(t,e,n){this.onExit(t,e,n)},this._createText=function(t,e,n){this.onText(t,e,n)},this._start=function(e,n,r){for(var i=t.call(this,r),o=[{context:e,entry:null}],s=0,a=0;a<i.length;a++){var l=i[a],f=n.substring(s,l.pos);f&&this._createText(o[o.length-1].context,f,l),s=l.pos;var d,p,g;if(l.mode===c||l.mode===h){for(d=1;d<o.length&&!(l.level<o[d].entry.level);d++);for(p=o.length-1;p>=d;p--)g=o[p].entry,g.length=s-g.pos,this._exit(g,o[p].context,o[p-1].context);for(o.splice(d,0,{entry:l}),p=d;p<o.length;p++)g=o[p].entry,g.pos=s,o[p].context=this._enter(g,o[p-1].context)}if(l.mode===u||l.mode===h){for(d=1;d<o.length&&o[d].entry.node!==l.node;d++);for(p=o.length-1;p>=d;p--)g=o[p].entry,g.length=s-g.pos,this._exit(g,o[p].context,o[p-1].context);for(o.splice(d,1),p=d;p<o.length;p++)g=o[p].entry,g.pos=s,o[p].context=this._enter(g,o[p-1].context)}}var m=n.substring(s);m&&this._createText(e,m)}},i.initClass(r),r.SHOULD_NOT_SPLIT=0,r.NORMAL=10,r.ANY=100,r.ALWAYS_ON_TOP=Number.MAX_VALUE,e.exports=r},{"../util/oo":342,"lodash/each":198,"lodash/extend":200,"lodash/isString":221}],15:[function(t,e,n){"use strict";function r(){}var i=t("lodash/isArray"),o=t("lodash/each"),s=t("../util/oo");r.Prototype=function(){this.importDocument=function(t,e){if(!e.schema||!i(e.nodes))throw new Error("Invalid JSON format.");var n=t.getSchema();if(n.name!==e.schema.name)throw new Error("Incompatible schema.");n.version!==e.schema.version&&console.error("Different schema version. Conversion might be problematic.");var r=e.nodes;return t.import(function(t){o(r,function(e){t.get(e.id)&&t.delete(e.id),t.create(e)})}),t},this.exportDocument=function(t){var e=t.getSchema(),n={schema:{name:e.name,version:e.version},nodes:[]};return o(t.getNodes(),function(t){t._isDocumentNode&&n.nodes.push(t.toJSON())}),n}},s.initClass(r),e.exports=r},{"../util/oo":342,"lodash/each":198,"lodash/isArray":209}],16:[function(t,e,n){"use strict";function r(t,e,n,r,s){if(o.call(this),!i(t))throw new Error("'containerId' is mandatory.");if(!i(e))throw new Error("'nodeId' is mandatory.");if(["full","before","after"].indexOf(n)<0)throw new Error("'mode' is mandatory.");this.containerId=t,this.nodeId=e,this.mode=n,this.reverse=Boolean(r),this.surfaceId=s}var i=t("lodash/isString"),o=t("./Selection"),s=t("./Coordinate");r.Prototype=function(){this._isNodeSelection=!0;var t=r.super.prototype;this.equals=function(e){return t.call(this,e)&&this.nodeId===e.nodeId&&this.mode===e.mode},this.isNodeSelection=function(){return!0},this.getType=function(){return"node"},this.getNodeId=function(){return this.nodeId},this.isFull=function(){return"full"===this.mode},this.isBefore=function(){return"before"===this.mode},this.isAfter=function(){return"after"===this.mode},this.isCollapsed=function(){return"full"!==this.mode},this.toJSON=function(){return{containerId:this.containerId,nodeId:this.nodeId,mode:this.mode,reverse:this.reverse,surfaceId:this.surfaceId}},this.collapse=function(t){if("left"===t)return this.isBefore()?this:new r(this.containerId,this.nodeId,"before",this.reverse,this.surfaceId);if("right"===t)return this.isAfter()?this:new r(this.containerId,this.nodeId,"after",this.reverse,this.surfaceId);throw new Error("'direction' must be either 'left' or 'right'");
},this._getCoordinate=function(){return"before"===this.mode?new s([this.nodeId],0):"after"===this.mode?new s([this.nodeId],1):void 0}},o.extend(r),r.fromJSON=function(t){return new r(t.containerId,t.nodeId,t.mode,t.reverse)},r._createFromRange=function(t){var e,n=t.containerId,i=t.start.getNodeId(),o=t.start.offset,s=t.end.offset,a=t.reverse;return e=o===s?0===o?"before":"after":"full",new r(n,i,e,a)},r._createFromCoordinate=function(t){var e=t.containerId,n=t.getNodeId(),i=0===t.offset?"before":"after";return new r(e,n,i,(!1))},e.exports=r},{"./Coordinate":7,"./Selection":21,"lodash/isString":221}],17:[function(t,e,n){"use strict";function r(t){this.listeners=new c.Arrays,this._list=[],this.doc=t}var i=t("lodash/forEach"),o=t("lodash/isEqual"),s=t("lodash/isArray"),a=t("../util/oo"),c=t("../util/TreeIndex");r.Prototype=function(){this.on=function(t,e,n){this._add(n,t,e)},this.off=function(t,e,n){this._remove(t,e,n)},this.connect=function(t,e,n){console.warn("DEPRECATED: use proxy.on(path, this.onPropertyChange, this) instead"),this.on(e,n,t)},this.disconnect=function(t){console.warn("DEPRECATED: use proxy.off(this) instead"),this.off(t)},this.onDocumentChanged=function(t,e,n){if(0!==this._list.length){var r=this.listeners;i(t.updated,function(o,a){var c=r.get(a.split(","));s(c)&&(c=c.slice(0)),i(c,function(r){r.method.call(r.listener,t,e,n)})})}},this._add=function(t,e,n){if(!n)throw new Error("Invalid argument: expected function but got "+n);var r={listener:t,path:e,method:n};this.listeners.add(e,r),this._list.push(r)},this._remove=function(t,e,n){for(var r=0;r<this._list.length;r++){var i=this._list[r],s=(!e||o(i.path,e))&&(!t||i.listener===t)&&(!n||i.method!==n);if(s){var a=this._list[r];this._list.splice(r,1),this.listeners.remove(a.path,a)}}}},a.initClass(r),e.exports=r},{"../util/TreeIndex":336,"../util/oo":342,"lodash/forEach":204,"lodash/isArray":209,"lodash/isEqual":214}],18:[function(t,e,n){"use strict";function r(){r.super.apply(this,arguments)}var i=t("lodash/isEqual"),o=t("./DocumentNode");r.Prototype=function(){this._isAnnotation=!0,this._isPropertyAnnotation=!0,this.getText=function(){var t=this.getDocument();if(!t)return console.warn("Trying to use an PropertyAnnotation which is not attached to the document."),"";var e=t.get(this.path);return e.substring(this.startOffset,this.endOffset)},this.canSplit=function(){return!0},this.isAnchor=function(){return!1},this.getSelection=function(){return this.getDocument().createSelection({type:"property",path:this.path,startOffset:this.startOffset,endOffset:this.endOffset})},this.updateRange=function(t,e){if(!e.isPropertySelection())throw new Error("Cannot change to ContainerAnnotation.");i(this.startPath,e.start.path)||t.set([this.id,"path"],e.start.path),this.startOffset!==e.start.offset&&t.set([this.id,"startOffset"],e.start.offset),this.endOffset!==e.end.offset&&t.set([this.id,"endOffset"],e.end.offset)}},o.extend(r),r.static.name="annotation",r.static.defineSchema({path:["string"],startOffset:"number",endOffset:"number"}),r.static.isPropertyAnnotation=!0,Object.defineProperties(r.prototype,{startPath:{get:function(){return this.path}},endPath:{get:function(){return this.path}}}),e.exports=r},{"./DocumentNode":12,"lodash/isEqual":214}],19:[function(t,e,n){"use strict";function r(t,e,n,r,s,u){if(c.call(this),this.path=t,this.startOffset=e,this.endOffset=n,this.reverse=Boolean(r),this.containerId=s,this.surfaceId=u,!t||!a(e))throw new Error("Invalid arguments: `path` and `startOffset` are mandatory");this._internal.start=new i(this,"path","startOffset"),this._internal.end=new i(this,"path","endOffset"),this._internal.range=new o(this)}function i(t,e,n){this._sel=t,this._pathProp=e,this._offsetProp=n,Object.freeze(this)}function o(t){this._sel=t,this.start=t.start,this.end=t.end,Object.freeze(this)}var s=t("lodash/isEqual"),a=t("lodash/isNumber"),c=t("./Selection"),u=t("./Coordinate"),h=t("./Range");r.Prototype=function(){this.toJSON=function(){return{type:"property",path:this.path,startOffset:this.startOffset,endOffset:this.endOffset,reverse:this.reverse,containerId:this.containerId,surfaceId:this.surfaceId}},this.isPropertySelection=function(){return!0},this.getType=function(){return"property"},this.isNull=function(){return!1},this.isCollapsed=function(){return this.startOffset===this.endOffset},this.isReverse=function(){return this.reverse},this.equals=function(t){return c.prototype.equals.call(this,t)&&this.start.equals(t.start)&&this.end.equals(t.end)},this.toString=function(){return["PropertySelection(",JSON.stringify(this.path),", ",this.startOffset," -> ",this.endOffset,this.reverse?", reverse":"",")"].join("")},this.collapse=function(t){var e;return e="left"===t?this.startOffset:this.endOffset,this.createWithNewRange(e,e)},this.getRange=function(){return this.range},this.getPath=function(){return this.path},this.getNodeId=function(){return this.path[0]},this.getStartOffset=function(){return this.startOffset},this.getEndOffset=function(){return this.endOffset},this.isInsideOf=function(t,e){return!t.isNull()&&(t.isContainerSelection()?t.contains(this,e):e?s(this.path,t.path)&&this.startOffset>t.startOffset&&this.endOffset<t.endOffset:s(this.path,t.path)&&this.startOffset>=t.startOffset&&this.endOffset<=t.endOffset)},this.contains=function(t,e){return!t.isNull()&&t.isInsideOf(this,e)},this.overlaps=function(t,e){return!t.isNull()&&(t.isContainerSelection()?t.overlaps(this):!!s(this.path,t.path)&&(e?!(this.startOffset>=t.endOffset||this.endOffset<=t.startOffset):!(this.startOffset>t.endOffset||this.endOffset<t.startOffset)))},this.isRightAlignedWith=function(t){return!t.isNull()&&(t.isContainerSelection()?t.isRightAlignedWith(this):s(this.path,t.path)&&this.endOffset===t.endOffset)},this.isLeftAlignedWith=function(t){return!t.isNull()&&(t.isContainerSelection()?t.isLeftAlignedWith(this):s(this.path,t.path)&&this.startOffset===t.startOffset)},this.expand=function(t){if(t.isNull())return this;if(t.isContainerSelection())return t.expand(this);if(!s(this.path,t.path))throw new Error("Can not expand PropertySelection to a different property.");var e=Math.min(this.startOffset,t.startOffset),n=Math.max(this.endOffset,t.endOffset);return this.createWithNewRange(e,n)},this.truncateWith=function(t){if(t.isNull())return this;if(t.isInsideOf(this,"strict"))throw new Error("Can not truncate with a contained selections");if(!this.overlaps(t))return this;var e,n;if(t.isPropertySelection())e=t.startOffset,n=t.endOffset;else{if(!t.isContainerSelection())return this;e=s(t.startPath,this.path)?t.startOffset:this.startOffset,n=s(t.endPath,this.path)?t.endOffset:this.endOffset}var r,i;if(this.startOffset>e&&this.endOffset>n)r=n,i=this.endOffset;else if(this.startOffset<e&&this.endOffset<n)r=this.startOffset,i=e;else if(this.startOffset===e){if(this.endOffset<=n)return c.nullSelection;r=n,i=this.endOffset}else{if(this.endOffset!==n){if(t.contains(this))return c.nullSelection;throw new Error("Illegal state.")}if(this.startOffset>=e)return c.nullSelection;r=this.startOffset,i=e}return this.createWithNewRange(r,i)},this.createWithNewRange=function(t,e){var n=new r(this.path,t,e,(!1),this.containerId,this.surfaceId),i=this._internal.doc;return i&&n.attach(i),n},this.getFragments=function(){if(this._internal.fragments)return this._internal.fragments;var t;return t=this.isCollapsed()?[new c.Cursor(this.path,this.startOffset)]:[new c.Fragment(this.path,this.startOffset,this.endOffset)],this._internal.fragments=t,t},this._clone=function(){return new r(this.path,this.startOffset,this.endOffset,this.reverse,this.containerId,this.surfaceId)}},c.extend(r),Object.defineProperties(r.prototype,{start:{get:function(){return this._internal.start},set:function(){throw new Error("PropertySelection.prototype.start is read-only.")},enumerable:!1},end:{get:function(){return this._internal.end},set:function(){throw new Error("PropertySelection.prototype.end is read-only.")},enumerable:!1},range:{get:function(){return this._internal.range},set:function(){throw new Error("PropertySelection.prototype.range is read-only.")},enumerable:!1},startPath:{get:function(){return this.path},set:function(){throw new Error("immutable.")},enumerable:!1},endPath:{get:function(){return this.path},set:function(){throw new Error("immutable.")},enumerable:!1}}),r.fromJSON=function(t){var e=t.path,n=t.startOffset,i=t.hasOwnProperty("endOffset")?t.endOffset:t.startOffset,o=t.reverse,s=t.containerId,a=t.surfaceId;return new r(e,n,i,o,s,a)},u.extend(i),Object.defineProperties(i.prototype,{path:{get:function(){return this._sel[this._pathProp]},set:function(t){this._sel[this._pathProp]=t}},offset:{get:function(){return this._sel[this._offsetProp]},set:function(t){this._sel[this._offsetProp]=t}}}),r.CoordinateAdapter=i,h.extend(o),Object.defineProperties(o.prototype,{reverse:{get:function(){return this._sel.reverse},set:function(t){this._sel.reverse=t}},containerId:{get:function(){return this._sel.containerId},set:function(t){this._sel.containerId=t}},surfaceId:{get:function(){return this._sel.surfaceId},set:function(t){this._sel.surfaceId=t}}}),r.RangeAdapter=o,e.exports=r},{"./Coordinate":7,"./Range":20,"./Selection":21,"lodash/isEqual":214,"lodash/isNumber":218}],20:[function(t,e,n){"use strict";function r(t,e,n,r){this.start=t,this.end=e,this.reverse=Boolean(n),this.containerId=r}var i=t("../util/oo");r.Prototype=function(){this._isRange=!0,this.isCollapsed=function(){return this.start.equals(this.end)},this.equals=function(t){return this===t||this.containerId===t.containerId&&this.start.equals(t.start)&&this.end.equals(t.end)},this.isReverse=function(){return this.reverse},this.toString=function(){var t=[this.start.toString(),"->",this.end.toString()];return this.isReverse()&&t.push("(reverse)"),t.join("")}},i.initClass(r),e.exports=r},{"../util/oo":342}],21:[function(t,e,n){"use strict";function r(){var t={};Object.defineProperty(this,"_internal",{enumerable:!1,value:t}),t.doc=null}var i=t("../util/oo"),o=t("../util/EventEmitter"),s=t("./Anchor");r.Prototype=function(){this._isSelection=!0,this.clone=function(){var t=this._clone();return this._internal.doc&&t.attach(this._internal.doc),t},this.getDocument=function(){var t=this._internal.doc;if(!t)throw new Error("Selection is not attached to a document.");return t},this.isAttached=function(){return Boolean(this._internal.doc)},this.attach=function(t){return this._internal.doc=t,this},this.isNull=function(){return!1},this.isPropertySelection=function(){return!1},this.isContainerSelection=function(){return!1},this.isNodeSelection=function(){return!1},this.isCustomSelection=function(){return!1},this.isCollapsed=function(){return!0},this.isReverse=function(){return!1},this.getType=function(){throw new Error("Selection.getType() is abstract.")},this.equals=function(t){return this===t||!!t&&(this.isNull()===t.isNull()&&this.getType()===t.getType())},this.toString=function(){return"null"},this.toJSON=function(){throw new Error("This method is abstract.")},this.getFragments=function(){return[]}},i.initClass(r),r.NullSelection=function(){r.call(this)},r.NullSelection.Prototype=function(){this.isNull=function(){return!0},this.getType=function(){return"null"},this.toJSON=function(){return null},this.clone=function(){return this}},r.extend(r.NullSelection),r.nullSelection=Object.freeze(new r.NullSelection),r.fromJSON=function(e){if(!e)return r.nullSelection;var n=e.type;switch(n){case"property":var i=t("./PropertySelection");return i.fromJSON(e);case"container":var o=t("./ContainerSelection");return o.fromJSON(e);case"node":var s=t("./NodeSelection");return s.fromJSON(e);case"custom":var a=t("./CustomSelection");return a.fromJSON(e);default:return r.nullSelection}},r.create=function(){throw new Error("Selection.create() has been removed as it is not possible to create selections consistently without looking into the document.")},r.Fragment=function(t,e,n,r){o.call(this),this.type="selection-fragment",this.path=t,this.startOffset=e,this.endOffset=n||e,this.full=Boolean(r)},r.Fragment.Prototype=function(){this.isAnchor=function(){return!1},this.isInline=function(){return!1},this.isPropertyFragment=function(){return!0},this.isNodeFragment=function(){return!1},this.isFull=function(){return this.full},this.isPartial=function(){return!this.full},this.getNodeId=function(){return this.path[0]}},o.extend(r.Fragment),r.NodeFragment=function(t){o.call(this),this.type="node-fragment",this.nodeId=t,this.path=[t]},r.NodeFragment.Prototype=function(){this.isAnchor=function(){return!1},this.isInline=function(){return!1},this.isPropertyFragment=function(){return!1},this.isNodeFragment=function(){return!0},this.isFull=function(){return!0},this.isPartial=function(){return!1},this.getNodeId=function(){return this.nodeId}},o.extend(r.NodeFragment),r.Cursor=function(t,e){s.call(this,t,e),this.type="cursor"},r.Cursor.Prototype=function(){this.isPropertyFragment=function(){return!1},this.isNodeFragment=function(){return!1}},s.extend(r.Cursor),e.exports=r},{"../util/EventEmitter":335,"../util/oo":342,"./Anchor":2,"./ContainerSelection":6,"./CustomSelection":8,"./NodeSelection":16,"./PropertySelection":19}],22:[function(t,e,n){"use strict";function r(){i.apply(this,arguments)}var i=t("./TextNode");i.extend(r),r.static.isBlock=!0,e.exports=r},{"./TextNode":23}],23:[function(t,e,n){"use strict";function r(){r.super.apply(this,arguments)}var i=t("./DocumentNode");r.Prototype=function(){this.getTextPath=function(){return[this.id,"content"]},this.getText=function(){return this.content},this.isEmpty=function(){return!this.content}},i.extend(r),r.static.name="text",r.static.isText=!0,r.static.defineSchema({content:"text"}),e.exports=r},{"./DocumentNode":12}],24:[function(t,e,n){"use strict";var r=t("lodash/each"),i=t("lodash/uniq"),o=t("../util/uuid"),s=function(t,e,n){if(n){var i=t.getIndex("annotations"),o=i.get(e.path);r(o,function(r){var i=e.offset,o=r.startOffset,s=r.endOffset,a=o,c=s;(i<o||i===o)&&(a+=n),(i<s||i===s&&!r.isInline())&&(c+=n),a!==o&&t.set([r.id,"startOffset"],a),c!==s&&t.set([r.id,"endOffset"],c)}),i=t.getIndex("container-annotation-anchors");var s=i.get(e.path);r(s,function(r){var i=e.offset,o=r.offset,s=!1;if((i<o||i===o&&!e.after)&&(o+=n,s=!0),s){var a=r.isStart?"startOffset":"endOffset";t.set([r.id,a],o)}})}},a=function(t,e,n,o){if(n!==o){var s=t.getIndex("annotations"),a=s.get(e),c=o-n;r(a,function(e){var r=n,i=o,s=e.startOffset,a=e.endOffset,u=s,h=a;i<=s?(u-=c,h-=c,t.set([e.id,"startOffset"],u),t.set([e.id,"endOffset"],h)):(r<=s&&(u=s-Math.min(i-r,s-r)),r<=a&&(h=a-Math.min(i-r,a-r)),s!==a&&u===h?t.delete(e.id):(s!==u&&t.set([e.id,"startOffset"],u),a!==h&&t.set([e.id,"endOffset"],h)))}),s=t.getIndex("container-annotation-anchors");var u=s.get(e),h=[];r(u,function(e){h.push(e.id);var r=n,i=o,s=e.offset,a=!1;if(i<=s)s-=c,a=!0;else if(r<=s){var u=s-Math.min(i-r,s-r);s!==u&&(s=u,a=!0)}if(a){var l=e.isStart?"startOffset":"endOffset";t.set([e.id,l],s)}}),r(i(h),function(e){var n=t.get(e),r=n.getSelection();r.isCollapsed()&&t.delete(e)})}},c=function(t,e,n,s,a){var c=t.getIndex("annotations"),u=c.get(e,n);r(u,function(e){var r,i,c=n>e.startOffset&&n<e.endOffset,u=e.startOffset,h=e.endOffset;if(c){if(e.canSplit()){var l=e.toJSON();l.id=o(e.type+"_"),l.startOffset=a,l.endOffset=a+e.endOffset-n,l.path=s,t.create(l)}r=e.startOffset,i=n,i===r?t.delete(e.id):(r!==u&&t.set([e.id,"startOffset"],r),i!==h&&t.set([e.id,"endOffset"],i))}else e.startOffset>=n&&(r=a+e.startOffset-n,i=a+e.endOffset-n,t.set([e.id,"path"],s),t.set([e.id,"startOffset"],r),t.set([e.id,"endOffset"],i))}),c=t.getIndex("container-annotation-anchors");var h=c.get(e),l=[];r(h,function(e){l.push(e.id);var r=e.offset;if(n<=r){var i=e.isStart?"startPath":"endPath",o=e.isStart?"startOffset":"endOffset";t.set([e.id,i],s),t.set([e.id,o],a+e.offset-n)}}),r(i(l),function(e){var n=t.get(e),r=n.getSelection();r.isCollapsed()&&t.delete(e)})};e.exports={insertedText:s,deletedText:a,transferAnnotations:c}},{"../util/uuid":344,"lodash/each":198,"lodash/uniq":241}],25:[function(t,e,n){"use strict";function r(t){if(h.call(this),!t||!t.type)throw new Error("Illegal argument: insufficient data.");if(this.type=t.type,this.type!==f){if(this.type!==p&&this.type!==d)throw new Error("Illegal type.");if(this.pos=t.pos,this.val=t.val,!a(this.pos)||this.pos<0)throw new Error("Illegal argument: expecting positive number as pos.")}}function i(t,e){t.pos===e.pos?e.pos+=1:t.pos<e.pos?e.pos+=1:t.pos+=1}function o(t,e){return t.pos===e.pos?(e.type=f,void(t.type=f)):void(t.pos<e.pos?e.pos-=1:t.pos-=1)}function s(t,e){if(t.type===d){var n=t;t=e,e=n}t.pos<=e.pos?e.pos+=1:t.pos-=1}var a=t("lodash/isNumber"),c=t("lodash/isEqual"),u=t("lodash/cloneDeep"),h=t("./Operation"),l=t("./Conflict"),f="NOP",d="delete",p="insert";r.fromJSON=function(t){return new r(t)},r.Prototype=function(){this._isArrayOperation=!0,this.apply=function(t){if(this.type===f)return t;if(this.type===p){if(t.length<this.pos)throw new Error("Provided array is too small.");return t.splice(this.pos,0,this.val),t}if(t.length<this.pos)throw new Error("Provided array is too small.");if(!c(t[this.pos],this.val))throw Error("Unexpected value at position "+this.pos+". Expected "+this.val+", found "+t[this.pos]);return t.splice(this.pos,1),t},this.clone=function(){var t={type:this.type,pos:this.pos,val:u(this.val)};return new r(t)},this.invert=function(){var t=this.toJSON();return this.type===f?t.type=f:this.type===p?t.type=d:t.type=p,new r(t)},this.hasConflict=function(t){return r.hasConflict(this,t)},this.toJSON=function(){var t={type:this.type};return this.type===f?t:(t.pos=this.pos,t.val=u(this.val),t)},this.isInsert=function(){return this.type===p},this.isDelete=function(){return this.type===d},this.getOffset=function(){return this.pos},this.getValue=function(){return this.val},this.isNOP=function(){return this.type===f},this.toString=function(){return["(",this.isInsert()?p:d,",",this.getOffset(),",'",this.getValue(),"')"].join("")}},h.extend(r);var g=function(t,e){return t.type!==f&&e.type!==f&&(t.type===p&&e.type===p&&t.pos===e.pos)},m=function(t,e,n){if(n=n||{},n["no-conflict"]&&g(t,e))throw new l(t,e);return n.inplace||(t=t.clone(),e=e.clone()),t.type===f||e.type===f||(t.type===p&&e.type===p?i(t,e):t.type===d&&e.type===d?o(t,e):s(t,e)),[t,e]};r.transform=m,r.hasConflict=g,r.Insert=function(t,e){return new r({type:p,pos:t,val:e})},r.Delete=function(t,e){return new r({type:d,pos:t,val:e})},r.NOP=f,r.DELETE=d,r.INSERT=p,e.exports=r},{"./Conflict":26,"./Operation":34,"lodash/cloneDeep":197,"lodash/isEqual":214,"lodash/isNumber":218}],26:[function(t,e,n){"use strict";function r(t,e){Error.call(this,"Conflict: "+JSON.stringify(t)+" vs "+JSON.stringify(e)),this.a=t,this.b=e}r.prototype=Error.prototype,e.exports=r},{}],27:[function(t,e,n){"use strict";function r(t,e){c.call(this),e=e||{},this.schema=t,this.nodes=new u,this.indexes={},this.options=e||{},this.nodeFactory=e.nodeFactory||new h(t.nodeRegistry),this.__QUEUE_INDEXING__=!1,this.queue=[]}var i=t("lodash/isArray"),o=t("lodash/isString"),s=t("lodash/each"),a=t("lodash/cloneDeep"),c=t("../../util/EventEmitter"),u=t("./DataObject"),h=t("./NodeFactory");r.Prototype=function(){this.contains=function(t){return Boolean(this.nodes[t])},this.get=function(t,e){if(!t)throw new Error("Path or id required");var n=this.nodes.get(t);if(e&&void 0===n)throw o(t)?new Error("Could not find node with id '"+t+"'."):new Error("Property for path '"+t+"' us undefined.");return n},this.getNodes=function(){return this.nodes},this.create=function(t){var e=this.nodeFactory.create(t.type,t);if(!e)throw new Error("Illegal argument: could not create node for data:",t);if(this.contains(e.id))throw new Error("Node already exists: "+e.id);if(!e.id||!e.type)throw new Error("Node id and type are mandatory.");this.nodes[e.id]=e;var n={type:"create",node:e};return this.__QUEUE_INDEXING__?this.queue.push(n):this._updateIndexes(n),e},this.delete=function(t){var e=this.nodes[t];e.dispose(),delete this.nodes[t];var n={type:"delete",node:e};return this.__QUEUE_INDEXING__?this.queue.push(n):this._updateIndexes(n),e},this.set=function(t,e){var n=this.get(t[0]),r=this.nodes.get(t);this.nodes.set(t,e);var i={type:"set",node:n,path:t,newValue:e,oldValue:r};return this.__QUEUE_INDEXING__?this.queue.push(i):this._updateIndexes(i),r},this.update=function(t,e){var n,r=this.nodes.get(t);if(e.isOperation)n=e.apply(r);else{var s,a,c,u;if(o(r))if(e.delete)s=e.delete.start,a=e.delete.end,n=r.split("").splice(s,a-s).join("");else{if(!e.insert)throw new Error("Diff is not supported:",JSON.stringify(e));c=e.insert.offset,u=e.insert.value,n=[r.substring(0,c),u,r.substring(c)].join("")}else{if(!i(r))throw new Error("Diff is not supported:",JSON.stringify(e));if(n=r.slice(0),e.delete)c=e.delete.offset,n.splice(c,1);else{if(!e.insert)throw new Error("Diff is not supported:",JSON.stringify(e));c=e.insert.offset,u=e.insert.value,n.splice(c,0,u)}}}this.nodes.set(t,n);var h=this.get(t[0]),l={type:"update",node:h,path:t,newValue:n,oldValue:r};return this.__QUEUE_INDEXING__?this.queue.push(l):this._updateIndexes(l),r},this.toJSON=function(){return{schema:[this.schema.id,this.schema.version],nodes:a(this.nodes)}},this.reset=function(){this.nodes.clear()},this.addIndex=function(t,e){return this.indexes[t]&&console.error("Index with name %s already exists.",t),e.reset(this),this.indexes[t]=e,e},this.getIndex=function(t){return this.indexes[t]},this._updateIndexes=function(t){t&&!this.__QUEUE_INDEXING__&&s(this.indexes,function(e){e.select(t.node)&&(e[t.type]||console.error("Contract: every NodeIndex must implement "+t.type),e[t.type](t.node,t.path,t.newValue,t.oldValue))})},this._stopIndexing=function(){this.__QUEUE_INDEXING__=!0},this._startIndexing=function(){for(this.__QUEUE_INDEXING__=!1;this.queue.length>0;){var t=this.queue.shift();this._updateIndexes(t)}}},c.extend(r),e.exports=r},{"../../util/EventEmitter":335,"./DataObject":28,"./NodeFactory":31,"lodash/cloneDeep":197,"lodash/each":198,"lodash/isArray":209,"lodash/isString":221}],28:[function(t,e,n){"use strict";function r(t){t&&(this.__root__=t)}var i=t("lodash/isString"),o=t("lodash/isArray"),s=t("lodash/get"),a=t("lodash/setWith"),c=t("lodash/unset"),u=t("../../util/oo");r.Prototype=function(){this._isDataObject=!0,this.getRoot=function(){return this.__root__?this.__root__:this},this.get=function(t){if(t){if(i(t))return this.getRoot()[t];if(arguments.length>1&&(t=Array.prototype.slice(arguments,0)),!o(t))throw new Error("Illegal argument for DataObject.get()");return s(this.getRoot(),t)}},this.set=function(t,e){if(!t)throw new Error("Illegal argument: DataObject.set(>path<, value) - path is mandatory.");i(t)?this.getRoot()[t]=e:a(this.getRoot(),t,e)},this.delete=function(t){if(i(t))delete this.getRoot()[t];else if(1===t.length)delete this.getRoot()[t[0]];else{var e=c(this.getRoot(),t);if(!e)throw new Error("Could not delete property at path"+t)}},this.clear=function(){var t=this.getRoot();for(var e in t)t.hasOwnProperty(e)&&delete t[e]}},u.initClass(r),e.exports=r},{"../../util/oo":342,"lodash/get":205,"lodash/isArray":209,"lodash/isString":221,"lodash/setWith":233,"lodash/unset":242}],29:[function(t,e,n){"use strict";function r(t,e){r.super.call(this,t,e)}var i=t("lodash/isString"),o=t("lodash/isArray"),s=t("lodash/cloneDeep"),a=t("./Data"),c=t("./ObjectOperation"),u=t("./ArrayOperation"),h=t("./TextOperation");r.Prototype=function(){var t=r.super.prototype;this.create=function(t){var e=c.Create([t.id],t);return this.apply(e),e},this.delete=function(t){var e=null,n=this.get(t);if(n){var r=n.toJSON();e=c.Delete([t],r),this.apply(e)}return e},this.update=function(t,e){var n=this._getDiffOp(t,e),r=c.Update(t,n);return this.apply(r),r},this.set=function(t,e){var n=this.get(t),r=c.Set(t,n,e);return this.apply(r),r},this.apply=function(e){if(e.type!==c.NOP){if(e.type===c.CREATE)t.create.call(this,s(e.val));else if(e.type===c.DELETE)t.delete.call(this,e.val.id);else if(e.type===c.UPDATE){var n=this.get(e.path),r=e.diff;if("array"===e.propertyType)r._isArrayOperation||(r=u.fromJSON(r)),r.apply(n);else{if("string"!==e.propertyType)throw new Error("Unsupported type for operational update.");r._isTextOperation||(r=h.fromJSON(r));var i=r.apply(n);t.set.call(this,e.path,i)}}else{if(e.type!==c.SET)throw new Error("Illegal state.");t.set.call(this,e.path,e.val)}this.emit("operation:applied",e,this)}},this._getDiffOp=function(t,e){var n=null;if(e.isOperation)n=e;else{var r,s,a,c,l=this.get(t);if(null===l||void 0===l)throw new Error("Property has not been initialized: "+JSON.stringify(t));i(l)?e.delete?(r=e.delete.start,s=e.delete.end,n=h.Delete(r,l.substring(r,s))):e.insert&&(a=e.insert.offset,c=e.insert.value,n=h.Insert(a,c)):o(l)&&(e.delete?(a=e.delete.offset,n=u.Delete(a,l[a])):e.insert&&(a=e.insert.offset,c=e.insert.value,n=u.Insert(a,c)))}if(!n)throw new Error("Unsupported diff: "+JSON.stringify(e));return n}},a.extend(r),e.exports=r},{"./ArrayOperation":25,"./Data":27,"./ObjectOperation":33,"./TextOperation":36,"lodash/cloneDeep":197,"lodash/isArray":209,"lodash/isString":221}],30:[function(t,e,n){"use strict";function r(t){y.call(this);var e=this.constructor;if(!e.static.name)throw new Error('Every NodeClass must provide a static property "name".');m(e.static.schema,function(e,n){var r=void 0!==t[n],i=e.hasOwnProperty("default"),o=e.optional;if(!o&&!i&&!r)throw new Error("Property "+n+" is mandatory for node type "+this.type);r?this[n]=u(e,t[n]):i&&(this[n]=g(u(e,e.default)))}.bind(this))}function i(t,e){var n=o(e);if(t.static.schema=a(t,n),t.static.defaultProps=c(t),!t.static.hasOwnProperty("addressablePropertyNames")){var r=[];m(t.static.schema,function(t,e){"string"===t.type&&t.addressable===!0&&r.push(e)}),t.static.addressablePropertyNames=r}}function o(t){var e={};return m(t,function(t,n){(f(t)||d(t))&&(t={type:t}),t=s(t),t.name=n,e[n]=t}),e}function s(t){var e=t;return d(t.type)&&"array"!==t[0]?t.type=["array",t.type[0]]:"text"===t.type&&(e={type:"string",addressable:!0,default:""}),e}function a(t,e){for(var n=[e],r=t;r;){var i=Object.getPrototypeOf(r.prototype);if(!i)break;r=i.constructor,r&&r.static&&r.static.schema&&n.unshift(r.static.schema)}return n.unshift({}),v.apply(null,n)}function c(t){var e=t.static.unfoldedSchema,n={};return m(e,function(t,e){t.hasOwnProperty("default")&&(n[e]=t.default)}),n}function u(t,e){var n;if(n=d(t.type)?"array":t.type,null===e){if(t.notNull)throw new Error("Value for property "+t.name+" is null.");return e}if(void 0===e)throw new Error("Value for property "+t.name+" is undefined.");if("string"===n&&!f(e)||"boolean"===n&&!h(e)||"number"===n&&!l(e)||"array"===n&&!d(e)||"id"===n&&!f(e)||"object"===n&&!p(e))throw new Error("Illegal value type for property "+t.name+": expected "+n+", was "+typeof e);return e}var h=t("lodash/isBoolean"),l=t("lodash/isNumber"),f=t("lodash/isString"),d=t("lodash/isArray"),p=t("lodash/isObject"),g=t("lodash/cloneDeep"),m=t("lodash/each"),v=t("lodash/extend"),y=t("../../util/EventEmitter");r.Prototype=function(){this._isNode=!0,this.dispose=function(){},this.isInstanceOf=function(t){return r.isInstanceOf(this.constructor,t)},this.getTypeNames=function(){for(var t=[],e=this.constructor.static;e&&"node"!==e.name;)t.push(e.name),e=Object.getPrototypeOf(e);return t},this.getPropertyType=function(t){var e=this.constructor.static.schema;return e[t].type},this.toJSON=function(){var t={type:this.constructor.static.name};return m(this.constructor.static.schema,function(e,n){t[e.name]=this[n]}.bind(this)),t}},y.extend(r),r.static.name="node",r.static.defineSchema=function(t){var e=this.__class__;i(e,t)},r.static.defineSchema({id:"string"}),Object.defineProperty(r.prototype,"type",{configurable:!1,get:function(){return this.constructor.static.name},set:function(){throw new Error('Property "type" is read-only.')}}),r.isInstanceOf=function(t,e){for(var n=t.static;n&&"node"!==n.name;){if(n&&n.name===e)return!0;n=Object.getPrototypeOf(n)}return!1},r.static.isInstanceOf=r.isInstanceOf,e.exports=r},{"../../util/EventEmitter":335,"lodash/cloneDeep":197,"lodash/each":198,"lodash/extend":200,"lodash/isArray":209,"lodash/isBoolean":212,"lodash/isNumber":218,"lodash/isObject":219,"lodash/isString":221}],31:[function(t,e,n){"use strict";function r(t){this.nodeRegistry=t}var i=t("../../util/oo");r.Prototype=function(){this.create=function(t,e){var n=this.nodeRegistry.get(t);if(!n)throw new Error("No Node registered by that name: "+t);return new n(e)}},i.initClass(r),e.exports=r},{"../../util/oo":342}],32:[function(t,e,n){"use strict";function r(){this.index=new c}var i=t("../../util/oo"),o=t("lodash/isArray"),s=t("lodash/each"),a=t("lodash/extend"),c=t("../../util/TreeIndex");r.Prototype=function(){this.get=function(t){return this.index.get(t)||{}},this.getAll=function(t){return this.index.getAll(t)},this.property="id",this.select=function(t){return!this.type||t.isInstanceOf(this.type)},this.create=function(t){var e=t[this.property];o(e)||(e=[e]),s(e,function(e){this.index.set([e,t.id],t)}.bind(this))},this.delete=function(t){var e=t[this.property];o(e)||(e=[e]),s(e,function(e){this.index.delete([e,t.id])}.bind(this))},this.update=function(t,e,n,r){if(this.select(t)&&e[1]===this.property){var i=r;o(i)||(i=[i]),s(i,function(e){this.index.delete([e,t.id])}.bind(this)),i=n,o(i)||(i=[i]),s(i,function(e){this.index.set([e,t.id],t)}.bind(this))}},this.set=function(t,e,n,r){this.update(t,e,n,r)},this.reset=function(t){this.index.clear(),this._initialize(t)},this.clone=function(){var t=this.constructor,e=new t;return e},this._initialize=function(t){s(t.getNodes(),function(t){this.select(t)&&this.create(t)}.bind(this))}},i.initClass(r),r.create=function(t){var e=a(new r,t);return e.clone=function(){return r.create(t)},e},r.filterByType=function(t){return function(e){return e.isInstanceOf(t)}},e.exports=r},{"../../util/TreeIndex":336,"../../util/oo":342,"lodash/each":198,"lodash/extend":200,"lodash/isArray":209}],33:[function(t,e,n){"use strict";function r(t){if(c.call(this),!t)throw new Error("Data of ObjectOperation is missing.");if(!t.type)throw new Error("Invalid data: type is mandatory.");if(this.type=t.type,t.type!==f){if(this.path=t.path,!t.path)throw new Error("Invalid data: path is mandatory.");if(this.type===d||this.type===p){if(!t.val)throw new Error("Invalid data: value is missing.");this.val=t.val}else if(this.type===g){if(!t.diff)throw new Error("Invalid data: diff is mandatory for update operation.");if(this.diff=t.diff,t.diff._isTextOperation)this.propertyType="string";else{if(!t.diff._isArrayOperation)throw new Error("Invalid data: diff must be a TextOperation or an ArrayOperation.");this.propertyType="array"}}else{if(this.type!==m)throw new Error("Invalid type: "+t.type);this.val=t.val,this.original=t.original}}}var i=t("lodash/isString"),o=t("lodash/isEqual"),s=t("lodash/cloneDeep"),a=t("./DataObject"),c=t("./Operation"),u=t("./TextOperation"),h=t("./ArrayOperation"),l=t("./Conflict"),f="NOP",d="create",p="delete",g="update",m="set";r.fromJSON=function(t){if(t=s(t),"update"===t.type)switch(t.propertyType){case"string":t.diff=u.fromJSON(t.diff);break;case"array":t.diff=h.fromJSON(t.diff);break;default:throw new Error("Unsupported update diff:"+JSON.stringify(t.diff))}var e=new r(t);return e},r.Prototype=function(){this._isObjectOperation=!0,this.apply=function(t){if(this.type===f)return t;var e;if(e=t._isDataObject?t:new a(t),this.type===d)return e.set(this.path,s(this.val)),t;if(this.type===p)e.delete(this.path,"strict");else if(this.type===g){var n,r=this.diff,i=e.get(this.path);n=r._isArrayOperation?r.apply(i):r.apply(i),e.set(this.path,n)}else e.set(this.path,s(this.val));return t},this.clone=function(){var t={type:this.type,path:this.path};return this.val&&(t.val=s(this.val)),this.diff&&(t.diff=this.diff.clone()),new r(t)},this.isNOP=function(){return this.type===f||(this.type===g?this.diff.isNOP():void 0)},this.isCreate=function(){return this.type===d},this.isDelete=function(){return this.type===p;
},this.isUpdate=function(t){return t?this.type===g&&this.propertyType===t:this.type===g},this.isSet=function(){return this.type===m},this.invert=function(){if(this.type===f)return new r({type:f});var t=new r(this);if(this.type===d)t.type=p;else if(this.type===p)t.type=d;else if(this.type===g){var e;e=this.diff._isTextOperation?u.fromJSON(this.diff.toJSON()).invert():h.fromJSON(this.diff.toJSON()).invert(),t.diff=e}else t.val=this.original,t.original=this.val;return t},this.hasConflict=function(t){return r.hasConflict(this,t)},this.toJSON=function(){if(this.type===f)return{type:f};var t={type:this.type,path:this.path};return this.type===d||this.type===p?t.val=this.val:this.type===g?(this.diff._isArrayOperation?t.propertyType="array":t.propertyType="string",t.diff=this.diff.toJSON()):(t.val=this.val,t.original=this.original),t},this.getType=function(){return this.type},this.getPath=function(){return this.path},this.getValue=function(){return this.val},this.getOldValue=function(){return this.original},this.getValueOp=function(){return this.diff},this.toString=function(){switch(this.type){case d:return["(+,",JSON.stringify(this.path),JSON.stringify(this.val),")"].join("");case p:return["(-,",JSON.stringify(this.path),JSON.stringify(this.val),")"].join("");case g:return["(>>,",JSON.stringify(this.path),this.propertyType,this.diff.toString(),")"].join("");case m:return["(=,",JSON.stringify(this.path),this.val,this.original,")"].join("");case f:return"NOP";default:throw new Error("Invalid type")}}},c.extend(r);var v=function(t,e){return t.type!==f&&e.type!==f&&o(t.path,e.path)},y=function(t,e){t.type=f,e.type=f},_=function(){throw new Error("Can not transform two concurring creates of the same property")},x=function(){throw new Error("Illegal state: can not create and delete a value at the same time.")},w=function(t,e,n){if(t.type!==p)return w(e,t,!0);var r;r="string"===e.propertyType?u.fromJSON(e.diff):h.fromJSON(e.diff),n?(t.val=r.apply(t.val),e.type=f):(t.type=f,e.type=d,e.val=r.apply(t.val))},b=function(){throw new Error("Can not transform a concurring create and update of the same property")},C=function(t,e){var n,r,i;"string"===e.propertyType?(n=u.fromJSON(t.diff),r=u.fromJSON(e.diff),i=u.transform(n,r,{inplace:!0})):(n=h.fromJSON(t.diff),r=h.fromJSON(e.diff),i=h.transform(n,r,{inplace:!0})),t.diff=i[0],e.diff=i[1]},E=function(){throw new Error("Illegal state: can not create and set a value at the same time.")},O=function(t,e,n){return t.type!==p?O(e,t,!0):void(n?(t.val=e.val,e.type=f):(t.type=f,e.type=d,e.original=void 0))},S=function(){throw new Error("Unresolvable conflict: update + set.")},N=function(t,e){t.type=f,e.original=t.val},P=0,I=1,T=2,A=4,D=8,M={};M[f]=P,M[d]=I,M[p]=T,M[g]=A,M[m]=D;var L=[];L[T|T]=y,L[T|I]=x,L[T|A]=w,L[I|I]=_,L[I|A]=b,L[A|A]=C,L[I|D]=E,L[T|D]=O,L[A|D]=S,L[D|D]=N;var k=function(t,e,n){if(n=n||{},n["no-conflict"]&&v(t,e))throw new l(t,e);if(n.inplace||(t=t.clone(),e=e.clone()),t.isNOP()||e.isNOP())return[t,e];var r=o(t.path,e.path);return r&&L[M[t.type]|M[e.type]](t,e),[t,e]};r.transform=k,r.hasConflict=v,r.Create=function(t,e){var n;return n=i(t)?[t]:t,new r({type:d,path:n,val:e})},r.Delete=function(t,e){var n;return n=i(t)?[t]:t,new r({type:p,path:n,val:e})},r.Update=function(t,e){return new r({type:g,path:t,diff:e})},r.Set=function(t,e,n){return new r({type:m,path:t,val:s(n),original:s(e)})},r.NOP=f,r.CREATE=d,r.DELETE=p,r.UPDATE=g,r.SET=m,e.exports=r},{"./ArrayOperation":25,"./Conflict":26,"./DataObject":28,"./Operation":34,"./TextOperation":36,"lodash/cloneDeep":197,"lodash/isEqual":214,"lodash/isString":221}],34:[function(t,e,n){"use strict";function r(){}var i=t("../../util/oo");r.Prototype=function(){this.isOperation=!0},i.initClass(r),e.exports=r},{"../../util/oo":342}],35:[function(t,e,n){"use strict";function r(){this.SEPARATOR="\t"}function i(t,e){o(arguments[0])?this.tokens=arguments[0]:this.tokens=t.split(e),this.pos=-1}var o=t("lodash/isArray"),s=t("lodash/isNumber"),a=t("lodash/isObject"),c=t("../../util/oo"),u=t("./ObjectOperation"),h=t("./TextOperation"),l=t("./ArrayOperation");r.Prototype=function(){this.serialize=function(t){var e=[];switch(t.type){case"create":e.push("c"),e.push(t.val.id),e.push(t.val);break;case"delete":e.push("d"),e.push(t.val.id),e.push(t.val);break;case"set":e.push("s"),e.push(t.path.join(".")),e.push(t.val),e.push(t.original);break;case"update":e.push("u"),e.push(t.path.join(".")),Array.prototype.push.apply(e,this.serializePrimitiveOp(t.diff));break;default:throw new Error("Unsupported operation type.")}return e},this.serializePrimitiveOp=function(t){var e=[];if(t._isTextOperation)t.isInsert()?e.push("t+"):t.isDelete()&&e.push("t-"),e.push(t.pos),e.push(t.str);else{if(!t._isArrayOperation)throw new Error("Unsupported operation type.");t.isInsert()?e.push("a+"):t.isDelete()&&e.push("a-"),e.push(t.pos),e.push(t.val)}return e},this.deserialize=function(t,e){e||(e=new i(t,this.SEPARATOR));var n,r,o,s,a,c=e.getString();switch(c){case"c":r=e.getPath(),o=e.getObject(),n=u.Create(r,o);break;case"d":r=e.getPath(),o=e.getObject(),n=u.Delete(r,o);break;case"s":r=e.getPath(),o=e.getAny(),s=e.getAny(),n=u.Set(r,s,o);break;case"u":r=e.getPath(),a=this.deserializePrimitiveOp(t,e),n=u.Update(r,a);break;default:throw new Error("Illegal type for ObjectOperation: "+c)}return n},this.deserializePrimitiveOp=function(t,e){e||(e=new i(t,this.SEPARATOR));var n,r,o,s=e.getString();switch(s){case"t+":r=e.getNumber(),o=e.getString(),n=h.Insert(r,o);break;case"t-":r=e.getNumber(),o=e.getString(),n=h.Delete(r,o);break;case"a+":r=e.getNumber(),o=e.getAny(),n=l.Insert(r,o);break;case"a-":r=e.getNumber(),o=e.getAny(),n=l.Delete(r,o);break;default:throw new Error("Unsupported operation type: "+s)}return n}},c.initClass(r),i.Prototype=function(){this.error=function(t){throw new Error("Parsing error: "+t+"\n"+this.tokens[this.pos])},this.getString=function(){this.pos++;var t=this.tokens[this.pos];return'"'===t[0]&&(t=t.slice(1,-1)),t},this.getNumber=function(){this.pos++;var t,e=this.tokens[this.pos];try{return t=s(e)?e:parseInt(this.tokens[this.pos],10)}catch(t){this.error("expected number")}},this.getObject=function(){this.pos++;var t,e=this.tokens[this.pos];try{return t=a(e)?e:JSON.parse(this.tokens[this.pos])}catch(t){this.error("expected object")}},this.getAny=function(){this.pos++;var t=this.tokens[this.pos];return t},this.getPath=function(){var t=this.getString();return t.split(".")}},c.initClass(i),r.Tokenizer=i,e.exports=r},{"../../util/oo":342,"./ArrayOperation":25,"./ObjectOperation":33,"./TextOperation":36,"lodash/isArray":209,"lodash/isNumber":218,"lodash/isObject":219}],36:[function(t,e,n){"use strict";function r(t){if(h.call(this),!t||void 0===t.type||void 0===t.pos||void 0===t.str)throw new Error("Illegal argument: insufficient data.");if(this.type=t.type,this.pos=t.pos,this.str=t.str,!this.isInsert()&&!this.isDelete())throw new Error("Illegal type.");if(!c(this.str))throw new Error("Illegal argument: expecting string.");if(!u(this.pos)||this.pos<0)throw new Error("Illegal argument: expecting positive number as pos.")}function i(t,e){t.pos===e.pos?e.pos+=t.str.length:t.pos<e.pos?e.pos+=t.str.length:t.pos+=e.str.length}function o(t,e,n){if(t.pos>e.pos)return o(e,t,!n);if(t.pos===e.pos&&t.str.length>e.str.length)return o(e,t,!n);if(e.pos<t.pos+t.str.length){var r=e.pos-t.pos,i=t.str.length-r,s=r+e.str.length;t.str=t.str.slice(0,r)+t.str.slice(s),e.str=e.str.slice(i),e.pos-=r}else e.pos-=t.str.length}function s(t,e){if(t.type===d)return s(e,t);if(t.pos<=e.pos)e.pos+=t.str.length;else if(t.pos>=e.pos+e.str.length)t.pos-=e.str.length;else{var n=t.pos-e.pos;e.str=e.str.slice(0,n)+t.str+e.str.slice(n),t.str=""}}var a,c=t("lodash/isString"),u=t("lodash/isNumber"),h=t("./Operation"),l=t("./Conflict"),f="insert",d="delete";r.fromJSON=function(t){return new r(t)},r.Prototype=function(){this._isTextOperation=!0,this.apply=function(t){if(this.isEmpty())return t;if(this.type===f){if(t.length<this.pos)throw new Error("Provided string is too short.");return t.splice?t.splice(this.pos,0,this.str):t.slice(0,this.pos).concat(this.str).concat(t.slice(this.pos))}if(t.length<this.pos+this.str.length)throw new Error("Provided string is too short.");return t.splice?t.splice(this.pos,this.str.length):t.slice(0,this.pos).concat(t.slice(this.pos+this.str.length))},this.clone=function(){return new r(this)},this.isNOP=function(){return"NOP"===this.type||0===this.str.length},this.isInsert=function(){return this.type===f},this.isDelete=function(){return this.type===d},this.getLength=function(){return this.str.length},this.invert=function(){var t={type:this.isInsert()?d:f,pos:this.pos,str:this.str};return new r(t)},this.hasConflict=function(t){return a(this,t)},this.isEmpty=function(){return 0===this.str.length},this.toJSON=function(){return{type:this.type,pos:this.pos,str:this.str}},this.toString=function(){return["(",this.isInsert()?f:d,",",this.pos,",'",this.str,"')"].join("")}},h.extend(r),a=function(t,e){if(t.type===f&&e.type===f)return t.pos===e.pos;if(t.type===d&&e.type===d)return!(t.pos>=e.pos+e.str.length||e.pos>=t.pos+t.str.length);var n,r;return t.type===d?(n=t,r=e):(n=e,r=t),r.pos>=n.pos&&r.pos<n.pos+n.str.length};var p=function(t,e,n){if(n=n||{},n["no-conflict"]&&a(t,e))throw new l(t,e);return n.inplace||(t=t.clone(),e=e.clone()),t.type===f&&e.type===f?i(t,e):t.type===d&&e.type===d?o(t,e,!0):s(t,e),[t,e]};r.transform=function(){return p.apply(null,arguments)},r.Insert=function(t,e){return new r({type:f,pos:t,str:e})},r.Delete=function(t,e){return new r({type:d,pos:t,str:e})},r.INSERT=f,r.DELETE=d,e.exports=r},{"./Conflict":26,"./Operation":34,"lodash/isNumber":218,"lodash/isString":221}],37:[function(t,e,n){"use strict";var r=t("lodash/isString"),i=t("lodash/filter"),o=t("./DocumentIndex"),s=t("./Selection"),a={};a.isContainerAnnotation=function(t,e){var n=t.getSchema();return n.isInstanceOf(e,"container-annotation")},a.getPropertyAnnotationsForSelection=function(t,e,n){if(n=n||{},!e.isPropertySelection())return[];var r=t.getIndex("annotations").get(e.path,e.startOffset,e.endOffset);return n.type&&(r=i(r,o.filterByType(n.type))),r},a.getContainerAnnotationsForSelection=function(t,e,n,r){if(!n)throw new Error("'containerId' is required.");r=r||{};var o=t.getIndex("container-annotations"),s=o.get(n,r.type);return s=i(s,function(t){return e.overlaps(t.getSelection())})},a.getAnnotationsForSelection=function(t,e,n,r){var i,o=a.isContainerAnnotation(t,n);if(o){var s=t.get(r,"strict");i=a.getContainerAnnotationsForSelection(t,e,s,{type:n})}else i=a.getPropertyAnnotationsForSelection(t,e,{type:n});return i},a.getTextForSelection=function(t,e){var n;if(!e||e.isNull())return"";if(e.isPropertySelection())return n=t.get(e.start.path),n.substring(e.start.offset,e.end.offset);if(e.isContainerSelection()){var i=[],o=e.getFragments();return o.forEach(function(e){if(e instanceof s.Fragment){var n=t.get(e.path);r(n)&&i.push(n.substring(e.startOffset,e.endOffset))}}),i.join("\n")}},e.exports=a},{"./DocumentIndex":11,"./Selection":21,"lodash/filter":201,"lodash/isString":221}],38:[function(t,e,n){"use strict";function r(t,e){var n=e.selection;if(!n)throw new Error("selection is required.");var r=e.annotationType,s=e.annotationData,c=e.node;if(!c&&r&&(console.warn('DEPRECATED: Use node: {type: "strong"} instead of annotationType: "strong"'),c={type:r},o(c,s)),!c)throw new Error("node is required");if(!n.isPropertySelection()&&!n.isContainerSelection()||n.isCollapsed())throw new Error("Invalid selection for createAnnotation");if(n.isContainerSelection()&&e.splitContainerSelections)return i(t,e);if(a.isContainerAnnotation(t,c.type))c.startPath=n.startPath,c.endPath=n.endPath,c.containerId=n.containerId;else{if(!n.isPropertySelection())throw new Error("Illegal state: can not apply ContainerSelection");c.path=n.path}return c.startOffset=n.startOffset,c.endOffset=n.endOffset,e.result=t.create(c),e}function i(t,e){var n,r=e.selection,i=e.node;r.isPropertySelection()?n=[]:r.isContainerSelection()&&(n=r.splitIntoPropertySelections());for(var a=0;a<n.length;a++){var c={id:s(i.type)};o(c,i),c.path=n[a].getPath(),c.startOffset=n[a].startOffset,c.endOffset=n[a].endOffset,t.create(c)}}var o=t("lodash/extend"),s=t("../../util/uuid"),a=t("../documentHelpers");e.exports=r},{"../../util/uuid":344,"../documentHelpers":37,"lodash/extend":200}],39:[function(t,e,n){"use strict";function r(t,e){var n=e.nodeId;if(!n)throw new Error("Parameter `nodeId` is mandatory.");var i=t.get(n);if(!i)throw new Error("Invalid 'nodeId'. Node does not exist.");var o,s,a=e.containerId,c=t.getIndex("annotations").get(n);for(s=0;s<c.length;s++)t.delete(c[s].id);var u=t.getIndex("container-annotation-anchors").get(n);for(s=0;s<u.length;s++){var h=u[s];if(o=t.get(h.containerId),t.get(h.id)){var l,f,d=o.getPosition(h.path[0]);if(h.isStart)if(d<o.getLength()-1){var p=o.getChildAt(d+1);l=p.isText()?[p.id,"content"]:[p.id],t.set([h.id,"startPath"],l),t.set([h.id,"startOffset"],0)}else t.delete(h.id);else if(d>0){var g=o.getChildAt(d-1);g.isText()?(l=[g.id,"content"],f=t.get(l).length):(l=[g.id],f=1),t.set([h.id,"endPath"],l),t.set([h.id,"endOffset"],f)}else t.delete(h.id)}}return a&&(o=t.get(a),o.hide(n)),i.hasChildren()&&i.getChildren().forEach(function(e){r(t,{nodeId:e.id})}),t.delete(n),e}e.exports=r},{}],40:[function(t,e,n){"use strict";function r(t,e){var n=e.selection;return n.isCollapsed()||(n.isPropertySelection()?e=i(t,e):n.isContainerSelection()?e=o(t,e):n.isNodeSelection()&&(e=s(t,e))),e}function i(t,e){var n=e.selection,r=n.path,i=n.startOffset,o=n.endOffset,s=t.update(r,{delete:{start:i,end:o}});return f(t,{op:s}),e.selection=t.createSelection(r,i),e}function o(t,e){var n=e.selection,r=n.containerId,o=t.get(r),s=o.getPosition(n.start.path[0]),f=n.getFragments();if(0===f.length)return e;for(var d,p,g=null,m=0;m<f.length;m++){var v=f[m];if(v.isPropertyFragment())if(v.isPartial())g||(g={path:v.path,offset:v.startOffset}),i(t,{selection:v});else{var y=v.path[0];h(t,a({},e,{nodeId:y,containerId:o.id}))}else v.isNodeFragment()&&h(t,a({},e,{nodeId:v.nodeId,containerId:o.id}))}return g?e.selection=t.createSelection(g.path,g.offset):(p=t.getSchema().getDefaultTextType(),d={type:p,id:u(p),content:""},t.create(d),o.show(d.id,s),e.selection=t.createSelection([d.id,"content"],0)),f.length>1&&f[0].isPartial()&&c(f).isPartial()&&l(t,a({},e,{selection:e.selection,containerId:r,path:n.endPath,direction:"left"})),0===o.nodes.length&&(p=t.getSchema().getDefaultTextType(),d={type:p,id:u(p),content:""},t.create(d),o.show(d.id,0),e.selection=t.createSelection([d.id,"content"],0)),e}function s(t,e){var n=e.selection;if(!n||!n.isNodeSelection())throw new Error("'sel' must be a NodeSelection");if(!n.isFull())return e;var r=n.getNodeId(),i=n.containerId,o=t.get(i),s=o.getPosition(r);h(t,{nodeId:r,containerId:i});var a=t.create({type:t.getSchema().getDefaultTextType(),content:""});return o.show(a.id,s),{selection:t.createSelection([a.id,"content"],0)}}var a=t("lodash/extend"),c=t("lodash/last"),u=t("../../util/uuid"),h=t("./deleteNode"),l=t("./merge"),f=t("./updateAnnotations");e.exports=r},{"../../util/uuid":344,"./deleteNode":39,"./merge":43,"./updateAnnotations":46,"lodash/extend":200,"lodash/last":226}],41:[function(t,e,n){"use strict";function r(t,e){var n=e.selection,r=e.anno;if(!n||!n._isSelection)throw new Error('Argument "selection" is required.');if(!r||!r._isAnnotation)throw new Error('Argument "anno" is required.');var i=r.getSelection(),o=i.expand(n);return r.updateRange(t,o),e.result=r,e}e.exports=r},{}],42:[function(t,e,n){"use strict";function r(t,e){var n=e.annos;if(!o(n)||n.length<2)throw new Error("fuseAnnotation(): at least two annotations are necessary.");var r,a;return n.forEach(function(t,e){if(0===e)r=t.getSelection(),a=t.type;else{if(t.type!==a)throw new Error("fuseAnnotation(): all annotations must be of the same type.");r=r.expand(t.getSelection())}}),i(n,function(e){t.delete(e.id)}),e.selection=r,e.node={type:a},s(t,e)}var i=t("lodash/each"),o=t("lodash/isArray"),s=t("./createAnnotation");e.exports=r},{"./createAnnotation":38,"lodash/each":198,"lodash/isArray":209}],43:[function(t,e,n){"use strict";function r(t,e){var n=e.firstNodeId,r=e.secondNodeId,o=t.get(n),a=t.get(r),c=i(e.editingBehavior,o,a);return c?c(t,s({},e,{containerId:e.containerId,first:o,second:a})):e}function i(t,e,n){if(t){if(t.canMerge(e.type,n.type))return t.getMerger(e.type,n.type);if(e.isInstanceOf("text")&&t.canMerge("textish",n.type))return t.getMerger("textish",n.type);if(n.isInstanceOf("text")&&t.canMerge(e.type,"textish"))return t.getMerger(e.type,"textish")}return e.isInstanceOf("text")&&n.isInstanceOf("text")?o:(console.info("No merge behavior defined for %s <- %s",e.type,n.type),null)}function o(t,e){var n,r=e.containerId,i=e.first,o=e.second,s=t.get(r),c=i.getTextPath(),u=i.getText(),h=u.length,l=o.getTextPath(),f=o.getText();return 0===h?(s.hide(c[0]),t.delete(c[0]),n=t.createSelection({type:"property",path:l,startOffset:0})):(t.update(c,{insert:{offset:h,value:f}}),a.transferAnnotations(t,l,0,c,h),s.hide(l[0]),t.delete(l[0]),n=t.createSelection({type:"property",path:c,startOffset:h})),e.selection=n,e}var s=t("lodash/extend"),a=t("../annotationHelpers"),c=t("./deleteNode"),u=function(t,e){var n=e.containerId,i=e.path,o=e.direction;if(!n||!i||!o)throw new Error("Insufficient arguments! mandatory fields: `containerId`, `path`, `direction`");var a,u=t.get(n),h=i[0],l=t.get(h),f=u.getPosition(h),d=u.getLength();if("right"===o&&f<d-1){var p=u.nodes[f+1],g=t.get(p);l.isText()&&0===l.getText().length?(c(t,{nodeId:h,containerId:n}),g.isText()?e.selection=t.createSelection(p,0):e.selection=t.createSelection({type:"node",nodeId:p,containerId:n,mode:"full"})):(a=r(t,s({},e,{containerId:n,firstNodeId:h,secondNodeId:p})),e.selection=a.selection)}else if("left"===o&&f>0){var m=u.nodes[f-1],v=t.get(m);l.isText()&&0===l.getText().length?(c(t,{nodeId:h,containerId:n}),v.isText()?e.selection=t.createSelection(v.getTextPath(),v.getText().length):e.selection=t.createSelection({type:"node",nodeId:m,containerId:n,mode:"full"})):(a=r(t,s({},e,{containerId:n,firstNodeId:m,secondNodeId:h})),e.selection=a.selection)}return e};e.exports=u},{"../annotationHelpers":24,"./deleteNode":39,"lodash/extend":200}],44:[function(t,e,n){"use strict";function r(t,e){var n=e.selection;if(!n.isPropertySelection())return console.error("Selection must be a PropertySelection."),e;var r=n.path,c=r[0],u=e.data,h=t.get(c);if(!h.isInstanceOf("text"))return console.warn("Trying to use switchTextType on a non text node. Skipping."),e;var l=i({id:o(u.type),type:u.type,content:h.content},u),f=[l.id,"content"];l=t.create(l),s.transferAnnotations(t,r,0,f,0);var d=t.get(e.containerId),p=d.getPosition(c);return p>=0&&(d.hide(c),d.show(l.id,p)),a(t,{nodeId:h.id}),e.selection=t.createSelection(f,n.startOffset,n.endOffset),e.node=l,e}var i=t("lodash/extend"),o=t("../../util/uuid"),s=t("../annotationHelpers"),a=t("./deleteNode");e.exports=r},{"../../util/uuid":344,"../annotationHelpers":24,"./deleteNode":39,"lodash/extend":200}],45:[function(t,e,n){"use strict";function r(t,e){var n=e.selection,r=e.anno;if(!n||!n._isSelection)throw new Error('Argument "selection" is required.');if(!r||!r._isAnnotation)throw new Error('Argument "anno" is required.');var i=r.getSelection(),o=i.truncateWith(n);return r.updateRange(t,o),e.result=r,e}e.exports=r},{}],46:[function(t,e,n){"use strict";function r(t,e){var n=e.op;if(!n.isUpdate())throw new Error("Only text updates are supported.");var r=n.diff;return r.isInsert()?i(t,e):r.isDelete()?o(t,e):e}function i(t,e){var n=e.op,r=n.diff;return s.insertedText(t,new a(n.path,r.pos),r.getLength(),e.ignoredAnnotations),e}function o(t,e){var n=e.op,r=n.diff;return s.deletedText(t,n.path,r.pos,r.pos+r.getLength(),e.replaceTextSupport),e}var s=t("../annotationHelpers"),a=t("../Coordinate");e.exports=r},{"../Coordinate":7,"../annotationHelpers":24}],47:[function(t,e,n){var r=t("./_getNative"),i=t("./_root"),o=r(i,"DataView");e.exports=o},{"./_getNative":139,"./_root":181}],48:[function(t,e,n){function r(t){var e=-1,n=t?t.length:0;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}var i=t("./_hashClear"),o=t("./_hashDelete"),s=t("./_hashGet"),a=t("./_hashHas"),c=t("./_hashSet");r.prototype.clear=i,r.prototype.delete=o,r.prototype.get=s,r.prototype.has=a,r.prototype.set=c,e.exports=r},{"./_hashClear":146,"./_hashDelete":147,"./_hashGet":148,"./_hashHas":149,"./_hashSet":150}],49:[function(t,e,n){function r(t){var e=-1,n=t?t.length:0;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}var i=t("./_listCacheClear"),o=t("./_listCacheDelete"),s=t("./_listCacheGet"),a=t("./_listCacheHas"),c=t("./_listCacheSet");r.prototype.clear=i,r.prototype.delete=o,r.prototype.get=s,r.prototype.has=a,r.prototype.set=c,e.exports=r},{"./_listCacheClear":166,"./_listCacheDelete":167,"./_listCacheGet":168,"./_listCacheHas":169,"./_listCacheSet":170}],50:[function(t,e,n){var r=t("./_getNative"),i=t("./_root"),o=r(i,"Map");e.exports=o},{"./_getNative":139,"./_root":181}],51:[function(t,e,n){function r(t){var e=-1,n=t?t.length:0;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}var i=t("./_mapCacheClear"),o=t("./_mapCacheDelete"),s=t("./_mapCacheGet"),a=t("./_mapCacheHas"),c=t("./_mapCacheSet");r.prototype.clear=i,r.prototype.delete=o,r.prototype.get=s,r.prototype.has=a,r.prototype.set=c,e.exports=r},{"./_mapCacheClear":171,"./_mapCacheDelete":172,"./_mapCacheGet":173,"./_mapCacheHas":174,"./_mapCacheSet":175}],52:[function(t,e,n){var r=t("./_getNative"),i=t("./_root"),o=r(i,"Promise");e.exports=o},{"./_getNative":139,"./_root":181}],53:[function(t,e,n){var r=t("./_root"),i=r.Reflect;e.exports=i},{"./_root":181}],54:[function(t,e,n){var r=t("./_getNative"),i=t("./_root"),o=r(i,"Set");e.exports=o},{"./_getNative":139,"./_root":181}],55:[function(t,e,n){function r(t){var e=-1,n=t?t.length:0;for(this.__data__=new i;++e<n;)this.add(t[e])}var i=t("./_MapCache"),o=t("./_setCacheAdd"),s=t("./_setCacheHas");r.prototype.add=r.prototype.push=o,r.prototype.has=s,e.exports=r},{"./_MapCache":51,"./_setCacheAdd":182,"./_setCacheHas":183}],56:[function(t,e,n){function r(t){this.__data__=new i(t)}var i=t("./_ListCache"),o=t("./_stackClear"),s=t("./_stackDelete"),a=t("./_stackGet"),c=t("./_stackHas"),u=t("./_stackSet");r.prototype.clear=o,r.prototype.delete=s,r.prototype.get=a,r.prototype.has=c,r.prototype.set=u,e.exports=r},{"./_ListCache":49,"./_stackClear":185,"./_stackDelete":186,"./_stackGet":187,"./_stackHas":188,"./_stackSet":189}],57:[function(t,e,n){var r=t("./_root"),i=r.Symbol;e.exports=i},{"./_root":181}],58:[function(t,e,n){var r=t("./_root"),i=r.Uint8Array;e.exports=i},{"./_root":181}],59:[function(t,e,n){var r=t("./_getNative"),i=t("./_root"),o=r(i,"WeakMap");e.exports=o},{"./_getNative":139,"./_root":181}],60:[function(t,e,n){function r(t,e){return t.set(e[0],e[1]),t}e.exports=r},{}],61:[function(t,e,n){function r(t,e){return t.add(e),t}e.exports=r},{}],62:[function(t,e,n){function r(t,e,n){var r=n.length;switch(r){case 0:return t.call(e);case 1:return t.call(e,n[0]);case 2:return t.call(e,n[0],n[1]);case 3:return t.call(e,n[0],n[1],n[2])}return t.apply(e,n)}e.exports=r},{}],63:[function(t,e,n){function r(t,e){for(var n=-1,r=t?t.length:0;++n<r&&e(t[n],n,t)!==!1;);return t}e.exports=r},{}],64:[function(t,e,n){function r(t,e){for(var n=-1,r=t?t.length:0,i=0,o=[];++n<r;){var s=t[n];e(s,n,t)&&(o[i++]=s)}return o}e.exports=r},{}],65:[function(t,e,n){function r(t,e){var n=t?t.length:0;return!!n&&i(t,e,0)>-1}var i=t("./_baseIndexOf");e.exports=r},{"./_baseIndexOf":88}],66:[function(t,e,n){function r(t,e,n){for(var r=-1,i=t?t.length:0;++r<i;)if(n(e,t[r]))return!0;return!1}e.exports=r},{}],67:[function(t,e,n){function r(t,e){for(var n=-1,r=t?t.length:0,i=Array(r);++n<r;)i[n]=e(t[n],n,t);return i}e.exports=r},{}],68:[function(t,e,n){function r(t,e){for(var n=-1,r=e.length,i=t.length;++n<r;)t[i+n]=e[n];return t}e.exports=r},{}],69:[function(t,e,n){function r(t,e,n,r){var i=-1,o=t?t.length:0;for(r&&o&&(n=t[++i]);++i<o;)n=e(n,t[i],i,t);return n}e.exports=r},{}],70:[function(t,e,n){function r(t,e){for(var n=-1,r=t?t.length:0;++n<r;)if(e(t[n],n,t))return!0;return!1}e.exports=r},{}],71:[function(t,e,n){function r(t,e,n){var r=t[e];s.call(t,e)&&i(r,n)&&(void 0!==n||e in t)||(t[e]=n)}var i=t("./eq"),o=Object.prototype,s=o.hasOwnProperty;e.exports=r},{"./eq":199}],72:[function(t,e,n){function r(t,e){for(var n=t.length;n--;)if(i(t[n][0],e))return n;return-1}var i=t("./eq");e.exports=r},{"./eq":199}],73:[function(t,e,n){function r(t,e){return t&&i(e,o(e),t)}var i=t("./_copyObject"),o=t("./keys");e.exports=r},{"./_copyObject":122,"./keys":224}],74:[function(t,e,n){function r(t,e,n){return t===t&&(void 0!==n&&(t=t<=n?t:n),void 0!==e&&(t=t>=e?t:e)),t}e.exports=r},{}],75:[function(t,e,n){function r(t,e,n,b,C,E,O){var P;if(b&&(P=E?b(t,C,E,O):b(t)),void 0!==P)return P;if(!_(t))return t;var I=m(t);if(I){if(P=d(t),!e)return u(t,P)}else{var A=f(t),D=A==S||A==N;if(v(t))return c(t,e);if(A==T||A==w||D&&!E){if(y(t))return E?t:{};if(P=g(D?{}:t),!e)return h(t,a(P,t))}else{if(!W[A])return E?t:{};P=p(t,A,r,e)}}O||(O=new i);var M=O.get(t);if(M)return M;if(O.set(t,P),!I)var L=n?l(t):x(t);return o(L||t,function(i,o){L&&(o=i,i=t[o]),s(P,o,r(i,e,n,b,o,t,O))}),P}var i=t("./_Stack"),o=t("./_arrayEach"),s=t("./_assignValue"),a=t("./_baseAssign"),c=t("./_cloneBuffer"),u=t("./_copyArray"),h=t("./_copySymbols"),l=t("./_getAllKeys"),f=t("./_getTag"),d=t("./_initCloneArray"),p=t("./_initCloneByTag"),g=t("./_initCloneObject"),m=t("./isArray"),v=t("./isBuffer"),y=t("./_isHostObject"),_=t("./isObject"),x=t("./keys"),w="[object Arguments]",b="[object Array]",C="[object Boolean]",E="[object Date]",O="[object Error]",S="[object Function]",N="[object GeneratorFunction]",P="[object Map]",I="[object Number]",T="[object Object]",A="[object RegExp]",D="[object Set]",M="[object String]",L="[object Symbol]",k="[object WeakMap]",j="[object ArrayBuffer]",F="[object DataView]",B="[object Float32Array]",H="[object Float64Array]",R="[object Int8Array]",q="[object Int16Array]",U="[object Int32Array]",V="[object Uint8Array]",J="[object Uint8ClampedArray]",$="[object Uint16Array]",z="[object Uint32Array]",W={};W[w]=W[b]=W[j]=W[F]=W[C]=W[E]=W[B]=W[H]=W[R]=W[q]=W[U]=W[P]=W[I]=W[T]=W[A]=W[D]=W[M]=W[L]=W[V]=W[J]=W[$]=W[z]=!0,W[O]=W[S]=W[k]=!1,e.exports=r},{"./_Stack":56,"./_arrayEach":63,"./_assignValue":71,"./_baseAssign":73,"./_cloneBuffer":114,"./_copyArray":121,"./_copySymbols":123,"./_getAllKeys":134,"./_getTag":143,"./_initCloneArray":153,"./_initCloneByTag":154,"./_initCloneObject":155,"./_isHostObject":157,"./isArray":209,"./isBuffer":213,"./isObject":219,"./keys":224}],76:[function(t,e,n){function r(t){return i(t)?o(t):{}}var i=t("./isObject"),o=Object.create;e.exports=r},{"./isObject":219}],77:[function(t,e,n){function r(t,e,n,r){var l=-1,f=o,d=!0,p=t.length,g=[],m=e.length;if(!p)return g;n&&(e=a(e,c(n))),r?(f=s,d=!1):e.length>=h&&(f=u,d=!1,e=new i(e));t:for(;++l<p;){var v=t[l],y=n?n(v):v;if(v=r||0!==v?v:0,d&&y===y){for(var _=m;_--;)if(e[_]===y)continue t;g.push(v)}else f(e,y,r)||g.push(v)}return g}var i=t("./_SetCache"),o=t("./_arrayIncludes"),s=t("./_arrayIncludesWith"),a=t("./_arrayMap"),c=t("./_baseUnary"),u=t("./_cacheHas"),h=200;e.exports=r},{"./_SetCache":55,"./_arrayIncludes":65,"./_arrayIncludesWith":66,"./_arrayMap":67,"./_baseUnary":106,"./_cacheHas":109}],78:[function(t,e,n){var r=t("./_baseForOwn"),i=t("./_createBaseEach"),o=i(r);e.exports=o},{"./_baseForOwn":83,"./_createBaseEach":126}],79:[function(t,e,n){function r(t,e){var n=[];return i(t,function(t,r,i){e(t,r,i)&&n.push(t)}),n}var i=t("./_baseEach");e.exports=r},{"./_baseEach":78}],80:[function(t,e,n){function r(t,e,n,r){for(var i=t.length,o=n+(r?1:-1);r?o--:++o<i;)if(e(t[o],o,t))return o;return-1}e.exports=r},{}],81:[function(t,e,n){function r(t,e,n,s,a){var c=-1,u=t.length;for(n||(n=o),a||(a=[]);++c<u;){var h=t[c];e>0&&n(h)?e>1?r(h,e-1,n,s,a):i(a,h):s||(a[a.length]=h)}return a}var i=t("./_arrayPush"),o=t("./_isFlattenable");e.exports=r},{"./_arrayPush":68,"./_isFlattenable":156}],82:[function(t,e,n){var r=t("./_createBaseFor"),i=r();e.exports=i},{"./_createBaseFor":127}],83:[function(t,e,n){function r(t,e){return t&&i(t,e,o)}var i=t("./_baseFor"),o=t("./keys");e.exports=r},{"./_baseFor":82,"./keys":224}],84:[function(t,e,n){function r(t,e){e=o(e,t)?[e]:i(e);for(var n=0,r=e.length;null!=t&&n<r;)t=t[s(e[n++])];return n&&n==r?t:void 0}var i=t("./_castPath"),o=t("./_isKey"),s=t("./_toKey");e.exports=r},{"./_castPath":110,"./_isKey":160,"./_toKey":192}],85:[function(t,e,n){function r(t,e,n){var r=e(t);return o(t)?r:i(r,n(t))}var i=t("./_arrayPush"),o=t("./isArray");e.exports=r},{"./_arrayPush":68,"./isArray":209}],86:[function(t,e,n){function r(t,e){return null!=t&&(s.call(t,e)||"object"==typeof t&&e in t&&null===i(t))}var i=t("./_getPrototype"),o=Object.prototype,s=o.hasOwnProperty;e.exports=r},{"./_getPrototype":140}],87:[function(t,e,n){function r(t,e){return null!=t&&e in Object(t)}e.exports=r},{}],88:[function(t,e,n){function r(t,e,n){if(e!==e)return i(t,n);for(var r=n-1,o=t.length;++r<o;)if(t[r]===e)return r;return-1}var i=t("./_indexOfNaN");e.exports=r},{"./_indexOfNaN":152}],89:[function(t,e,n){function r(t,e,n,a,c){return t===e||(null==t||null==e||!o(t)&&!s(e)?t!==t&&e!==e:i(t,e,r,n,a,c))}var i=t("./_baseIsEqualDeep"),o=t("./isObject"),s=t("./isObjectLike");e.exports=r},{"./_baseIsEqualDeep":90,"./isObject":219,"./isObjectLike":220}],90:[function(t,e,n){function r(t,e,n,r,m,y){var _=u(t),x=u(e),w=p,b=p;_||(w=c(t),w=w==d?g:w),x||(b=c(e),b=b==d?g:b);var C=w==g&&!h(t),E=b==g&&!h(e),O=w==b;if(O&&!C)return y||(y=new i),_||l(t)?o(t,e,n,r,m,y):s(t,e,w,n,r,m,y);if(!(m&f)){var S=C&&v.call(t,"__wrapped__"),N=E&&v.call(e,"__wrapped__");if(S||N){var P=S?t.value():t,I=N?e.value():e;return y||(y=new i),n(P,I,r,m,y)}}return!!O&&(y||(y=new i),a(t,e,n,r,m,y))}var i=t("./_Stack"),o=t("./_equalArrays"),s=t("./_equalByTag"),a=t("./_equalObjects"),c=t("./_getTag"),u=t("./isArray"),h=t("./_isHostObject"),l=t("./isTypedArray"),f=2,d="[object Arguments]",p="[object Array]",g="[object Object]",m=Object.prototype,v=m.hasOwnProperty;e.exports=r},{"./_Stack":56,"./_equalArrays":131,"./_equalByTag":132,"./_equalObjects":133,"./_getTag":143,"./_isHostObject":157,"./isArray":209,"./isTypedArray":223}],91:[function(t,e,n){function r(t,e,n,r){var c=n.length,u=c,h=!r;if(null==t)return!u;for(t=Object(t);c--;){var l=n[c];if(h&&l[2]?l[1]!==t[l[0]]:!(l[0]in t))return!1}for(;++c<u;){l=n[c];var f=l[0],d=t[f],p=l[1];if(h&&l[2]){if(void 0===d&&!(f in t))return!1}else{var g=new i;if(r)var m=r(d,p,f,t,e,g);if(!(void 0===m?o(p,d,r,s|a,g):m))return!1}}return!0}var i=t("./_Stack"),o=t("./_baseIsEqual"),s=1,a=2;e.exports=r},{"./_Stack":56,"./_baseIsEqual":89}],92:[function(t,e,n){function r(t){if(!a(t)||s(t))return!1;var e=i(t)||o(t)?p:h;return e.test(c(t))}var i=t("./isFunction"),o=t("./_isHostObject"),s=t("./_isMasked"),a=t("./isObject"),c=t("./_toSource"),u=/[\\^$.*+?()[\]{}|]/g,h=/^\[object .+?Constructor\]$/,l=Object.prototype,f=Function.prototype.toString,d=l.hasOwnProperty,p=RegExp("^"+f.call(d).replace(u,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");e.exports=r},{"./_isHostObject":157,"./_isMasked":162,"./_toSource":193,"./isFunction":215,"./isObject":219}],93:[function(t,e,n){function r(t){return"function"==typeof t?t:null==t?s:"object"==typeof t?a(t)?o(t[0],t[1]):i(t):c(t)}var i=t("./_baseMatches"),o=t("./_baseMatchesProperty"),s=t("./identity"),a=t("./isArray"),c=t("./property");e.exports=r},{"./_baseMatches":97,"./_baseMatchesProperty":98,"./identity":207,"./isArray":209,"./property":231}],94:[function(t,e,n){function r(t){return i(Object(t))}var i=Object.keys;e.exports=r},{}],95:[function(t,e,n){function r(t){t=null==t?t:Object(t);var e=[];for(var n in t)e.push(n);return e}var i=t("./_Reflect"),o=t("./_iteratorToArray"),s=Object.prototype,a=i?i.enumerate:void 0,c=s.propertyIsEnumerable;
a&&!c.call({valueOf:1},"valueOf")&&(r=function(t){return o(a(t))}),e.exports=r},{"./_Reflect":53,"./_iteratorToArray":165}],96:[function(t,e,n){function r(t,e){var n=-1,r=o(t)?Array(t.length):[];return i(t,function(t,i,o){r[++n]=e(t,i,o)}),r}var i=t("./_baseEach"),o=t("./isArrayLike");e.exports=r},{"./_baseEach":78,"./isArrayLike":210}],97:[function(t,e,n){function r(t){var e=o(t);return 1==e.length&&e[0][2]?s(e[0][0],e[0][1]):function(n){return n===t||i(n,t,e)}}var i=t("./_baseIsMatch"),o=t("./_getMatchData"),s=t("./_matchesStrictComparable");e.exports=r},{"./_baseIsMatch":91,"./_getMatchData":138,"./_matchesStrictComparable":177}],98:[function(t,e,n){function r(t,e){return a(t)&&c(e)?u(h(t),e):function(n){var r=o(n,t);return void 0===r&&r===e?s(n,t):i(e,r,void 0,l|f)}}var i=t("./_baseIsEqual"),o=t("./get"),s=t("./hasIn"),a=t("./_isKey"),c=t("./_isStrictComparable"),u=t("./_matchesStrictComparable"),h=t("./_toKey"),l=1,f=2;e.exports=r},{"./_baseIsEqual":89,"./_isKey":160,"./_isStrictComparable":164,"./_matchesStrictComparable":177,"./_toKey":192,"./get":205,"./hasIn":206}],99:[function(t,e,n){function r(t,e){return t=Object(t),i(e,function(e,n){return n in t&&(e[n]=t[n]),e},{})}var i=t("./_arrayReduce");e.exports=r},{"./_arrayReduce":69}],100:[function(t,e,n){function r(t){return function(e){return null==e?void 0:e[t]}}e.exports=r},{}],101:[function(t,e,n){function r(t){return function(e){return i(e,t)}}var i=t("./_baseGet");e.exports=r},{"./_baseGet":84}],102:[function(t,e,n){function r(t,e,n,r){e=a(e,t)?[e]:o(e);for(var h=-1,l=e.length,f=l-1,d=t;null!=d&&++h<l;){var p=u(e[h]);if(c(d)){var g=n;if(h!=f){var m=d[p];g=r?r(m,p,d):void 0,void 0===g&&(g=null==m?s(e[h+1])?[]:{}:m)}i(d,p,g)}d=d[p]}return t}var i=t("./_assignValue"),o=t("./_castPath"),s=t("./_isIndex"),a=t("./_isKey"),c=t("./isObject"),u=t("./_toKey");e.exports=r},{"./_assignValue":71,"./_castPath":110,"./_isIndex":158,"./_isKey":160,"./_toKey":192,"./isObject":219}],103:[function(t,e,n){function r(t,e,n){var r=-1,i=t.length;e<0&&(e=-e>i?0:i+e),n=n>i?i:n,n<0&&(n+=i),i=e>n?0:n-e>>>0,e>>>=0;for(var o=Array(i);++r<i;)o[r]=t[r+e];return o}e.exports=r},{}],104:[function(t,e,n){function r(t,e){for(var n=-1,r=Array(t);++n<t;)r[n]=e(n);return r}e.exports=r},{}],105:[function(t,e,n){function r(t){if("string"==typeof t)return t;if(o(t))return c?c.call(t):"";var e=t+"";return"0"==e&&1/t==-s?"-0":e}var i=t("./_Symbol"),o=t("./isSymbol"),s=1/0,a=i?i.prototype:void 0,c=a?a.toString:void 0;e.exports=r},{"./_Symbol":57,"./isSymbol":222}],106:[function(t,e,n){function r(t){return function(e){return t(e)}}e.exports=r},{}],107:[function(t,e,n){function r(t,e,n){var r=-1,l=o,f=t.length,d=!0,p=[],g=p;if(n)d=!1,l=s;else if(f>=h){var m=e?null:c(t);if(m)return u(m);d=!1,l=a,g=new i}else g=e?[]:p;t:for(;++r<f;){var v=t[r],y=e?e(v):v;if(v=n||0!==v?v:0,d&&y===y){for(var _=g.length;_--;)if(g[_]===y)continue t;e&&g.push(y),p.push(v)}else l(g,y,n)||(g!==p&&g.push(y),p.push(v))}return p}var i=t("./_SetCache"),o=t("./_arrayIncludes"),s=t("./_arrayIncludesWith"),a=t("./_cacheHas"),c=t("./_createSet"),u=t("./_setToArray"),h=200;e.exports=r},{"./_SetCache":55,"./_arrayIncludes":65,"./_arrayIncludesWith":66,"./_cacheHas":109,"./_createSet":130,"./_setToArray":184}],108:[function(t,e,n){function r(t,e){e=s(e,t)?[e]:o(e),t=c(t,e);var n=u(a(e));return!(null!=t&&i(t,n))||delete t[n]}var i=t("./_baseHas"),o=t("./_castPath"),s=t("./_isKey"),a=t("./last"),c=t("./_parent"),u=t("./_toKey");e.exports=r},{"./_baseHas":86,"./_castPath":110,"./_isKey":160,"./_parent":179,"./_toKey":192,"./last":226}],109:[function(t,e,n){function r(t,e){return t.has(e)}e.exports=r},{}],110:[function(t,e,n){function r(t){return i(t)?t:o(t)}var i=t("./isArray"),o=t("./_stringToPath");e.exports=r},{"./_stringToPath":191,"./isArray":209}],111:[function(t,e,n){function r(t,e,n){var r=t.length;return n=void 0===n?r:n,!e&&n>=r?t:i(t,e,n)}var i=t("./_baseSlice");e.exports=r},{"./_baseSlice":103}],112:[function(t,e,n){function r(t){return t&&t.Object===Object?t:null}e.exports=r},{}],113:[function(t,e,n){function r(t){var e=new t.constructor(t.byteLength);return new i(e).set(new i(t)),e}var i=t("./_Uint8Array");e.exports=r},{"./_Uint8Array":58}],114:[function(t,e,n){function r(t,e){if(e)return t.slice();var n=new t.constructor(t.length);return t.copy(n),n}e.exports=r},{}],115:[function(t,e,n){function r(t,e){var n=e?i(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.byteLength)}var i=t("./_cloneArrayBuffer");e.exports=r},{"./_cloneArrayBuffer":113}],116:[function(t,e,n){function r(t,e,n){var r=e?n(s(t),!0):s(t);return o(r,i,new t.constructor)}var i=t("./_addMapEntry"),o=t("./_arrayReduce"),s=t("./_mapToArray");e.exports=r},{"./_addMapEntry":60,"./_arrayReduce":69,"./_mapToArray":176}],117:[function(t,e,n){function r(t){var e=new t.constructor(t.source,i.exec(t));return e.lastIndex=t.lastIndex,e}var i=/\w*$/;e.exports=r},{}],118:[function(t,e,n){function r(t,e,n){var r=e?n(s(t),!0):s(t);return o(r,i,new t.constructor)}var i=t("./_addSetEntry"),o=t("./_arrayReduce"),s=t("./_setToArray");e.exports=r},{"./_addSetEntry":61,"./_arrayReduce":69,"./_setToArray":184}],119:[function(t,e,n){function r(t){return s?Object(s.call(t)):{}}var i=t("./_Symbol"),o=i?i.prototype:void 0,s=o?o.valueOf:void 0;e.exports=r},{"./_Symbol":57}],120:[function(t,e,n){function r(t,e){var n=e?i(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.length)}var i=t("./_cloneArrayBuffer");e.exports=r},{"./_cloneArrayBuffer":113}],121:[function(t,e,n){function r(t,e){var n=-1,r=t.length;for(e||(e=Array(r));++n<r;)e[n]=t[n];return e}e.exports=r},{}],122:[function(t,e,n){function r(t,e,n,r){n||(n={});for(var o=-1,s=e.length;++o<s;){var a=e[o],c=r?r(n[a],t[a],a,n,t):t[a];i(n,a,c)}return n}var i=t("./_assignValue");e.exports=r},{"./_assignValue":71}],123:[function(t,e,n){function r(t,e){return i(t,o(t),e)}var i=t("./_copyObject"),o=t("./_getSymbols");e.exports=r},{"./_copyObject":122,"./_getSymbols":141}],124:[function(t,e,n){var r=t("./_root"),i=r["__core-js_shared__"];e.exports=i},{"./_root":181}],125:[function(t,e,n){function r(t){return o(function(e,n){var r=-1,o=n.length,s=o>1?n[o-1]:void 0,a=o>2?n[2]:void 0;for(s=t.length>3&&"function"==typeof s?(o--,s):void 0,a&&i(n[0],n[1],a)&&(s=o<3?void 0:s,o=1),e=Object(e);++r<o;){var c=n[r];c&&t(e,c,r,s)}return e})}var i=t("./_isIterateeCall"),o=t("./rest");e.exports=r},{"./_isIterateeCall":159,"./rest":232}],126:[function(t,e,n){function r(t,e){return function(n,r){if(null==n)return n;if(!i(n))return t(n,r);for(var o=n.length,s=e?o:-1,a=Object(n);(e?s--:++s<o)&&r(a[s],s,a)!==!1;);return n}}var i=t("./isArrayLike");e.exports=r},{"./isArrayLike":210}],127:[function(t,e,n){function r(t){return function(e,n,r){for(var i=-1,o=Object(e),s=r(e),a=s.length;a--;){var c=s[t?a:++i];if(n(o[c],c,o)===!1)break}return e}}e.exports=r},{}],128:[function(t,e,n){function r(t){return function(e){e=a(e);var n=o.test(e)?s(e):void 0,r=n?n[0]:e.charAt(0),c=n?i(n,1).join(""):e.slice(1);return r[t]()+c}}var i=t("./_castSlice"),o=t("./_reHasComplexSymbol"),s=t("./_stringToArray"),a=t("./toString");e.exports=r},{"./_castSlice":111,"./_reHasComplexSymbol":180,"./_stringToArray":190,"./toString":240}],129:[function(t,e,n){function r(t){return function(e,n,r){var a=Object(e);if(n=i(n,3),!o(e))var c=s(e);var u=t(c||e,function(t,e){return c&&(e=t,t=a[e]),n(t,e,a)},r);return u>-1?e[c?c[u]:u]:void 0}}var i=t("./_baseIteratee"),o=t("./isArrayLike"),s=t("./keys");e.exports=r},{"./_baseIteratee":93,"./isArrayLike":210,"./keys":224}],130:[function(t,e,n){var r=t("./_Set"),i=t("./noop"),o=t("./_setToArray"),s=1/0,a=r&&1/o(new r([,-0]))[1]==s?function(t){return new r(t)}:i;e.exports=a},{"./_Set":54,"./_setToArray":184,"./noop":229}],131:[function(t,e,n){function r(t,e,n,r,c,u){var h=c&a,l=t.length,f=e.length;if(l!=f&&!(h&&f>l))return!1;var d=u.get(t);if(d)return d==e;var p=-1,g=!0,m=c&s?new i:void 0;for(u.set(t,e);++p<l;){var v=t[p],y=e[p];if(r)var _=h?r(y,v,p,e,t,u):r(v,y,p,t,e,u);if(void 0!==_){if(_)continue;g=!1;break}if(m){if(!o(e,function(t,e){if(!m.has(e)&&(v===t||n(v,t,r,c,u)))return m.add(e)})){g=!1;break}}else if(v!==y&&!n(v,y,r,c,u)){g=!1;break}}return u.delete(t),g}var i=t("./_SetCache"),o=t("./_arraySome"),s=1,a=2;e.exports=r},{"./_SetCache":55,"./_arraySome":70}],132:[function(t,e,n){function r(t,e,n,r,i,b,E){switch(n){case w:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case x:return!(t.byteLength!=e.byteLength||!r(new o(t),new o(e)));case l:case f:return+t==+e;case d:return t.name==e.name&&t.message==e.message;case g:return t!=+t?e!=+e:t==+e;case m:case y:return t==e+"";case p:var O=a;case v:var S=b&h;if(O||(O=c),t.size!=e.size&&!S)return!1;var N=E.get(t);return N?N==e:(b|=u,E.set(t,e),s(O(t),O(e),r,i,b,E));case _:if(C)return C.call(t)==C.call(e)}return!1}var i=t("./_Symbol"),o=t("./_Uint8Array"),s=t("./_equalArrays"),a=t("./_mapToArray"),c=t("./_setToArray"),u=1,h=2,l="[object Boolean]",f="[object Date]",d="[object Error]",p="[object Map]",g="[object Number]",m="[object RegExp]",v="[object Set]",y="[object String]",_="[object Symbol]",x="[object ArrayBuffer]",w="[object DataView]",b=i?i.prototype:void 0,C=b?b.valueOf:void 0;e.exports=r},{"./_Symbol":57,"./_Uint8Array":58,"./_equalArrays":131,"./_mapToArray":176,"./_setToArray":184}],133:[function(t,e,n){function r(t,e,n,r,a,c){var u=a&s,h=o(t),l=h.length,f=o(e),d=f.length;if(l!=d&&!u)return!1;for(var p=l;p--;){var g=h[p];if(!(u?g in e:i(e,g)))return!1}var m=c.get(t);if(m)return m==e;var v=!0;c.set(t,e);for(var y=u;++p<l;){g=h[p];var _=t[g],x=e[g];if(r)var w=u?r(x,_,g,e,t,c):r(_,x,g,t,e,c);if(!(void 0===w?_===x||n(_,x,r,a,c):w)){v=!1;break}y||(y="constructor"==g)}if(v&&!y){var b=t.constructor,C=e.constructor;b!=C&&"constructor"in t&&"constructor"in e&&!("function"==typeof b&&b instanceof b&&"function"==typeof C&&C instanceof C)&&(v=!1)}return c.delete(t),v}var i=t("./_baseHas"),o=t("./keys"),s=2;e.exports=r},{"./_baseHas":86,"./keys":224}],134:[function(t,e,n){function r(t){return i(t,s,o)}var i=t("./_baseGetAllKeys"),o=t("./_getSymbols"),s=t("./keys");e.exports=r},{"./_baseGetAllKeys":85,"./_getSymbols":141,"./keys":224}],135:[function(t,e,n){function r(t){return i(t,s,o)}var i=t("./_baseGetAllKeys"),o=t("./_getSymbolsIn"),s=t("./keysIn");e.exports=r},{"./_baseGetAllKeys":85,"./_getSymbolsIn":142,"./keysIn":225}],136:[function(t,e,n){var r=t("./_baseProperty"),i=r("length");e.exports=i},{"./_baseProperty":100}],137:[function(t,e,n){function r(t,e){var n=t.__data__;return i(e)?n["string"==typeof e?"string":"hash"]:n.map}var i=t("./_isKeyable");e.exports=r},{"./_isKeyable":161}],138:[function(t,e,n){function r(t){for(var e=o(t),n=e.length;n--;){var r=e[n],s=t[r];e[n]=[r,s,i(s)]}return e}var i=t("./_isStrictComparable"),o=t("./keys");e.exports=r},{"./_isStrictComparable":164,"./keys":224}],139:[function(t,e,n){function r(t,e){var n=o(t,e);return i(n)?n:void 0}var i=t("./_baseIsNative"),o=t("./_getValue");e.exports=r},{"./_baseIsNative":92,"./_getValue":144}],140:[function(t,e,n){function r(t){return i(Object(t))}var i=Object.getPrototypeOf;e.exports=r},{}],141:[function(t,e,n){function r(t){return o(Object(t))}var i=t("./stubArray"),o=Object.getOwnPropertySymbols;o||(r=i),e.exports=r},{"./stubArray":235}],142:[function(t,e,n){var r=t("./_arrayPush"),i=t("./_getPrototype"),o=t("./_getSymbols"),s=Object.getOwnPropertySymbols,a=s?function(t){for(var e=[];t;)r(e,o(t)),t=i(t);return e}:o;e.exports=a},{"./_arrayPush":68,"./_getPrototype":140,"./_getSymbols":141}],143:[function(t,e,n){function r(t){return v.call(t)}var i=t("./_DataView"),o=t("./_Map"),s=t("./_Promise"),a=t("./_Set"),c=t("./_WeakMap"),u=t("./_toSource"),h="[object Map]",l="[object Object]",f="[object Promise]",d="[object Set]",p="[object WeakMap]",g="[object DataView]",m=Object.prototype,v=m.toString,y=u(i),_=u(o),x=u(s),w=u(a),b=u(c);(i&&r(new i(new ArrayBuffer(1)))!=g||o&&r(new o)!=h||s&&r(s.resolve())!=f||a&&r(new a)!=d||c&&r(new c)!=p)&&(r=function(t){var e=v.call(t),n=e==l?t.constructor:void 0,r=n?u(n):void 0;if(r)switch(r){case y:return g;case _:return h;case x:return f;case w:return d;case b:return p}return e}),e.exports=r},{"./_DataView":47,"./_Map":50,"./_Promise":52,"./_Set":54,"./_WeakMap":59,"./_toSource":193}],144:[function(t,e,n){function r(t,e){return null==t?void 0:t[e]}e.exports=r},{}],145:[function(t,e,n){function r(t,e,n){e=c(e,t)?[e]:i(e);for(var r,f=-1,d=e.length;++f<d;){var p=l(e[f]);if(!(r=null!=t&&n(t,p)))break;t=t[p]}if(r)return r;var d=t?t.length:0;return!!d&&u(d)&&a(p,d)&&(s(t)||h(t)||o(t))}var i=t("./_castPath"),o=t("./isArguments"),s=t("./isArray"),a=t("./_isIndex"),c=t("./_isKey"),u=t("./isLength"),h=t("./isString"),l=t("./_toKey");e.exports=r},{"./_castPath":110,"./_isIndex":158,"./_isKey":160,"./_toKey":192,"./isArguments":208,"./isArray":209,"./isLength":216,"./isString":221}],146:[function(t,e,n){function r(){this.__data__=i?i(null):{}}var i=t("./_nativeCreate");e.exports=r},{"./_nativeCreate":178}],147:[function(t,e,n){function r(t){return this.has(t)&&delete this.__data__[t]}e.exports=r},{}],148:[function(t,e,n){function r(t){var e=this.__data__;if(i){var n=e[t];return n===o?void 0:n}return a.call(e,t)?e[t]:void 0}var i=t("./_nativeCreate"),o="__lodash_hash_undefined__",s=Object.prototype,a=s.hasOwnProperty;e.exports=r},{"./_nativeCreate":178}],149:[function(t,e,n){function r(t){var e=this.__data__;return i?void 0!==e[t]:s.call(e,t)}var i=t("./_nativeCreate"),o=Object.prototype,s=o.hasOwnProperty;e.exports=r},{"./_nativeCreate":178}],150:[function(t,e,n){function r(t,e){var n=this.__data__;return n[t]=i&&void 0===e?o:e,this}var i=t("./_nativeCreate"),o="__lodash_hash_undefined__";e.exports=r},{"./_nativeCreate":178}],151:[function(t,e,n){function r(t){var e=t?t.length:void 0;return a(e)&&(s(t)||c(t)||o(t))?i(e,String):null}var i=t("./_baseTimes"),o=t("./isArguments"),s=t("./isArray"),a=t("./isLength"),c=t("./isString");e.exports=r},{"./_baseTimes":104,"./isArguments":208,"./isArray":209,"./isLength":216,"./isString":221}],152:[function(t,e,n){function r(t,e,n){for(var r=t.length,i=e+(n?1:-1);n?i--:++i<r;){var o=t[i];if(o!==o)return i}return-1}e.exports=r},{}],153:[function(t,e,n){function r(t){var e=t.length,n=t.constructor(e);return e&&"string"==typeof t[0]&&o.call(t,"index")&&(n.index=t.index,n.input=t.input),n}var i=Object.prototype,o=i.hasOwnProperty;e.exports=r},{}],154:[function(t,e,n){function r(t,e,n,r){var T=t.constructor;switch(e){case _:return i(t);case l:case f:return new T((+t));case x:return o(t,r);case w:case b:case C:case E:case O:case S:case N:case P:case I:return h(t,r);case d:return s(t,r,n);case p:case v:return new T(t);case g:return a(t);case m:return c(t,r,n);case y:return u(t)}}var i=t("./_cloneArrayBuffer"),o=t("./_cloneDataView"),s=t("./_cloneMap"),a=t("./_cloneRegExp"),c=t("./_cloneSet"),u=t("./_cloneSymbol"),h=t("./_cloneTypedArray"),l="[object Boolean]",f="[object Date]",d="[object Map]",p="[object Number]",g="[object RegExp]",m="[object Set]",v="[object String]",y="[object Symbol]",_="[object ArrayBuffer]",x="[object DataView]",w="[object Float32Array]",b="[object Float64Array]",C="[object Int8Array]",E="[object Int16Array]",O="[object Int32Array]",S="[object Uint8Array]",N="[object Uint8ClampedArray]",P="[object Uint16Array]",I="[object Uint32Array]";e.exports=r},{"./_cloneArrayBuffer":113,"./_cloneDataView":115,"./_cloneMap":116,"./_cloneRegExp":117,"./_cloneSet":118,"./_cloneSymbol":119,"./_cloneTypedArray":120}],155:[function(t,e,n){function r(t){return"function"!=typeof t.constructor||s(t)?{}:i(o(t))}var i=t("./_baseCreate"),o=t("./_getPrototype"),s=t("./_isPrototype");e.exports=r},{"./_baseCreate":76,"./_getPrototype":140,"./_isPrototype":163}],156:[function(t,e,n){function r(t){return o(t)||i(t)}var i=t("./isArguments"),o=t("./isArray");e.exports=r},{"./isArguments":208,"./isArray":209}],157:[function(t,e,n){function r(t){var e=!1;if(null!=t&&"function"!=typeof t.toString)try{e=!!(t+"")}catch(t){}return e}e.exports=r},{}],158:[function(t,e,n){function r(t,e){return e=null==e?i:e,!!e&&("number"==typeof t||o.test(t))&&t>-1&&t%1==0&&t<e}var i=9007199254740991,o=/^(?:0|[1-9]\d*)$/;e.exports=r},{}],159:[function(t,e,n){function r(t,e,n){if(!a(n))return!1;var r=typeof e;return!!("number"==r?o(n)&&s(e,n.length):"string"==r&&e in n)&&i(n[e],t)}var i=t("./eq"),o=t("./isArrayLike"),s=t("./_isIndex"),a=t("./isObject");e.exports=r},{"./_isIndex":158,"./eq":199,"./isArrayLike":210,"./isObject":219}],160:[function(t,e,n){function r(t,e){if(i(t))return!1;var n=typeof t;return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=t&&!o(t))||(a.test(t)||!s.test(t)||null!=e&&t in Object(e))}var i=t("./isArray"),o=t("./isSymbol"),s=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,a=/^\w*$/;e.exports=r},{"./isArray":209,"./isSymbol":222}],161:[function(t,e,n){function r(t){var e=typeof t;return"string"==e||"number"==e||"symbol"==e||"boolean"==e?"__proto__"!==t:null===t}e.exports=r},{}],162:[function(t,e,n){function r(t){return!!o&&o in t}var i=t("./_coreJsData"),o=function(){var t=/[^.]+$/.exec(i&&i.keys&&i.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}();e.exports=r},{"./_coreJsData":124}],163:[function(t,e,n){function r(t){var e=t&&t.constructor,n="function"==typeof e&&e.prototype||i;return t===n}var i=Object.prototype;e.exports=r},{}],164:[function(t,e,n){function r(t){return t===t&&!i(t)}var i=t("./isObject");e.exports=r},{"./isObject":219}],165:[function(t,e,n){function r(t){for(var e,n=[];!(e=t.next()).done;)n.push(e.value);return n}e.exports=r},{}],166:[function(t,e,n){function r(){this.__data__=[]}e.exports=r},{}],167:[function(t,e,n){function r(t){var e=this.__data__,n=i(e,t);if(n<0)return!1;var r=e.length-1;return n==r?e.pop():s.call(e,n,1),!0}var i=t("./_assocIndexOf"),o=Array.prototype,s=o.splice;e.exports=r},{"./_assocIndexOf":72}],168:[function(t,e,n){function r(t){var e=this.__data__,n=i(e,t);return n<0?void 0:e[n][1]}var i=t("./_assocIndexOf");e.exports=r},{"./_assocIndexOf":72}],169:[function(t,e,n){function r(t){return i(this.__data__,t)>-1}var i=t("./_assocIndexOf");e.exports=r},{"./_assocIndexOf":72}],170:[function(t,e,n){function r(t,e){var n=this.__data__,r=i(n,t);return r<0?n.push([t,e]):n[r][1]=e,this}var i=t("./_assocIndexOf");e.exports=r},{"./_assocIndexOf":72}],171:[function(t,e,n){function r(){this.__data__={hash:new i,map:new(s||o),string:new i}}var i=t("./_Hash"),o=t("./_ListCache"),s=t("./_Map");e.exports=r},{"./_Hash":48,"./_ListCache":49,"./_Map":50}],172:[function(t,e,n){function r(t){return i(this,t).delete(t)}var i=t("./_getMapData");e.exports=r},{"./_getMapData":137}],173:[function(t,e,n){function r(t){return i(this,t).get(t)}var i=t("./_getMapData");e.exports=r},{"./_getMapData":137}],174:[function(t,e,n){function r(t){return i(this,t).has(t)}var i=t("./_getMapData");e.exports=r},{"./_getMapData":137}],175:[function(t,e,n){function r(t,e){return i(this,t).set(t,e),this}var i=t("./_getMapData");e.exports=r},{"./_getMapData":137}],176:[function(t,e,n){function r(t){var e=-1,n=Array(t.size);return t.forEach(function(t,r){n[++e]=[r,t]}),n}e.exports=r},{}],177:[function(t,e,n){function r(t,e){return function(n){return null!=n&&(n[t]===e&&(void 0!==e||t in Object(n)))}}e.exports=r},{}],178:[function(t,e,n){var r=t("./_getNative"),i=r(Object,"create");e.exports=i},{"./_getNative":139}],179:[function(t,e,n){function r(t,e){return 1==e.length?t:i(t,o(e,0,-1))}var i=t("./_baseGet"),o=t("./_baseSlice");e.exports=r},{"./_baseGet":84,"./_baseSlice":103}],180:[function(t,e,n){var r="\\ud800-\\udfff",i="\\u0300-\\u036f\\ufe20-\\ufe23",o="\\u20d0-\\u20f0",s="\\ufe0e\\ufe0f",a="\\u200d",c=RegExp("["+a+r+i+o+s+"]");e.exports=c},{}],181:[function(t,e,n){(function(n){var r=t("./_checkGlobal"),i=r("object"==typeof n&&n),o=r("object"==typeof self&&self),s=r("object"==typeof this&&this),a=i||o||s||Function("return this")();e.exports=a}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./_checkGlobal":112}],182:[function(t,e,n){function r(t){return this.__data__.set(t,i),this}var i="__lodash_hash_undefined__";e.exports=r},{}],183:[function(t,e,n){function r(t){return this.__data__.has(t)}e.exports=r},{}],184:[function(t,e,n){function r(t){var e=-1,n=Array(t.size);return t.forEach(function(t){n[++e]=t}),n}e.exports=r},{}],185:[function(t,e,n){function r(){this.__data__=new i}var i=t("./_ListCache");e.exports=r},{"./_ListCache":49}],186:[function(t,e,n){function r(t){return this.__data__.delete(t)}e.exports=r},{}],187:[function(t,e,n){function r(t){return this.__data__.get(t)}e.exports=r},{}],188:[function(t,e,n){function r(t){return this.__data__.has(t)}e.exports=r},{}],189:[function(t,e,n){function r(t,e){var n=this.__data__;return n instanceof i&&n.__data__.length==s&&(n=this.__data__=new o(n.__data__)),n.set(t,e),this}var i=t("./_ListCache"),o=t("./_MapCache"),s=200;e.exports=r},{"./_ListCache":49,"./_MapCache":51}],190:[function(t,e,n){function r(t){return t.match(w)}var i="\\ud800-\\udfff",o="\\u0300-\\u036f\\ufe20-\\ufe23",s="\\u20d0-\\u20f0",a="\\ufe0e\\ufe0f",c="["+i+"]",u="["+o+s+"]",h="\\ud83c[\\udffb-\\udfff]",l="(?:"+u+"|"+h+")",f="[^"+i+"]",d="(?:\\ud83c[\\udde6-\\uddff]){2}",p="[\\ud800-\\udbff][\\udc00-\\udfff]",g="\\u200d",m=l+"?",v="["+a+"]?",y="(?:"+g+"(?:"+[f,d,p].join("|")+")"+v+m+")*",_=v+m+y,x="(?:"+[f+u+"?",u,d,p,c].join("|")+")",w=RegExp(h+"(?="+h+")|"+x+_,"g");e.exports=r},{}],191:[function(t,e,n){var r=t("./memoize"),i=t("./toString"),o=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(\.|\[\])(?:\4|$))/g,s=/\\(\\)?/g,a=r(function(t){var e=[];return i(t).replace(o,function(t,n,r,i){e.push(r?i.replace(s,"$1"):n||t)}),e});e.exports=a},{"./memoize":228,"./toString":240}],192:[function(t,e,n){function r(t){if("string"==typeof t||i(t))return t;var e=t+"";return"0"==e&&1/t==-o?"-0":e}var i=t("./isSymbol"),o=1/0;e.exports=r},{"./isSymbol":222}],193:[function(t,e,n){function r(t){if(null!=t){try{return i.call(t)}catch(t){}try{return t+""}catch(t){}}return""}var i=Function.prototype.toString;e.exports=r},{}],194:[function(t,e,n){var r=t("./_assignValue"),i=t("./_copyObject"),o=t("./_createAssigner"),s=t("./isArrayLike"),a=t("./_isPrototype"),c=t("./keysIn"),u=Object.prototype,h=u.propertyIsEnumerable,l=!h.call({valueOf:1},"valueOf"),f=o(function(t,e){if(l||a(e)||s(e))return void i(e,c(e),t);for(var n in e)r(t,n,e[n])});e.exports=f},{"./_assignValue":71,"./_copyObject":122,"./_createAssigner":125,"./_isPrototype":163,"./isArrayLike":210,"./keysIn":225}],195:[function(t,e,n){function r(t){return o(i(t).toLowerCase())}var i=t("./toString"),o=t("./upperFirst");e.exports=r},{"./toString":240,"./upperFirst":243}],196:[function(t,e,n){function r(t){return i(t,!1,!0)}var i=t("./_baseClone");e.exports=r},{"./_baseClone":75}],197:[function(t,e,n){function r(t){return i(t,!0,!0)}var i=t("./_baseClone");e.exports=r},{"./_baseClone":75}],198:[function(t,e,n){e.exports=t("./forEach")},{"./forEach":204}],199:[function(t,e,n){function r(t,e){return t===e||t!==t&&e!==e}e.exports=r},{}],200:[function(t,e,n){e.exports=t("./assignIn")},{"./assignIn":194}],201:[function(t,e,n){function r(t,e){var n=a(t)?i:o;return n(t,s(e,3))}var i=t("./_arrayFilter"),o=t("./_baseFilter"),s=t("./_baseIteratee"),a=t("./isArray");e.exports=r},{"./_arrayFilter":64,"./_baseFilter":79,"./_baseIteratee":93,"./isArray":209}],202:[function(t,e,n){var r=t("./_createFind"),i=t("./findIndex"),o=r(i);e.exports=o},{"./_createFind":129,"./findIndex":203}],203:[function(t,e,n){function r(t,e,n){var r=t?t.length:0;if(!r)return-1;var c=null==n?0:s(n);return c<0&&(c=a(r+c,0)),i(t,o(e,3),c)}var i=t("./_baseFindIndex"),o=t("./_baseIteratee"),s=t("./toInteger"),a=Math.max;e.exports=r},{"./_baseFindIndex":80,"./_baseIteratee":93,"./toInteger":238}],204:[function(t,e,n){function r(t,e){var n=a(t)?i:o;return n(t,s(e,3))}var i=t("./_arrayEach"),o=t("./_baseEach"),s=t("./_baseIteratee"),a=t("./isArray");e.exports=r},{"./_arrayEach":63,"./_baseEach":78,"./_baseIteratee":93,"./isArray":209}],205:[function(t,e,n){function r(t,e,n){var r=null==t?void 0:i(t,e);return void 0===r?n:r}var i=t("./_baseGet");e.exports=r},{"./_baseGet":84}],206:[function(t,e,n){function r(t,e){return null!=t&&o(t,e,i)}var i=t("./_baseHasIn"),o=t("./_hasPath");e.exports=r},{"./_baseHasIn":87,"./_hasPath":145}],207:[function(t,e,n){function r(t){return t}e.exports=r},{}],208:[function(t,e,n){function r(t){return i(t)&&a.call(t,"callee")&&(!u.call(t,"callee")||c.call(t)==o)}var i=t("./isArrayLikeObject"),o="[object Arguments]",s=Object.prototype,a=s.hasOwnProperty,c=s.toString,u=s.propertyIsEnumerable;e.exports=r},{"./isArrayLikeObject":211}],209:[function(t,e,n){var r=Array.isArray;e.exports=r},{}],210:[function(t,e,n){function r(t){return null!=t&&s(i(t))&&!o(t)}var i=t("./_getLength"),o=t("./isFunction"),s=t("./isLength");e.exports=r},{"./_getLength":136,"./isFunction":215,"./isLength":216}],211:[function(t,e,n){function r(t){return o(t)&&i(t)}var i=t("./isArrayLike"),o=t("./isObjectLike");e.exports=r},{"./isArrayLike":210,"./isObjectLike":220}],212:[function(t,e,n){function r(t){return t===!0||t===!1||i(t)&&a.call(t)==o}var i=t("./isObjectLike"),o="[object Boolean]",s=Object.prototype,a=s.toString;e.exports=r},{"./isObjectLike":220}],213:[function(t,e,n){var r=t("./_root"),i=t("./stubFalse"),o="object"==typeof n&&n,s=o&&"object"==typeof e&&e,a=s&&s.exports===o,c=a?r.Buffer:void 0,u=c?function(t){return t instanceof c}:i;e.exports=u},{"./_root":181,"./stubFalse":236}],214:[function(t,e,n){function r(t,e){return i(t,e)}var i=t("./_baseIsEqual");e.exports=r},{"./_baseIsEqual":89}],215:[function(t,e,n){function r(t){var e=i(t)?c.call(t):"";return e==o||e==s}var i=t("./isObject"),o="[object Function]",s="[object GeneratorFunction]",a=Object.prototype,c=a.toString;e.exports=r},{"./isObject":219}],216:[function(t,e,n){function r(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=i}var i=9007199254740991;e.exports=r},{}],217:[function(t,e,n){function r(t,e){return t===e||i(t,e,o(e))}var i=t("./_baseIsMatch"),o=t("./_getMatchData");e.exports=r},{"./_baseIsMatch":91,"./_getMatchData":138}],218:[function(t,e,n){function r(t){return"number"==typeof t||i(t)&&a.call(t)==o}var i=t("./isObjectLike"),o="[object Number]",s=Object.prototype,a=s.toString;e.exports=r},{"./isObjectLike":220}],219:[function(t,e,n){function r(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}e.exports=r},{}],220:[function(t,e,n){function r(t){return!!t&&"object"==typeof t}e.exports=r},{}],221:[function(t,e,n){function r(t){return"string"==typeof t||!i(t)&&o(t)&&c.call(t)==s}var i=t("./isArray"),o=t("./isObjectLike"),s="[object String]",a=Object.prototype,c=a.toString;e.exports=r},{"./isArray":209,"./isObjectLike":220}],222:[function(t,e,n){function r(t){return"symbol"==typeof t||i(t)&&a.call(t)==o}var i=t("./isObjectLike"),o="[object Symbol]",s=Object.prototype,a=s.toString;e.exports=r},{"./isObjectLike":220}],223:[function(t,e,n){function r(t){return o(t)&&i(t.length)&&!!T[D.call(t)]}var i=t("./isLength"),o=t("./isObjectLike"),s="[object Arguments]",a="[object Array]",c="[object Boolean]",u="[object Date]",h="[object Error]",l="[object Function]",f="[object Map]",d="[object Number]",p="[object Object]",g="[object RegExp]",m="[object Set]",v="[object String]",y="[object WeakMap]",_="[object ArrayBuffer]",x="[object DataView]",w="[object Float32Array]",b="[object Float64Array]",C="[object Int8Array]",E="[object Int16Array]",O="[object Int32Array]",S="[object Uint8Array]",N="[object Uint8ClampedArray]",P="[object Uint16Array]",I="[object Uint32Array]",T={};T[w]=T[b]=T[C]=T[E]=T[O]=T[S]=T[N]=T[P]=T[I]=!0,T[s]=T[a]=T[_]=T[c]=T[x]=T[u]=T[h]=T[l]=T[f]=T[d]=T[p]=T[g]=T[m]=T[v]=T[y]=!1;var A=Object.prototype,D=A.toString;e.exports=r},{"./isLength":216,"./isObjectLike":220}],224:[function(t,e,n){function r(t){var e=u(t);if(!e&&!a(t))return o(t);var n=s(t),r=!!n,h=n||[],l=h.length;for(var f in t)!i(t,f)||r&&("length"==f||c(f,l))||e&&"constructor"==f||h.push(f);return h}var i=t("./_baseHas"),o=t("./_baseKeys"),s=t("./_indexKeys"),a=t("./isArrayLike"),c=t("./_isIndex"),u=t("./_isPrototype");e.exports=r},{"./_baseHas":86,"./_baseKeys":94,"./_indexKeys":151,"./_isIndex":158,"./_isPrototype":163,"./isArrayLike":210}],225:[function(t,e,n){function r(t){for(var e=-1,n=a(t),r=i(t),c=r.length,h=o(t),l=!!h,f=h||[],d=f.length;++e<c;){var p=r[e];l&&("length"==p||s(p,d))||"constructor"==p&&(n||!u.call(t,p))||f.push(p)}return f}var i=t("./_baseKeysIn"),o=t("./_indexKeys"),s=t("./_isIndex"),a=t("./_isPrototype"),c=Object.prototype,u=c.hasOwnProperty;e.exports=r},{"./_baseKeysIn":95,"./_indexKeys":151,"./_isIndex":158,"./_isPrototype":163}],226:[function(t,e,n){function r(t){var e=t?t.length:0;return e?t[e-1]:void 0}e.exports=r},{}],227:[function(t,e,n){function r(t,e){var n=a(t)?i:s;return n(t,o(e,3))}var i=t("./_arrayMap"),o=t("./_baseIteratee"),s=t("./_baseMap"),a=t("./isArray");e.exports=r},{"./_arrayMap":67,"./_baseIteratee":93,"./_baseMap":96,"./isArray":209}],228:[function(t,e,n){function r(t,e){if("function"!=typeof t||e&&"function"!=typeof e)throw new TypeError(o);var n=function(){var r=arguments,i=e?e.apply(this,r):r[0],o=n.cache;if(o.has(i))return o.get(i);var s=t.apply(this,r);return n.cache=o.set(i,s),s};return n.cache=new(r.Cache||i),n}var i=t("./_MapCache"),o="Expected a function";r.Cache=i,e.exports=r},{"./_MapCache":51}],229:[function(t,e,n){function r(){}e.exports=r},{}],230:[function(t,e,n){var r=t("./_arrayMap"),i=t("./_baseDifference"),o=t("./_baseFlatten"),s=t("./_basePick"),a=t("./_getAllKeysIn"),c=t("./rest"),u=t("./_toKey"),h=c(function(t,e){return null==t?{}:(e=r(o(e,1),u),s(t,i(a(t),e)))});e.exports=h},{"./_arrayMap":67,"./_baseDifference":77,"./_baseFlatten":81,"./_basePick":99,"./_getAllKeysIn":135,"./_toKey":192,"./rest":232}],231:[function(t,e,n){function r(t){return s(t)?i(a(t)):o(t)}var i=t("./_baseProperty"),o=t("./_basePropertyDeep"),s=t("./_isKey"),a=t("./_toKey");e.exports=r},{"./_baseProperty":100,"./_basePropertyDeep":101,"./_isKey":160,"./_toKey":192}],232:[function(t,e,n){function r(t,e){if("function"!=typeof t)throw new TypeError(s);return e=a(void 0===e?t.length-1:o(e),0),function(){for(var n=arguments,r=-1,o=a(n.length-e,0),s=Array(o);++r<o;)s[r]=n[e+r];switch(e){case 0:return t.call(this,s);case 1:return t.call(this,n[0],s);case 2:return t.call(this,n[0],n[1],s)}var c=Array(e+1);for(r=-1;++r<e;)c[r]=n[r];return c[e]=s,i(t,this,c)}}var i=t("./_apply"),o=t("./toInteger"),s="Expected a function",a=Math.max;e.exports=r},{"./_apply":62,"./toInteger":238}],233:[function(t,e,n){function r(t,e,n,r){return r="function"==typeof r?r:void 0,null==t?t:i(t,e,n,r)}var i=t("./_baseSet");e.exports=r},{"./_baseSet":102}],234:[function(t,e,n){function r(t,e,n){return t=a(t),n=i(s(n),0,t.length),t.lastIndexOf(o(e),n)==n}var i=t("./_baseClamp"),o=t("./_baseToString"),s=t("./toInteger"),a=t("./toString");e.exports=r},{"./_baseClamp":74,"./_baseToString":105,"./toInteger":238,"./toString":240}],235:[function(t,e,n){function r(){return[]}e.exports=r},{}],236:[function(t,e,n){function r(){return!1}e.exports=r},{}],237:[function(t,e,n){function r(t){if(!t)return 0===t?t:0;if(t=i(t),t===o||t===-o){var e=t<0?-1:1;return e*s}return t===t?t:0}var i=t("./toNumber"),o=1/0,s=1.7976931348623157e308;e.exports=r},{"./toNumber":239}],238:[function(t,e,n){function r(t){var e=i(t),n=e%1;return e===e?n?e-n:e:0}var i=t("./toFinite");e.exports=r},{"./toFinite":237}],239:[function(t,e,n){function r(t){if("number"==typeof t)return t;if(s(t))return a;if(o(t)){var e=i(t.valueOf)?t.valueOf():t;t=o(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=t.replace(c,"");var n=h.test(t);return n||l.test(t)?f(t.slice(2),n?2:8):u.test(t)?a:+t}var i=t("./isFunction"),o=t("./isObject"),s=t("./isSymbol"),a=NaN,c=/^\s+|\s+$/g,u=/^[-+]0x[0-9a-f]+$/i,h=/^0b[01]+$/i,l=/^0o[0-7]+$/i,f=parseInt;e.exports=r},{"./isFunction":215,"./isObject":219,"./isSymbol":222
}],240:[function(t,e,n){function r(t){return null==t?"":i(t)}var i=t("./_baseToString");e.exports=r},{"./_baseToString":105}],241:[function(t,e,n){function r(t){return t&&t.length?i(t):[]}var i=t("./_baseUniq");e.exports=r},{"./_baseUniq":107}],242:[function(t,e,n){function r(t,e){return null==t||i(t,e)}var i=t("./_baseUnset");e.exports=r},{"./_baseUnset":108}],243:[function(t,e,n){var r=t("./_createCaseFirst"),i=r("toUpperCase");e.exports=i},{"./_createCaseFirst":128}],244:[function(t,e,n){var r=t("./_baseDifference"),i=t("./isArrayLikeObject"),o=t("./rest"),s=o(function(t,e){return i(t)?r(t,e):[]});e.exports=s},{"./_baseDifference":77,"./isArrayLikeObject":211,"./rest":232}],245:[function(t,e,n){"use strict";e.exports={name:"base",configure:function(e){e.addCommand(t("./SwitchTextTypeCommand")),e.addCommand(t("./UndoCommand")),e.addCommand(t("./RedoCommand")),e.addTool(t("./UndoTool")),e.addTool(t("./RedoTool")),e.addTool(t("./SwitchTextTypeTool")),e.addIcon("undo",{fontawesome:"fa-undo"}),e.addIcon("redo",{fontawesome:"fa-repeat"}),e.addIcon("edit",{fontawesome:"fa-cog"}),e.addIcon("delete",{fontawesome:"fa-times"}),e.addIcon("expand",{fontawesome:"fa-arrows-h"}),e.addIcon("truncate",{fontawesome:"fa-arrows-h"}),e.addLabel("undo",{en:"Undo",de:"Rückgängig"}),e.addLabel("redo",{en:"Redo",de:"Wiederherstellen"}),e.addLabel("container-selection",{en:"Container",de:"Container"}),e.addLabel("container",{en:"Container",de:"Container"}),e.addLabel("insert-container",{en:"Insert Container",de:"Container einfügen"})}}},{"./RedoCommand":246,"./RedoTool":247,"./SwitchTextTypeCommand":248,"./SwitchTextTypeTool":249,"./UndoCommand":250,"./UndoTool":251}],246:[function(t,e,n){"use strict";function r(){r.super.apply(this,arguments)}var i=t("../../ui/Command");r.Prototype=function(){this.getCommandState=function(t,e){var n=e.documentSession;return{disabled:!n.canRedo(),active:!1}},this.execute=function(t,e){var n=e.documentSession;return!!n.canRedo()&&(n.redo(),!0)}},i.extend(r),r.static.name="redo",e.exports=r},{"../../ui/Command":318}],247:[function(t,e,n){"use strict";function r(){r.super.apply(this,arguments)}var i=t("../../ui/Tool");i.extend(r),r.static.name="redo",e.exports=r},{"../../ui/Tool":331}],248:[function(t,e,n){"use strict";function r(){i.apply(this,arguments)}var i=t("../../ui/Command"),o=t("lodash/isMatch"),s=t("lodash/find"),a=t("lodash/clone");r.Prototype=function(){this.getTextTypes=function(t){var e=t.surfaceManager.getFocusedSurface();return e&&e.isContainerEditor()?e.getTextTypes():[]},this.getTextType=function(t,e){var n=this.getTextTypes(t);return s(n,function(t){return t.name===e})},this.getCurrentTextType=function(t,e){var n,r=this.getTextTypes(t);return r.forEach(function(t){var r=a(t.data);delete r.type,o(e,r)&&e.type===t.data.type&&(n=t)}),n},this.getCommandState=function(t,e){var n,r=e.documentSession.getDocument(),i=e.documentSession.getSelection(),o=e.surfaceManager.getFocusedSurface(),s={disabled:!1,textTypes:this.getTextTypes(e)};if(o&&o.isEnabled()&&!i.isNull())if(i.isContainerSelection())s.disabled=!0,s.currentTextType={name:"container-selection"};else if(i.isPropertySelection()){var a=i.getPath();n=r.get(a[0]),n&&(n.isText()&&n.isBlock()&&(s.currentTextType=this.getCurrentTextType(e,n)),s.currentTextType||(s.currentTextType={name:[n.type,a[1]].join(".")},s.disabled=!0))}else i.isNodeSelection()?(n=r.get(i.getNodeId()),s.currentTextType={name:n.type},s.disabled=!0):i.isCustomSelection()&&(s.currentTextType={name:"custom"},s.disabled=!0);else s.disabled=!0;return s},this.execute=function(t,e){var n=this.getTextType(e,t.textType),r=n.data,i=e.surfaceManager.getFocusedSurface();return i?(i.transaction(function(t,e){return e.data=r,i.switchType(t,e)}),r):void console.warn("No focused surface. Stopping command execution.")}},i.extend(r),r.static.name="switch-text-type",e.exports=r},{"../../ui/Command":318,"lodash/clone":196,"lodash/find":202,"lodash/isMatch":217}],249:[function(t,e,n){"use strict";function r(){r.super.apply(this,arguments),this._navIdx=-1}var i=t("lodash/each"),o=t("../../ui/Tool"),s=t("../../util/keys");r.Prototype=function(){var t=r.super.prototype;this.didMount=function(){t.didMount.call(this),this._focusToggle()},this.render=function(t){var e=this.context.labelProvider,n="No selection";this.props.currentTextType&&(n=this.props.currentTextType.name);var r=t("div").addClass("sc-switch-text-type"),o=t("button").ref("toggle").addClass("se-toggle").attr("title",e.getLabel("switch_text")).append(e.getLabel(n)).on("click",this.toggleAvailableTextTypes);if(this.props.disabled||!this.props.currentTextType?(r.addClass("sm-disabled"),o.attr("tabindex",-1)):o.attr("tabindex",1),r.append(o),this.state.open){r.addClass("sm-open");var s=t("div").addClass("se-options").ref("options");i(this.props.textTypes,function(n){var r=t("button").addClass("se-option sm-"+n.name).attr("data-type",n.name).append(e.getLabel(n.name)).on("click",this.handleClick);s.append(r)}.bind(this)),r.append(s),r.on("keydown",this.onKeydown)}return r},this.didUpdate=function(){this._focusToggle()},this._focusToggle=function(){this.state.open&&this.refs.toggle.focus()},this.executeCommand=function(t){this.context.commandManager.executeCommand("switch-text-type",{textType:t})},this.getTextCommands=function(){var t=this.getSurface();return!this.textCommands&&t&&(this.textCommands=t.getTextCommands()),this.textCommands||{}},this.handleClick=function(t){t.preventDefault(),this.executeCommand(t.currentTarget.dataset.type)},this.onKeydown=function(t){var e=!1;switch(t.keyCode){case s.UP:this._nav(-1),e=!0;break;case s.DOWN:this._nav(1),e=!0;break;case s.ESCAPE:this.toggleDropdown(),e=!0}e&&(t.preventDefault(),t.stopPropagation())},this.toggleAvailableTextTypes=function(t){t.preventDefault(),t.stopPropagation(),this.props.disabled||this.toggleDropdown()},this.toggleDropdown=function(){this._navIdx=-1,this.extendState({open:!this.state.open})},this._nav=function(t){if(this._navIdx+=t,this._navIdx=Math.max(0,this._navIdx),this._navIdx=Math.min(this._getOptionsCount()-1,this._navIdx),this._navIdx>=0){var e=this.refs.options.children[this._navIdx];e.focus()}},this._getOptionsCount=function(){return this.refs.options.children.length}},o.extend(r),r.static.name="switch-text-type",e.exports=r},{"../../ui/Tool":331,"../../util/keys":341,"lodash/each":198}],250:[function(t,e,n){"use strict";function r(){r.super.apply(this,arguments)}var i=t("../../ui/Command");r.Prototype=function(){this.getCommandState=function(t,e){var n=e.documentSession;return{disabled:!n.canUndo(),active:!1}},this.execute=function(t,e){var n=e.documentSession;return!!n.canUndo()&&(n.undo(),!0)}},i.extend(r),r.static.name="undo",e.exports=r},{"../../ui/Command":318}],251:[function(t,e,n){"use strict";function r(){r.super.apply(this,arguments)}var i=t("../../ui/Tool");i.extend(r),r.static.name="undo",e.exports=r},{"../../ui/Tool":331}],252:[function(t,e,n){"use strict";function r(){r.super.apply(this,arguments)}var i=t("../../model/TextBlock");i.extend(r),r.static.name="blockquote",e.exports=r},{"../../model/TextBlock":22}],253:[function(t,e,n){"use strict";function r(){r.super.apply(this,arguments)}var i=t("../../ui/TextBlockComponent");r.Prototype=function(){var t=r.super.prototype;this.render=function(e){var n=t.render.call(this,e);return n.addClass("sc-blockquote")}},i.extend(r),e.exports=r},{"../../ui/TextBlockComponent":329}],254:[function(t,e,n){"use strict";e.exports={type:"blockquote",tagName:"blockquote",import:function(t,e,n){e.content=n.annotatedText(t,[e.id,"content"])},export:function(t,e,n){e.append(n.annotatedText([t.id,"content"]))}}},{}],255:[function(t,e,n){"use strict";var r=t("./Blockquote"),i=t("./BlockquoteComponent"),o=t("./BlockquoteHTMLConverter");e.exports={name:"blockquote",configure:function(t){t.addNode(r),t.addComponent(r.static.name,i),t.addConverter("html",o),t.addTextType({name:"blockquote",data:{type:"blockquote"}}),t.addLabel("blockquote",{en:"Blockquote",de:"Blockzitat"})}}},{"./Blockquote":252,"./BlockquoteComponent":253,"./BlockquoteHTMLConverter":254}],256:[function(t,e,n){"use strict";function r(){r.super.apply(this,arguments)}var i=t("../../model/PropertyAnnotation");i.extend(r),r.static.name="code",e.exports=r},{"../../model/PropertyAnnotation":18}],257:[function(t,e,n){"use strict";var r=t("../../ui/AnnotationCommand"),i=r.extend();i.static.name="code",e.exports=i},{"../../ui/AnnotationCommand":312}],258:[function(t,e,n){"use strict";var r=t("./Code"),i=t("./CodeTool"),o=t("./CodeCommand");e.exports={name:"code",configure:function(t){t.addNode(r),t.addCommand(o),t.addTool(i),t.addIcon("code",{fontawesome:"fa-code"}),t.addLabel("code",{en:"Code",de:"Code"})}}},{"./Code":256,"./CodeCommand":257,"./CodeTool":259}],259:[function(t,e,n){"use strict";function r(){i.apply(this,arguments)}var i=t("../../ui/AnnotationTool");i.extend(r),r.static.name="code",e.exports=r},{"../../ui/AnnotationTool":314}],260:[function(t,e,n){"use strict";function r(){r.super.apply(this,arguments)}var i=t("../../model/TextBlock");i.extend(r),r.static.name="codeblock",e.exports=r},{"../../model/TextBlock":22}],261:[function(t,e,n){"use strict";function r(){r.super.apply(this,arguments)}var i=t("../../ui/TextBlockComponent");r.Prototype=function(){var t=r.super.prototype;this.render=function(e){var n=t.render.call(this,e);return n.addClass("sc-codeblock")}},i.extend(r),e.exports=r},{"../../ui/TextBlockComponent":329}],262:[function(t,e,n){"use strict";e.exports={type:"codeblock",tagName:"pre",import:function(t,e,n){var r=t.find("code");r&&(e.content=n.annotatedText(r,[e.id,"content"],{preserveWhitespace:!0}))},export:function(t,e,n){var r=n.$$;e.append(r("code").append(n.annotatedText([t.id,"content"])))}}},{}],263:[function(t,e,n){"use strict";var r=t("./Codeblock"),i=t("./CodeblockComponent"),o=t("./CodeblockHTMLConverter");e.exports={name:"codeblock",configure:function(t){t.addNode(r),t.addComponent(r.static.name,i),t.addConverter("html",o),t.addTextType({name:"codeblock",data:{type:"codeblock"}}),t.addLabel("codeblock",{en:"Codeblock",de:"Codeblock"})}}},{"./Codeblock":260,"./CodeblockComponent":261,"./CodeblockHTMLConverter":262}],264:[function(t,e,n){"use strict";function r(){r.super.apply(this,arguments)}var i=t("../../model/PropertyAnnotation"),o=t("../../model/Fragmenter");i.extend(r),r.static.name="emphasis",r.static.fragmentation=o.ANY,e.exports=r},{"../../model/Fragmenter":14,"../../model/PropertyAnnotation":18}],265:[function(t,e,n){"use strict";function r(){r.super.apply(this,arguments)}var i=t("../../ui/AnnotationCommand");i.extend(r),r.static.name="emphasis",e.exports=r},{"../../ui/AnnotationCommand":312}],266:[function(t,e,n){"use strict";e.exports={type:"emphasis",tagName:"em",matchElement:function(t){return t.is("em, i")}}},{}],267:[function(t,e,n){"use strict";var r=t("./Emphasis"),i=t("./EmphasisTool"),o=t("./EmphasisCommand"),s=t("./EmphasisHTMLConverter"),a=t("./EmphasisXMLConverter");e.exports={name:"emphasis",configure:function(t){t.addNode(r),t.addCommand(o),t.addTool(i),t.addConverter("html",s),t.addConverter("xml",a),t.addIcon("emphasis",{fontawesome:"fa-italic"}),t.addLabel("emphasis",{en:"Emphasis",de:"Betonung"})}}},{"./Emphasis":264,"./EmphasisCommand":265,"./EmphasisHTMLConverter":266,"./EmphasisTool":268,"./EmphasisXMLConverter":269}],268:[function(t,e,n){"use strict";function r(){r.super.apply(this,arguments)}var i=t("../../ui/AnnotationTool");i.extend(r),r.static.name="emphasis",e.exports=r},{"../../ui/AnnotationTool":314}],269:[function(t,e,n){"use strict";e.exports=t("./EmphasisHTMLConverter")},{"./EmphasisHTMLConverter":266}],270:[function(t,e,n){"use strict";function r(){r.super.apply(this,arguments)}var i=t("../../model/TextBlock");i.extend(r),r.static.name="heading",r.static.defineSchema({level:{type:"number",default:1}}),e.exports=r},{"../../model/TextBlock":22}],271:[function(t,e,n){"use strict";function r(){r.super.apply(this,arguments)}var i=t("../../ui/TextBlockComponent");r.Prototype=function(){var t=r.super.prototype;this.render=function(e){var n=t.render.call(this,e);return n.addClass("sc-heading sm-level-"+this.props.node.level)}},i.extend(r),e.exports=r},{"../../ui/TextBlockComponent":329}],272:[function(t,e,n){"use strict";e.exports={type:"heading",matchElement:function(t){return/^h\d$/.exec(t.tagName)},import:function(t,e,n){e.level=Number(t.tagName[1]),e.content=n.annotatedText(t,[e.id,"content"])},export:function(t,e,n){e.tagName="h"+t.level,e.append(n.annotatedText([t.id,"content"]))}}},{}],273:[function(t,e,n){"use strict";var r=t("./Heading"),i=t("./HeadingComponent"),o=t("./HeadingHTMLConverter");e.exports={name:"heading",configure:function(t){t.addNode(r),t.addComponent(r.static.name,i),t.addConverter("html",o),t.addTextType({name:"heading1",data:{type:"heading",level:1}}),t.addTextType({name:"heading2",data:{type:"heading",level:2}}),t.addTextType({name:"heading3",data:{type:"heading",level:3}}),t.addLabel("heading1",{en:"Heading 1",de:"Überschrift 1"}),t.addLabel("heading2",{en:"Heading 2",de:"Überschrift 2"}),t.addLabel("heading3",{en:"Heading 3",de:"Überschrift 3"})}}},{"./Heading":270,"./HeadingComponent":271,"./HeadingHTMLConverter":272}],274:[function(t,e,n){"use strict";function r(){r.super.apply(this,arguments)}var i=t("../../model/DocumentNode");i.extend(r),r.static.name="image",r.static.defineSchema({src:{type:"string",default:"http://"},previewSrc:{type:"string",optional:!0}}),e.exports=r},{"../../model/DocumentNode":12}],275:[function(t,e,n){"use strict";function r(){r.super.apply(this,arguments)}var i=t("../../ui/BlockNodeComponent");r.Prototype=function(){var t=r.super.prototype;this.didMount=function(){t.didMount.call(this),this.props.node.on("src:changed",this.rerender,this)},this.dispose=function(){t.dispose.call(this),this.props.node.off(this)},this.getTagName=function(){return"img"},this.render=function(e){var n=t.render.call(this,e);return n.addClass("sc-image").attr({src:this.props.node.src}),n}},i.extend(r),e.exports=r},{"../../ui/BlockNodeComponent":315}],276:[function(t,e,n){"use strict";var r=t("./Image"),i=t("./ImageComponent"),o=t("./InsertImageCommand"),s=t("./InsertImageTool");e.exports={name:"image",configure:function(t){t.addNode(r),t.addComponent(r.static.name,i),t.addCommand(o),t.addTool(s),t.addIcon(o.static.name,{fontawesome:"fa-image"}),t.addLabel("image",{en:"Image",de:"Bild"}),t.addLabel("insert-image",{en:"Insert image",de:"Bild einfügen"})}}},{"./Image":274,"./ImageComponent":275,"./InsertImageCommand":277,"./InsertImageTool":278}],277:[function(t,e,n){"use strict";function r(){r.super.apply(this,arguments)}var i=t("../../util/uuid"),o=t("../../ui/Command");r.Prototype=function(){this.getCommandState=function(t,e){var n=e.documentSession,r=n.getSelection(),i={disabled:!0,active:!1};return r&&!r.isNull()&&r.isPropertySelection()&&(i.disabled=!1),i},this.execute=function(t,e){var n=this.getCommandState(t,e);if(!n.disabled){var r=e.surfaceManager.getFocusedSurface(),o=e.fileClient,s=t.file;if(!s)throw new Error("'file' is mandatory.");return o.uploadFile(s,function(t,e){r.transaction(function(t,n){var o={id:i("image"),type:"image",src:e,previewSrc:e};return r.insertNode(t,{selection:n.selection,node:o,containerId:r.getContainerId()})})}),{status:"file-upload-process-started"}}}},o.extend(r),r.static.name="insert-image",e.exports=r},{"../../ui/Command":318,"../../util/uuid":344}],278:[function(t,e,n){"use strict";function r(){r.super.apply(this,arguments)}var i=t("../../ui/Tool");r.Prototype=function(){var t=r.super.prototype;this.getClassNames=function(){return"sc-insert-image-tool"},this.renderButton=function(e){var n=t.renderButton.apply(this,arguments),r=e("input").attr("type","file").ref("input").on("change",this.onFileSelect);return[n,r]},this.onClick=function(){this.refs.input.click()},this.onFileSelect=function(t){var e=t.currentTarget.files[0];this.performAction({file:e})}},i.extend(r),r.static.name="insert-image",e.exports=r},{"../../ui/Tool":331}],279:[function(t,e,n){"use strict";function r(){r.super.apply(this,arguments)}var i=t("../../ui/Component"),o=t("lodash/clone"),s=t("../../ui/Prompt");r.Prototype=function(){this.render=function(t){var e=this.props.node,n=t("div").addClass("sc-edit-link-tool");return n.append(t(s).append(t(s.Input,{type:"url",path:[e.id,"url"],placeholder:"Paste or type a link url"}),t(s.Separator),t(s.Link,{name:"open-link",href:e.url,title:this.getLabel("open-link")}),t(s.Action,{name:"delete",title:this.getLabel("delete")}).on("click",this.onDelete))),n},this.onDelete=function(t){t.preventDefault();var e=this.props.node,n=this.context.documentSession;n.transaction(function(t){t.delete(e.id)})}},i.extend(r),r.static.getProps=function(t){return"edit"===t.link.mode?o(t.link):void 0},r.static.name="edit-link",e.exports=r},{"../../ui/Component":319,"../../ui/Prompt":327,"lodash/clone":196}],280:[function(t,e,n){"use strict";function r(){r.super.apply(this,arguments)}var i=t("../../model/PropertyAnnotation"),o=t("../../model/Fragmenter");i.extend(r),r.static.name="link",r.static.defineSchema({title:{type:"string",optional:!0},url:{type:"string",default:"http://"}}),r.static.fragmentation=o.SHOULD_NOT_SPLIT,e.exports=r},{"../../model/Fragmenter":14,"../../model/PropertyAnnotation":18}],281:[function(t,e,n){"use strict";function r(){r.super.apply(this,arguments)}var i=t("../../ui/AnnotationCommand");r.Prototype=function(){this.getAnnotationData=function(){return{url:""}},this.canFuse=function(){return!1},this.canEdit=function(t,e){return 1===t.length},this.canDelete=function(t,e){return!1}},i.extend(r),r.static.name="link",e.exports=r},{"../../ui/AnnotationCommand":312}],282:[function(t,e,n){"use strict";function r(){r.super.apply(this,arguments)}var i=t("../../ui/AnnotationComponent");r.Prototype=function(){var t=r.super.prototype;this.didMount=function(){t.didMount.apply(this,arguments);var e=this.props.node;e.on("properties:changed",this.rerender,this)},this.dispose=function(){t.dispose.apply(this,arguments);var e=this.props.node;e.off(this)},this.render=function(e){var n=t.render.apply(this,arguments);n.tagName="a",n.attr("href",this.props.node.url);var r=[this.props.node.url];return this.props.node.title&&r.push(this.props.node.title),n.attr("title",r.join(" | "))}},i.extend(r),e.exports=r},{"../../ui/AnnotationComponent":313}],283:[function(t,e,n){"use strict";e.exports={type:"link",tagName:"a",import:function(t,e){e.url=t.attr("href"),e.title=t.attr("title")},export:function(t,e){e.attr({href:t.url,title:t.title})}}},{}],284:[function(t,e,n){"use strict";var r=t("./Link"),i=t("./LinkComponent"),o=t("./LinkCommand"),s=t("./LinkHTMLConverter"),a=t("./LinkTool"),c=t("./EditLinkTool");e.exports={name:"link",configure:function(t){t.addNode(r),t.addComponent(r.static.name,i),t.addConverter("html",s),t.addCommand(o),t.addTool(a),t.addTool(c,{overlay:!0}),t.addIcon(o.static.name,{fontawesome:"fa-link"}),t.addIcon("open-link",{fontawesome:"fa-external-link"}),t.addLabel("link",{en:"Link",de:"Link"})}}},{"./EditLinkTool":279,"./Link":280,"./LinkCommand":281,"./LinkComponent":282,"./LinkHTMLConverter":283,"./LinkTool":285}],285:[function(t,e,n){"use strict";function r(){r.super.apply(this,arguments)}var i=t("../../ui/AnnotationTool");i.extend(r),r.static.name="link",e.exports=r},{"../../ui/AnnotationTool":314}],286:[function(t,e,n){"use strict";var r=t("./breakList");e.exports={register:function(t){t.defineBreak("list-item",r)}}},{"./breakList":291}],287:[function(t,e,n){"use strict";function r(){r.super.apply(this,arguments)}var i=t("../../model/TextBlock");i.extend(r),r.static.name="list-item",r.static.defineSchema({listType:{type:"string",default:"unordered"},level:{type:"number",default:1}}),e.exports=r},{"../../model/TextBlock":22}],288:[function(t,e,n){"use strict";function r(){r.super.apply(this,arguments)}var i=t("../../ui/Component"),o=t("../../ui/TextPropertyComponent");r.Prototype=function(){this.render=function(t){var e=this.props.node,n=t("div").addClass("sc-list-item").addClass("sm-"+e.listType).attr("data-id",this.props.node.id).append(t(o,{path:[this.props.node.id,"content"]}));return n}},i.extend(r),e.exports=r},{"../../ui/Component":319,"../../ui/TextPropertyComponent":330}],289:[function(t,e,n){"use strict";var r=t("../../model/transform/switchTextType"),i=t("../../model/transform/deleteSelection"),o={appliesTo:["paragraph"],execute:function(t,e){if(this.appliesTo.indexOf(t.node.type)===-1)return!1;var n=/^\*\s/.exec(t.text);if(n){var o=e.surfaceManager.getSurface(t.selection.surfaceId);return o.transaction(function(e,o){var s=e.createSelection(t.path,0,n[0].length);i(e,{selection:s});var a=r(e,{selection:t.selection,containerId:o.containerId,data:{type:"list-item"}});if("type"===t.action)return{selection:e.createSelection(a.node.getTextPath(),0)}}),!0}}};e.exports=o},{"../../model/transform/deleteSelection":40,"../../model/transform/switchTextType":44}],290:[function(t,e,n){"use strict";var r=t("./ListItem"),i=t("./ListItemComponent"),o=t("./ListEditing"),s=t("./ListMacro");e.exports={name:"list-item",configure:function(t,e){t.addNode(r),t.addComponent(r.static.name,i),t.addTextType({name:"list-item",data:{type:"list-item"}}),t.addEditingBehavior(o),e.enableMacro&&t.addMacro(s),t.addLabel("list",{en:"List",de:"Liste"}),t.addLabel("list-item",{en:"List",de:"Liste"})}}},{"./ListEditing":286,"./ListItem":287,"./ListItemComponent":288,"./ListMacro":289}],291:[function(t,e,n){"use strict";var r=t("../../util/uuid"),i=t("../../model/annotationHelpers");e.exports=function(t,e){var n=e.selection,o=e.containerId;if(!n.isPropertySelection())throw new Error("Expected property selection.");var s,a,c,u=n.path,h=n.startOffset,l=t.get(u[0]),f=l.getText(),d=t.get(o),p=d.getPosition(l.id),g=p+1;if(0===f.length){var m=t.getSchema().getDefaultTextType();a={type:m,content:""},s=t.create(a),d.hide(l.id),t.delete(l.id),d.show(s.id,p),c=s.id}else a=l.toJSON(),a.id=r(l.type),0===h?a.content="":a.content=f.substring(h),s=t.create(a),c=s.id,0===h?(g=p,c=l.id):h<f.length&&(i.transferAnnotations(t,u,h,[s.id,"content"],0),t.update(u,{delete:{start:h,end:f.length}})),d.show(s.id,g);return n=t.createSelection([c,"content"],0),{selection:n,node:s}}},{"../../model/annotationHelpers":24,"../../util/uuid":344}],292:[function(t,e,n){"use strict";function r(){r.super.apply(this,arguments)}var i=t("../../model/TextBlock");i.extend(r),r.static.name="paragraph",e.exports=r},{"../../model/TextBlock":22}],293:[function(t,e,n){"use strict";function r(){r.super.apply(this,arguments)}var i=t("../../ui/TextBlockComponent");r.Prototype=function(){var t=r.super.prototype;this.render=function(e){var n=t.render.call(this,e);return n.addClass("sc-paragraph")}},i.extend(r),e.exports=r},{"../../ui/TextBlockComponent":329}],294:[function(t,e,n){"use strict";e.exports={type:"paragraph",tagName:"p",import:function(t,e,n){e.content=n.annotatedText(t,[e.id,"content"])},export:function(t,e,n){e.append(n.annotatedText([t.id,"content"]))}}},{}],295:[function(t,e,n){"use strict";var r=t("./Paragraph"),i=t("./ParagraphComponent"),o=t("./ParagraphHTMLConverter");e.exports={name:"paragraph",configure:function(t){t.addNode(r),t.addComponent(r.static.name,i),t.addConverter("html",o),t.addTextType({name:"paragraph",data:{type:"paragraph"}}),t.addLabel("paragraph",{en:"Paragraph",de:"Paragraph"}),t.addLabel("paragraph.content",{en:"Paragraph",de:"Paragraph"})}}},{"./Paragraph":292,"./ParagraphComponent":293,"./ParagraphHTMLConverter":294}],296:[function(t,e,n){"use strict";function r(t){i.call(this,t),this._initialize()}var i=t("../../model/Document");r.Prototype=function(){this._initialize=function(){this.create({type:"container",id:"body",nodes:[]})}},i.extend(r),e.exports=r},{"../../model/Document":9}],297:[function(t,e,n){"use strict";var r=t("../base/BasePackage"),i=t("../paragraph/ParagraphPackage"),o=t("../heading/HeadingPackage"),s=t("../codeblock/CodeblockPackage"),a=t("../blockquote/BlockquotePackage"),c=t("../list/ListPackage"),u=t("../link/LinkPackage"),h=t("../emphasis/EmphasisPackage"),l=t("../strong/StrongPackage"),f=t("../code/CodePackage"),d=t("../subscript/SubscriptPackage"),p=t("../superscript/SuperscriptPackage"),g=t("./ProseEditorToolbar"),m=t("../../ui/Overlay"),v=t("./ProseArticle");e.exports={name:"prose-editor",configure:function(t){t.defineSchema({name:"prose-article",ArticleClass:v,defaultTextType:"paragraph"}),t.setToolbarClass(g),t.addComponent("overlay",m),t.import(r),t.import(i),t.import(o),t.import(s),t.import(a),t.import(c),t.import(h),t.import(l),t.import(d),t.import(p),t.import(f),t.import(u)}}},{"../../ui/Overlay":326,"../base/BasePackage":245,"../blockquote/BlockquotePackage":255,"../code/CodePackage":258,"../codeblock/CodeblockPackage":263,"../emphasis/EmphasisPackage":267,"../heading/HeadingPackage":273,"../link/LinkPackage":284,"../list/ListPackage":290,"../paragraph/ParagraphPackage":295,"../strong/StrongPackage":301,"../subscript/SubscriptPackage":305,"../superscript/SuperscriptPackage":309,"./ProseArticle":296,"./ProseEditorToolbar":298}],298:[function(t,e,n){"use strict";function r(){i.apply(this,arguments)}var i=t("../../ui/Component"),o=t("../../ui/ToolGroup");r.Prototype=function(){this.render=function(t){var e=t("div").addClass("sc-prose-editor-toolbar"),n=this.props.commandStates,r=this.context.toolRegistry,i=[];return r.forEach(function(e,r){e.options.overlay||i.push(t(e.Class,n[r]))}),e.append(t(o).append(i)),e}},i.extend(r),e.exports=r},{"../../ui/Component":319,"../../ui/ToolGroup":332}],299:[function(t,e,n){"use strict";function r(){r.super.apply(this,arguments)}var i=t("../../model/PropertyAnnotation"),o=t("../../model/Fragmenter");i.extend(r),r.static.name="strong",r.static.fragmentation=o.ANY,e.exports=r},{"../../model/Fragmenter":14,"../../model/PropertyAnnotation":18}],300:[function(t,e,n){"use strict";function r(){r.super.apply(this,arguments)}var i=t("../../ui/AnnotationCommand");i.extend(r),r.static.name="strong",e.exports=r},{"../../ui/AnnotationCommand":312}],301:[function(t,e,n){"use strict";var r=t("./Strong"),i=t("./StrongTool"),o=t("./StrongCommand");e.exports={name:"strong",configure:function(t){t.addNode(r),t.addCommand(o),t.addTool(i),t.addIcon(o.static.name,{fontawesome:"fa-bold"}),t.addLabel("strong",{en:"Strong emphasis",de:"Starke Betonung"})}}},{"./Strong":299,"./StrongCommand":300,"./StrongTool":302}],302:[function(t,e,n){"use strict";function r(){r.super.apply(this,arguments)}var i=t("../../ui/AnnotationTool");i.extend(r),r.static.name="strong",e.exports=r},{"../../ui/AnnotationTool":314}],303:[function(t,e,n){"use strict";function r(){r.super.apply(this,arguments)}var i=t("../../model/PropertyAnnotation"),o=t("../../model/Fragmenter");i.extend(r),r.static.name="subscript",r.static.fragmentation=o.ANY,e.exports=r},{"../../model/Fragmenter":14,"../../model/PropertyAnnotation":18}],304:[function(t,e,n){"use strict";var r=t("../../ui/AnnotationCommand"),i=r.extend();i.static.name="subscript",e.exports=i},{"../../ui/AnnotationCommand":312}],305:[function(t,e,n){"use strict";var r=t("./Subscript"),i=t("./SubscriptTool"),o=t("./SubscriptCommand");e.exports={name:"subscript",configure:function(t){t.addNode(r),t.addCommand(o),t.addTool(i),t.addIcon(o.static.name,{fontawesome:"fa-subscript"}),t.addLabel("subscript",{en:"Subscript",de:"Tiefgestellt"})}}},{"./Subscript":303,"./SubscriptCommand":304,"./SubscriptTool":306}],306:[function(t,e,n){"use strict";function r(){r.super.apply(this,arguments)}var i=t("../../ui/AnnotationTool");i.extend(r),r.static.name="subscript",e.exports=r},{"../../ui/AnnotationTool":314}],307:[function(t,e,n){"use strict";function r(){r.super.apply(this,arguments)}var i=t("../../model/PropertyAnnotation"),o=t("../../model/Fragmenter");i.extend(r),r.static.name="superscript",r.static.fragmentation=o.ANY,e.exports=r},{"../../model/Fragmenter":14,"../../model/PropertyAnnotation":18}],308:[function(t,e,n){"use strict";function r(){r.super.apply(this,arguments)}var i=t("../../ui/AnnotationCommand");i.extend(r),r.static.name="superscript",e.exports=r},{"../../ui/AnnotationCommand":312}],309:[function(t,e,n){"use strict";var r=t("./Superscript"),i=t("./SuperscriptTool"),o=t("./SuperscriptCommand");e.exports={name:"superscript",configure:function(t){t.addNode(r),t.addCommand(o),t.addTool(i),t.addIcon(o.static.name,{fontawesome:"fa-superscript"}),t.addLabel("superscript",{en:"Superscript",de:"Hochgestellt"})}}},{"./Superscript":307,"./SuperscriptCommand":308,"./SuperscriptTool":310}],310:[function(t,e,n){"use strict";function r(){r.super.apply(this,arguments)}var i=t("../../ui/AnnotationTool");i.extend(r),r.static.name="superscript",e.exports=r},{"../../ui/AnnotationTool":314}],311:[function(t,e,n){"use strict";function r(){r.super.apply(this,arguments)}var i=t("../model/Fragmenter"),o=t("./Component"),s=t("./AnnotationComponent"),a=t("./InlineNodeComponent");r.Prototype=function(){this.render=function(t){var e=this._renderContent(t).addClass("sc-annotated-text").css({whiteSpace:"pre-wrap"});return e},this.getText=function(){return this.props.text},this.getAnnotations=function(){return this.props.annotations||[]},this._renderContent=function(t){var e=this.getText(),n=this.getAnnotations(),r=t(this.props.tagName||"span"),o=new i({onText:this._renderTextNode.bind(this),onEnter:this._renderFragment.bind(this,t),onExit:this._finishFragment.bind(this)});return o.start(r,e,n),r},this._renderTextNode=function(t,e){e&&e.length>0&&t.append(e)},this._renderFragment=function(t,e){var n=this.getDocument(),r=this.getComponentRegistry(),i=e.node;if("container-annotation-fragment"===i.type)return t(s,{doc:n,node:i}).addClass("se-annotation-fragment").addClass(i.anno.getTypeNames().join(" ").replace(/_/g,"-"));if("container-annotation-anchor"===i.type)return t(s,{doc:n,node:i}).addClass("se-anchor").addClass(i.anno.getTypeNames().join(" ").replace(/_/g,"-")).addClass(i.isStart?"start-anchor":"end-anchor");var o;i.constructor.static.isInline?o=a:(o=r.get(i.type),o||(o=s));var c=t(o,{doc:n,node:i});return c},this._finishFragment=function(t,e,n){n.append(e)},this.getDocument=function(){return this.props.doc||this.context.doc},this.getComponentRegistry=function(){return this.props.componentRegistry||this.context.componentRegistry}},o.extend(r),e.exports=r},{"../model/Fragmenter":14,"./AnnotationComponent":313,"./Component":319,"./InlineNodeComponent":323}],312:[function(t,e,n){"use strict";function r(){i.call(this)}var i=t("./Command"),o=t("../model/transform/createAnnotation"),s=t("../model/transform/fuseAnnotation"),a=t("../model/transform/expandAnnotation"),c=t("../model/transform/truncateAnnotation");r.Prototype=function(){this.getAnnotationType=function(){var t=this.constructor.static.annotationType||this.constructor.static.name;if(t)return t;throw new Error("Contract: AnnotationCommand.static.annotationType should be associated to a document annotation type.")},this.getAnnotationData=function(){return{}},this.isDisabled=function(t){return!(t&&!t.isNull()&&t.isAttached()&&!t.isCustomSelection()&&!t.isNodeSelection()&&!t.isContainerSelection())},this.canEdit=function(t,e){return!1},this.canCreate=function(t,e){return 0===t.length&&!e.isCollapsed()},this.canFuse=function(t,e){return t.length>=2&&!e.isCollapsed()},this.canDelete=function(t,e){if(1!==t.length)return!1;var n=t[0].getSelection();return e.isInsideOf(n)},this.canExpand=function(t,e){if(1!==t.length)return!1;var n=t[0].getSelection();return e.overlaps(n)&&!e.isInsideOf(n)},this.canTruncate=function(t,e){if(1!==t.length)return!1;var n=t[0].getSelection();return(e.isLeftAlignedWith(n)||e.isRightAlignedWith(n))&&!e.contains(n)&&!e.isCollapsed()},this.getCommandState=function(t,e){e=e||{};var n=this._getSelection(t);if(this.isDisabled(n))return{disabled:!0};var r=this._getAnnotationsForSelection(t,e),i={disabled:!1,active:!1,mode:null};return this.canCreate(r,n)?i.mode="create":this.canFuse(r,n)?i.mode="fusion":this.canTruncate(r,n)?(i.active=!0,
i.mode="truncate"):this.canExpand(r,n)?i.mode="expand":this.canEdit(r,n)?(i.mode="edit",i.node=r[0],i.active=!0):this.canDelete(r,n)?(i.active=!0,i.mode="delete"):i.disabled=!0,i},this.execute=function(t,e){if(t=t||{},t.selection=this._getSelection(t),t.disabled)return!1;var n=t.mode;switch(n){case"create":return this.executeCreate(t,e);case"fuse":return this.executeFuse(t,e);case"truncate":return this.executeTruncate(t,e);case"expand":return this.executeExpand(t,e);case"edit":return this.executeEdit(t,e);case"delete":return this.executeDelete(t,e);default:return console.warn("Command.execute(): unknown mode",n),!1}},this.executeCreate=function(t,e){var n=this._getAnnotationsForSelection(t,e);this._checkPrecondition(t,e,n,this.canCreate);var r=this._applyTransform(t,e,function(e){return t.node=this.getAnnotationData(),t.node.type=this.getAnnotationType(),o(e,t)}.bind(this));return{mode:"create",anno:r}},this.executeFuse=function(t,e){var n=this._getAnnotationsForSelection(t,e);this._checkPrecondition(t,e,n,this.canFuse);var r=this._applyTransform(t,e,function(t){var e=s(t,{annos:n});return{result:e.node}});return{mode:"fuse",anno:r}},this.executeTruncate=function(t,e){var n=this._getAnnotationsForSelection(t,e),r=n[0];return this._checkPrecondition(t,e,n,this.canTruncate),this._applyTransform(t,e,function(e){return c(e,{selection:t.selection,anno:r})}),{mode:"truncate",anno:r}},this.executeExpand=function(t,e){var n=this._getAnnotationsForSelection(t,e),r=n[0];return this._checkPrecondition(t,e,n,this.canExpand),this._applyTransform(t,e,function(e){a(e,{selection:t.selection,anno:r})}),{mode:"expand",anno:r}},this.executeEdit=function(t,e){var n=this._getAnnotationsForSelection(t,e);return this._checkPrecondition(t,e,n,this.canEdit),{mode:"edit",anno:n[0],readyOnly:!0}},this.executeDelete=function(t,e){var n=this._getAnnotationsForSelection(t,e),r=n[0];return this._checkPrecondition(t,e,n,this.canDelete),this._applyTransform(t,e,function(t){return t.delete(r.id)}),{mode:"delete",annoId:r.id}},this._checkPrecondition=function(t,e,n,r){var i=this._getSelection(t);if(!r.call(this,n,i))throw new Error("AnnotationCommand: can't execute command for selection "+i.toString())},this._getAnnotationsForSelection=function(t){return t.selectionState.getAnnotationsForType(this.getAnnotationType())},this._applyTransform=function(t,e,n){var r=this._getSelection(t),i=this._getDocumentSession(t,e),o=t.surface;t.selection=r;var s;if(!r.isNull())return i.transaction(function(e){e.before.selection=r,o&&(e.before.surfaceId=o.getId());var i=n(e,t);return i&&(s=i.result),i}),s}},i.extend(r),e.exports=r},{"../model/transform/createAnnotation":38,"../model/transform/expandAnnotation":41,"../model/transform/fuseAnnotation":42,"../model/transform/truncateAnnotation":45,"./Command":318}],313:[function(t,e,n){"use strict";function r(){i.apply(this,arguments)}var i=t("./Component");r.Prototype=function(){this.didMount=function(){var t=this.props.node;t.on("highlighted",this.onHighlightedChanged,this)},this.dispose=function(){var t=this.props.node;t.off(this)},this.render=function(t){var e=t("span").attr("data-id",this.props.node.id).addClass(this.getClassNames());return this.props.node.highlighted&&e.addClass("sm-highlighted"),e.append(this.props.children),e},this.getClassNames=function(){return"sc-"+this.props.node.type},this.onHighlightedChanged=function(){this.props.node.highlighted?this.el.addClass("sm-highlighted"):this.el.removeClass("sm-highlighted")}},i.extend(r),e.exports=r},{"./Component":319}],314:[function(t,e,n){"use strict";function r(){i.apply(this,arguments)}var i=t("./Tool");r.Prototype=function(){var t=r.super.prototype;this.render=function(e){var n=t.render.call(this,e);return n.addClass("sm-annotation-tool"),n},this.renderButton=function(e){var n=t.renderButton.call(this,e);return n.append(this.renderMode(e)),n},this.renderMode=function(t){var e=this.props.mode,n=t("div").addClass("se-mode"),r=this.context.iconProvider.renderIcon(t,e);return r&&n.append(r),n}},i.extend(r),e.exports=r},{"./Tool":331}],315:[function(t,e,n){"use strict";function r(){r.super.apply(this,arguments)}var i=t("./NodeComponent");r.Prototype=function(){},i.extend(r),e.exports=r},{"./NodeComponent":325}],316:[function(t,e,n){"use strict";function r(t){console.assert(t instanceof window.Node,"Expecting native DOM node."),this.el=t,t._wrapper=this,this.eventListeners=[],this.htmlProps={}}function i(t){console.assert(t instanceof window.Node&&3===t.nodeType,"Expecting native TextNode."),this.el=t,t._wrapper=this}function o(){this.el=window,window.__BrowserDOMElementWrapper__=this,this.eventListeners=[]}var s=t("lodash/isString"),a=t("lodash/isNumber"),c=t("../util/oo"),u=t("./DOMElement"),h=t("./DelegatedEvent"),l=window.Element.prototype,f=l.matches||l.matchesSelector||l.msMatchesSelector||l.webkitMatchesSelector;r.Prototype=function(){this._isBrowserDOMElement=!0,this.getNativeElement=function(){return this.el},this.hasClass=function(t){return this.el.classList.contains(t)},this.addClass=function(t){return this.el.classList.add(t),this},this.removeClass=function(t){return this.el.classList.remove(t),this},this.getClasses=function(){return this.el.className},this.setClasses=function(t){return this.el.className=t,this},this.getAttribute=function(t){return this.el.getAttribute(t)},this.setAttribute=function(t,e){return this.el.setAttribute(t,e),this},this.removeAttribute=function(t){return this.el.removeAttribute(t),this},this.getAttributes=function(){for(var t={},e=this.el.attributes,n=e.length,r=0;r<n;r++){var i=e.item(r);t[i.name]=i.value}return t},this.getProperty=function(t){return this.el[t]},this.setProperty=function(t,e){return this.htmlProps[t]=e,this.el[t]=e,this},this.removeProperty=function(t){return delete this.htmlProps[t],delete this.el[t],this},this.getTagName=function(){if(this.el.tagName)return this.el.tagName.toLowerCase()},this.setTagName=function(t){var e,n=r.createElement(t),i=this.el.attributes,o=i.length;for(e=0;e<o;e++){var s=i.item(e);n.setAttribute(s.name,s.value)}for(var a in this.htmlProps)this.htmlProps.hasOwnProperty(a)&&(n[a]=this.htmlProps[a]);return this.eventListeners.forEach(function(t){n.addEventListener(t.eventName,t.handler,t.capture)}),this._replaceNativeEl(n),this},this.getId=function(){return this.el.id},this.setId=function(t){return this.el.id=t,this},this.getValue=function(){return this.el.value},this.setValue=function(t){return this.el.value=t,this},this.getStyle=function(t){var e=this.getComputedStyle();return e[t]||this.el.style[t]},this.getComputedStyle=function(){return window.getComputedStyle(this.el)};var t={top:!0,bottom:!0,left:!0,right:!0,height:!0,width:!0};this.setStyle=function(e,n){return t[e]&&a(n)&&(n+="px"),this.el.style[e]=n,this},this.getTextContent=function(){return this.el.textContent},this.setTextContent=function(t){return this.el.textContent=t,this},this.getInnerHTML=function(){var t=this.el.innerHTML;if(!s(t)){for(var e=this.el.ownerDocument.createDocumentFragment(),n=this.el.firstChild;n;n=n.nextSibling)e.appendChild(n.cloneNode(!0));var r=new window.XMLSerializer;t=r.serializeToString(e)}return t},this.setInnerHTML=function(t){return this.el.innerHTML=t,this},this.getOuterHTML=function(){var t=this.el.outerHTML;if(!s(t)){var e=new window.XMLSerializer;t=e.serializeToString(this.el)}return t},this.addEventListener=function(t,e,n){var r;return r=1===arguments.length&&arguments[0]?arguments[0]:new u.EventListener(t,e,n),r.options.selector&&!r.__hasEventDelegation__&&(r.handler=this._delegatedHandler(r),r.__hasEventDelegation__=!0),this.el.addEventListener(r.eventName,r.handler,r.capture),r._el=this,this.eventListeners.push(r),this},this._delegatedHandler=function(t){var e=t.handler,n=t.context,r=t.options.selector,i=this.getNativeElement();return function(t){for(var o=t.target;o;){if(f.call(o,r)){e(new h(n,t.target,t));break}if(o===i)break;o=o.parentNode}}},this.removeEventListener=function(t,e){var n=null,r=-1;return r=u._findEventListenerIndex(this.eventListeners,t,e),n=this.eventListeners[r],r>-1&&(this.eventListeners.splice(r,1),n._el=null,this.el.removeEventListener(n.eventName,n.handler)),this},this.removeAllEventListeners=function(){for(var t=0;t<this.eventListeners.length;t++){var e=this.eventListeners[t];e._el=null,this.el.removeEventListener(e.eventName,e.handler)}this.eventListeners=[]},this.getEventListeners=function(){return this.eventListeners},this.getChildCount=function(){return this.el.childNodes.length},this.getChildNodes=function(){for(var t=[],e=this.el.firstChild;e;e=e.nextSibling)t.push(r.wrapNativeElement(e));return t},this.getChildren=function(){for(var t=[],e=this.el.firstChild;e;e=e.nextSibling)e.nodeType===window.Node.ELEMENT_NODE&&t.push(r.wrapNativeElement(e));return t},this.getChildAt=function(t){return r.wrapNativeElement(this.el.childNodes[t])},this.getChildIndex=function(t){if(!t._isBrowserDOMElement)throw new Error("Expecting a BrowserDOMElement instance.");return Array.prototype.indexOf.call(this.el.childNodes,t.el)},this.getFirstChild=function(){var t=this.el.firstChild;return t?r.wrapNativeElement(t):null},this.getLastChild=function(){var t=this.el.lastChild;return t?r.wrapNativeElement(t):null},this.getNextSibling=function(){var t=this.el.nextSibling;return t?r.wrapNativeElement(t):null},this.getPreviousSibling=function(){var t=this.el.previousSibling;return t?r.wrapNativeElement(t):null},this.isTextNode=function(){return this.el.nodeType===window.Node.TEXT_NODE},this.isElementNode=function(){return this.el.nodeType===window.Node.ELEMENT_NODE},this.isCommentNode=function(){return this.el.nodeType===window.Node.COMMENT_NODE},this.isDocumentNode=function(){return this.el.nodeType===window.Node.DOCUMENT_NODE},this.clone=function(){var t=this.el.cloneNode(!0);return r.wrapNativeElement(t)},this.createElement=function(t){var e=this.el.ownerDocument.createElement(t);return r.wrapNativeElement(e)},this.createTextNode=function(t){var e=this.el.ownerDocument.createTextNode(t);return r.wrapNativeElement(e)},this.is=function(t){var e=this.el;return!!this.isElementNode()&&f.call(e,t)},this.getParent=function(){var t=this.el.parentNode;return t?r.wrapNativeElement(t):null},this.getRoot=function(){for(var t=this.el,e=t;e;)t=e,e=t.parentNode;return r.wrapNativeElement(t)},this.find=function(t){var e=null;return this.el.querySelector&&(e=this.el.querySelector(t)),e?r.wrapNativeElement(e):null},this.findAll=function(t){var e=[];return this.el.querySelectorAll&&(e=this.el.querySelectorAll(t)),Array.prototype.map.call(e,function(t){return r.wrapNativeElement(t)})},this._normalizeChild=function(t){if(t instanceof window.Node){if(t._wrapper)return t;t=r.wrapNativeElement(t)}if(s(t)&&(t=this.createTextNode(t)),!t||!t._isBrowserDOMElement)throw new Error("Illegal child type.");return t.el._wrapper||(t.el._wrapper=t),console.assert(t.el._wrapper===t,"Expecting a backlink between native element and CheerioDOMElement"),t.getNativeElement()},this.appendChild=function(t){var e=this._normalizeChild(t);return this.el.appendChild(e),this},this.insertAt=function(t,e){var n=this._normalizeChild(e),r=this.el.childNodes;return t>=r.length?this.el.appendChild(n):this.el.insertBefore(n,r[t]),this},this.insertBefore=function(t,e){if(!e||!e._isBrowserDOMElement)throw new Error('insertBefore(): Illegal arguments. "before" must be a BrowserDOMElement instance.');var n=this._normalizeChild(t);return this.el.insertBefore(n,e.el),this},this.removeAt=function(t){return this.el.removeChild(this.el.childNodes[t]),this},this.removeChild=function(t){if(!t||!t._isBrowserDOMElement)throw new Error("removeChild(): Illegal arguments. Expecting a BrowserDOMElement instance.");return this.el.removeChild(t.el),this},this.replaceChild=function(t,e){if(!(e&&t&&e._isBrowserDOMElement&&t._isBrowserDOMElement))throw new Error("replaceChild(): Illegal arguments. Expecting BrowserDOMElement instances.");return this.el.replaceChild(e.el,t.el),this},this.empty=function(){for(var t=this.el;t.lastChild;)t.removeChild(t.lastChild);return this},this.remove=function(){return this.el.parentNode&&this.el.parentNode.removeChild(this.el),this},this.serialize=function(){var t=this.el.outerHTML;if(s(t))return t;var e=new window.XMLSerializer;return e.serializeToString(this.el)},this.isInDocument=function(){for(var t=this.el;t;){if(t.nodeType===window.Node.DOCUMENT_NODE)return!0;t=t.parentNode}},this._replaceNativeEl=function(t){console.assert(t instanceof window.Node,"Expecting a native element.");var e=this.el,n=e.parentNode;n&&n.replaceChild(t,e),this.el=t},this._getChildNodeCount=function(){return this.el.childNodes.length},this.focus=function(){return this.el.focus(),this},this.blur=function(){return this.el.focus(),this},this.click=function(){return this.el.click(),this},this.getWidth=function(){var t=this.el.getClientRects()[0];return t?t.width:0},this.getHeight=function(){var t=this.el.getClientRects()[0];return t?t.height:0},this.getOffset=function(){var t=this.el.getBoundingClientRect();return{top:t.top+document.body.scrollTop,left:t.left+document.body.scrollLeft}},this.getPosition=function(){return{left:this.el.offsetLeft,top:this.el.offsetTop}},this.getOuterHeight=function(t){var e=this.el.offsetHeight;if(t){var n=this.getComputedStyle();e+=parseInt(n.marginTop,10)+parseInt(n.marginBottom,10)}return e}},u.extend(r),u._defineProperties(r,u._propertyNames),r.createTextNode=function(t){return window.document.createTextNode(t)},r.createElement=function(t){return window.document.createElement(t)},r.parseMarkup=function(t,e,n){var i,o=[];if(!t)return i="xml"===e?(new window.DOMParser).parseFromString("<dummy/>","text/xml"):(new window.DOMParser).parseFromString("<html></html>","text/html"),new r(i);var s=new window.DOMParser;if("html"===e?(n=t.search(/<\s*html/i)>=0,i=s.parseFromString(t,"text/html")):"xml"===e&&(i=s.parseFromString(t,"text/xml")),!i)throw new Error("Could not parse DOM string.");if("html"===e)if(n)o=[i.querySelector("html")];else{var a=i.querySelector("body");o=a.childNodes}else"xml"===e&&(o=n?[i]:i.childNodes);var c=Array.prototype.map.call(o,function(t){return new r(t)});return 1===c.length?c[0]:c},r.wrapNativeElement=function(t){return t?t._wrapper?t._wrapper:t instanceof window.Node?3===t.nodeType?new i(t):new r(t):t===window?r.getBrowserWindow():void 0:null},i.Prototype=function(){this._isBrowserDOMElement=!0,["getParent","getNextSibling","getPreviousSibling","getTextContent","setTextContent","getInnerHTML","setInnerHTML","getOuterHTML","getNativeElement","clone"].forEach(function(t){this[t]=r.prototype[t]}.bind(this))},u.TextNode.extend(i),u._defineProperties(i,["nodeType","textContent","innerHTML","outerHTML","parentNode"]),r.TextNode=i,o.Prototype=function(){var t=r.prototype;this.on=function(){return t.on.apply(this,arguments)},this.off=function(){return t.off.apply(this,arguments)},this.addEventListener=function(){return t.addEventListener.apply(this,arguments)},this.removeEventListener=function(){return t.removeEventListener.apply(this,arguments)},this.getEventListeners=r.prototype.getEventListeners},c.initClass(o),r.getBrowserWindow=function(){return window.__BrowserDOMElementWrapper__?window.__BrowserDOMElementWrapper__:new o(window)};var d,p;r.isReverse=function(t,e,n,r){if(n&&t){d||(d=window.document.createRange(),p=window.document.createRange()),d.setStart(t.getNativeElement(),e),p.setStart(n.getNativeElement(),r);var i=d.compareBoundaryPoints(window.Range.START_TO_START,p);if(1===i)return!0}return!1},r.getWindowSelection=function(){var t=window.getSelection(),e={anchorNode:r.wrapNativeElement(t.anchorNode),anchorOffset:t.anchorOffset,focusNode:r.wrapNativeElement(t.focusNode),focusOffset:t.focusOffset};return e},e.exports=r},{"../util/oo":342,"./DOMElement":320,"./DelegatedEvent":322,"lodash/isNumber":218,"lodash/isString":221}],317:[function(t,e,n){"use strict";function r(t){this.el=t,this.$el=u(t),t._wrapper=this,this.htmlProps={}}var i=t("lodash/isString"),o=t("lodash/last"),s=t("lodash/extend"),a=t("lodash/clone"),c=t("lodash/map"),u=t("../util/cheerio.customized"),h=t("./DOMElement");r.Prototype=function(){this._isCheerioDOMElement=!0,this.getNativeElement=function(){return this.el},this._wrapNativeElement=function(t){return t._wrapper?t._wrapper:new r(t)},this.hasClass=function(t){return this.$el.hasClass(t)},this.addClass=function(t){return this.$el.addClass(t),this},this.removeClass=function(t){return this.$el.removeClass(t),this},this.getClasses=function(){return this.$el.attr("class")},this.setClasses=function(t){return this.$el.attr("class",t),this},this.getAttribute=function(t){return this.$el.attr(t)},this.setAttribute=function(t,e){return this.$el.attr(t,e),this},this.removeAttribute=function(t){return this.$el.removeAttr(t),this},this.getAttributes=function(){var t=a(this.el.attribs);return t},this.getProperty=function(t){return this.$el.prop(t)},this.setProperty=function(t,e){return this.htmlProps[t]=e,this.$el.prop(t,e),this},this.removeProperty=function(t){return delete this.htmlProps[t],delete this.el[t],this},this.getTagName=function(){return"tag"!==this.el.type?"":this.el.name.toLowerCase()},this.setTagName=function(t){var e=u._createElement(t,this.el.root),n=u(e);return n.html(this.$el.html()),e.attribs=s({},this.el.attribs),this._replaceNativeEl(e),this},this.getId=function(){return this.$el.attr("id")},this.setId=function(t){return this.$el.attr("id",t),this},this.getTextContent=function(){return this.$el.text()},this.setTextContent=function(t){return this.$el.text(t),this},this.getInnerHTML=function(){return this.$el.html()},this.setInnerHTML=function(t){return this.$el.html(t),this},this.getOuterHTML=function(){return u._serialize(this.el)},this.getValue=function(){return this.$el.val()},this.setValue=function(t){return this.$el.val(t),this},this.getStyle=function(t){return this.$el.css(t)},this.setStyle=function(t,e){return this.$el.css(t,e),this},this.addEventListener=function(){return this},this.removeEventListener=function(){return this},this.removeAllEventListeners=function(){return this},this.getEventListeners=function(){return[]},this.getChildCount=function(){return this.el.children.length},this.getChildNodes=function(){var t=this.el.children;return t=t.map(function(t){return this._wrapNativeElement(t)}.bind(this))},this.getChildren=function(){var t=this.el.children;return t=t.filter(function(t){return"tag"===t.type}),t=t.map(function(t){return this._wrapNativeElement(t)}.bind(this))},this.getChildAt=function(t){return this._wrapNativeElement(this.el.children[t])},this.getChildIndex=function(t){if(!t._isCheerioDOMElement)throw new Error("Expecting a CheerioDOMElement instance.");return this.el.children.indexOf(t.el)},this.getFirstChild=function(){var t=this.el.children[0];return t?r.wrapNativeElement(t):null},this.getLastChild=function(){var t=o(this.el.children);return t?r.wrapNativeElement(t):null},this.getNextSibling=function(){var t=this.el.next;return t?r.wrapNativeElement(t):null},this.getPreviousSibling=function(){var t=this.el.previous;return t?r.wrapNativeElement(t):null},this.isTextNode=function(){return"text"===this.el.type},this.isElementNode=function(){return"tag"===this.el.type},this.isCommentNode=function(){return"comment"===this.el.type},this.isDocumentNode=function(){return this.el===this.el.root},this.clone=function(){var t=this.$el.clone()[0];return this._wrapNativeElement(t)},this.createElement=function(t){var e=u._createElement(t,this.el.root);return this._wrapNativeElement(e)},this.createTextNode=function(t){var e=u._createTextNode(t);return this._wrapNativeElement(e)},this.is=function(t){return this.$el.is(t)},this.getParent=function(){var t=this.el.parent;return t?this._wrapNativeElement(t):null},this.getRoot=function(){for(var t=this.el,e=t;e;)t=e,e=t.parent;return this._wrapNativeElement(t)},this.find=function(t){var e=this.$el.find(t);return e.length>0?this._wrapNativeElement(e[0]):null},this.findAll=function(t){var e=this.$el.find(t);return e.length>0?c(e,function(t){return this._wrapNativeElement(t)}.bind(this)):[]},this._normalizeChild=function(t){if(i(t)&&(t=this.createTextNode(t)),t._wrapper&&(t=t._wrapper),!t||!t._isCheerioDOMElement)throw new Error("Illegal argument: only String and CheerioDOMElement instances are valid.");return console.assert(t.el._wrapper===t,"Expecting a backlink between native element and CheerioDOMElement"),t.getNativeElement()},this.appendChild=function(t){return t=this._normalizeChild(t),this.el.children.push(t),t.parent=this.el,this},this.insertAt=function(t,e){e=this._normalizeChild(e);var n=this.el.children;return t>=n.length?n.push(e):n.splice(t,0,e),e.parent=this.el,this},this.insertBefore=function(t,e){var n=this.el.children.indexOf(e.el);if(n>-1)return this.insertAt(n,t);throw new Error("insertBefore(): reference node is not a child of this element.")},this.removeAt=function(t){if(t<0||t>=this.el.children.length)throw new Error("removeAt(): Index out of bounds.");var e=this.el.children[t];return e.parent=null,this.el.children.splice(t,1),this},this.removeChild=function(t){if(!t||!t._isCheerioDOMElement)throw new Error("removeChild(): Illegal arguments. Expecting a CheerioDOMElement instance.");var e=this.el.children.indexOf(t.el);if(e<0)throw new Error("removeChild(): element is not a child.");return this.removeAt(e),this},this.replaceChild=function(t,e){if(!(e&&t&&e._isCheerioDOMElement&&t._isCheerioDOMElement))throw new Error("replaceChild(): Illegal arguments. Expecting BrowserDOMElement instances.");var n=this.el.children.indexOf(t.el);return n>-1&&(this.removeAt(n),this.insertAt(n,e.el)),this},this.empty=function(){return this.$el.empty(),this},this.remove=function(){return this.$el.remove(),this},this._replaceNativeEl=function(t){var e=u(t);this.$el.replaceWith(e),this.el=t,this.$el=e},this.isInDocument=function(){for(var t=this.el;t;){if(t===t.root)return!0;t=t.parent}return!1}},h.extend(r),h._defineProperties(r,h._propertyNames),r.createTextNode=function(t){return u._createTextNode(t)},r.createElement=function(t){return u("<"+t+">")[0]},r.parseMarkup=function(t,e){var n,i=[];if(!t)return n="xml"===e?u.parseXML(""):u.parseHTML(""),new r(n);i=u.parseXML(t);var o=i.map(function(t){return new r(t)});return 1===o.length?o[0]:o},r.wrapNativeElement=function(t){return t._wrapper?t._wrapper:new r(t)},e.exports=r},{"../util/cheerio.customized":337,"./DOMElement":320,"lodash/clone":196,"lodash/extend":200,"lodash/isString":221,"lodash/last":226,"lodash/map":227}],318:[function(t,e,n){"use strict";var r=t("../util/oo"),i=function(){};i.Prototype=function(){this.getName=function(){return this.constructor.static.name},this.getCommandState=function(t,e){throw new Error("Command.getCommandState() is abstract.")},this.execute=function(t,e){throw new Error("Command.execute() is abstract.")},this._getDocumentSession=function(t,e){var n=t.documentSession||e.documentSession;if(!n)throw new Error("'documentSession' is required.");return n},this._getSelection=function(t){var e=t.selection||t.selectionState.getSelection();if(!e)throw new Error("'selection' is required.");return e}},r.initClass(i),e.exports=i},{"../util/oo":342}],319:[function(t,e,n){"use strict";function r(t,e){d.call(this),this.__id__=_++,this.parent=t,this.el=null,this.refs={},this.__foreignRefs__={},this._actionHandlers={},this.context=this._getContext()||{},Object.freeze(this.context),this.props=e||{},Object.freeze(this.props),this.state=this.getInitialState()||{},Object.freeze(this.state)}function i(t){if(t)return t._comp}function o(t){return console.assert(t._comp,"Expecting a back-link to the component instance."),i(t)}function s(t){return t}function a(t,e){if(!t._isComponent)throw new Error("Illegal argument: 'parent' must be a Component.");if(!e._isVirtualHTMLElement)throw new Error("Illegal argument: 'virtualComp' must be a VirtualHTMLElement.");this.parent=t,this.context=this._getContext()||{},Object.freeze(this.context)}function c(t,e){if(!t._isComponent)throw new Error("Illegal argument: 'parent' must be a Component.");if(!e._isVirtualTextNode)throw new Error("Illegal argument: 'virtualComp' must be a VirtualTextNode.");this.parent=t}var u=t("lodash/isString"),h=t("lodash/isFunction"),l=t("lodash/extend"),f=t("lodash/each"),d=t("../util/EventEmitter"),p=t("./RenderingEngine"),g=t("./VirtualElement"),m=t("./DOMElement"),v=t("./DefaultDOMElement"),y=t("../util/inBrowser"),_=0;r.Prototype=function(){function t(t){t.triggerDispose(),t._owner&&t._ref&&(console.assert(t._owner.refs[t._ref]===t,"Owner's ref should point to this child instance."),delete t._owner.refs[t._ref])}function e(t,e){t.isMounted()&&e.triggerDidMount(!0),e._owner&&e._ref&&(e._owner.refs[e._ref]=e)}l(this,d.prototype),this._isComponent=!0,this.getChildContext=function(){return this.childContext||{}},this.getInitialState=function(){return{}},this.getParent=function(){return this.parent},this.getRoot=function(){for(var t=this,e=t;e;)t=e,e=t.getParent();return t},this.getLabel=function(t){var e=this.context.labelProvider;if(!e)throw new Error("Missing labelProvider.");return e.getLabel(t)},this.render=function(t){return t("div")},this.mount=function(t){return this.el||this._render(),t._isDOMElement||(t=v.wrapNativeElement(t)),t.appendChild(this.el),t.isInDocument()&&this.triggerDidMount(!0),this},this.shouldRerender=function(t){return!0},this.rerender=function(){this._rerender(this.props,this.state)},this._rerender=function(t,e){this._render(t,e),this.isMounted()||this.didUpdate(t,e)},this._render=function(t,e){if(this.__isRendering__)throw new Error("Component is rendering already.");this.__isRendering__=!0;try{var n=new p;n._render(this,t,e)}finally{delete this.__isRendering__}},this.triggerDidMount=function(){this.getChildren().forEach(function(t){t.triggerDidMount(!0)}),this.__isMounted__||(this.__isMounted__=!0,this.didMount())},this.didMount=function(){},this.didUpdate=function(){},this.isMounted=function(){return this.__isMounted__},this.triggerDispose=function(){this.getChildren().forEach(function(t){t.triggerDispose()}),this.dispose(),this.__isMounted__=!1},this.dispose=function(){},this._setParent=function(t){this.parent=t,this.context=this._getContext()||{},Object.freeze(this.context)},this.send=function(t){for(var e=this;e;){if(e._actionHandlers&&e._actionHandlers[t])return e._actionHandlers[t].apply(e,Array.prototype.slice.call(arguments,1)),!0;e=e.getParent()}return console.warn("Action",t,"was not handled."),!1},this.handleActions=function(t){return f(t,function(t,e){this.handleAction(e,t)}.bind(this)),this},this.handleAction=function(t,e){if(!t||!e||!h(e))throw new Error("Illegal arguments.");e=e.bind(this),this._actionHandlers[t]=e},this.getState=function(){return this.state},this.setState=function(t){var e=this.props,n=this.state,r=!this.__isSettingProps__&&this.shouldRerender(this.getProps(),t);this.willUpdateState(t),this.state=t||{},Object.freeze(this.state),r?this._rerender(e,n):this.__isSettingProps__||this.didUpdate(e,n)},this.extendState=function(t){t=l({},this.state,t),this.setState(t)},this.willUpdateState=function(t){},this.getProps=function(){return this.props},this.setProps=function(t){var e=this.props,n=this.state,r=this.shouldRerender(t,this.state);this._setProps(t),r?this._rerender(e,n):this.didUpdate(e,n)},this._setProps=function(t){t=t||{},this.__isSettingProps__=!0;try{this.willReceiveProps(t),this.props=t||{},Object.freeze(t)}finally{delete this.__isSettingProps__}},this.extendProps=function(t){var e=l({},this.props,t);this.setProps(e)},this.willReceiveProps=function(t){},this.getChildNodes=function(){if(!this.el)return[];var t=this.el.getChildNodes();return t=t.map(i).filter(s)},this.getChildren=function(){if(!this.el)return[];var t=this.el.getChildren();return t=t.map(i).filter(s)},this.getChildAt=function(t){var e=this.el.getChildAt(t);return o(e)},this.find=function(t){var e=this.el.find(t);return i(e)},this.findAll=function(t){var e=this.el.findAll(t);return e.map(i).filter(s)},this.appendChild=function(t){this.insertAt(this.getChildCount(),t)},this.insertAt=function(t,n){if(u(n)&&(n=new g.TextNode(n)),!n._isVirtualElement)throw new Error('Invalid argument: "child" must be a VirtualElement.');var r=(new p)._renderChild(this,n);this.el.insertAt(t,r.el),e(this,r)},this.removeAt=function(e){var n=this.el.getChildAt(e);if(n){var r=o(n);t(r),this.el.removeAt(e)}},this.removeChild=function(e){if(!e||!e._isComponent)throw new Error("removeChild(): Illegal arguments. Expecting a Component instance.");t(e),this.el.removeChild(e.el)},this.replaceChild=function(e,n){if(!(n&&e&&n._isComponent&&e._isComponent))throw new Error("replaceChild(): Illegal arguments. Expecting BrowserDOMElement instances.");t(e),this.el.replaceChild(n.el,e.el),this.isMounted()&&n.triggerDidMount(!0)},this.empty=function(){return this.el&&(this.getChildNodes().forEach(function(e){t(e)}),this.el.empty()),this},this.remove=function(){t(this),this.el.remove()},this._getContext=function(){var t={},e=this.getParent();return e&&(t=l(t,e.context),e.getChildContext)?l(t,e.getChildContext()):t},this.addEventListener=function(){throw new Error("Not supported.")},this.removeEventListener=function(){throw new Error("Not supported.")},this.insertBefore=function(){throw new Error("Not supported.")}},m.Delegator.extend(r),m._defineProperties(r,m._propertyNames),r.unwrap=i,r.static.render=function(t){t=t||{};var e=this.__class__,n=new e(null,t);return n._render(),n},r.static.mount=function(t,e){if(1===arguments.length&&(t={},e=arguments[0]),u(e)){var n=e;if(!y)throw new Error("This selector is not supported on server side.");e=window.document.querySelector(n)}e._isDOMElement||(e=new v.wrapNativeElement(e));var r=this.__class__,i=new r(null,t);return i.mount(e),i},r.mount=function(t,e,n){return 2===arguments.length&&(e={},n=arguments[1]),t.static.mount(e,n)},a.Prototype=function(){this._isElementComponent=!0},r.extend(a),r.Element=a,c.Prototype=function(){this._isTextNodeComponent=!0,this.setTextContent=function(t){if(!this.el)throw new Error("Component must be rendered first.");if(this.el.textContent!==t){var e=this.el.createTextNode(t);this.el._replaceNativeEl(e.getNativeElement())}}},r.extend(c),r.TextNode=c,Object.defineProperty(r,"$$",{get:function(){throw new Error(["With Substance Beta 4 we introduced a breaking change.","We needed to turn the former static Component.$$ into a contextualized implementation, which is now served via Component.render($$).","FIX: change your signature of 'this.render()' in all your Components to 'this.render($$)"].join("\n"))}}),r.unwrapDOMElement=function(t){return i(t)},e.exports=r},{"../util/EventEmitter":335,"../util/inBrowser":340,"./DOMElement":320,"./DefaultDOMElement":321,"./RenderingEngine":328,"./VirtualElement":333,"lodash/each":198,"lodash/extend":200,"lodash/isFunction":215,"lodash/isString":221}],320:[function(t,e,n){"use strict";function r(){}function i(){this.el=null}function o(t,e,n){if(!l(t)||!u(e))throw new Error("Illegal arguments: 'eventName' must be a String, and 'handler' must be a Function.");n=n||{};var r=e,i=n.context,o=Boolean(n.capture);i&&(e=e.bind(i)),n.once===!0&&(e=s(this,e)),this.eventName=t,this.originalHandler=r,this.handler=e,this.capture=o,this.context=i,this.options=n,this._el=null}function s(t,e){return function(n){e(n),t._el.removeEventListener(t)}}function a(){}var c=t("../util/oo"),u=t("lodash/isFunction"),h=t("lodash/isObject"),l=t("lodash/isString"),f=t("lodash/isArray"),d=t("lodash/findIndex"),p=t("lodash/forEach"),g=t("../util/ArrayIterator");r.Prototype=function(){this._isDOMElement=!0;var t="This method is not implemented.";this.getNativeElement=function(){throw new Error(t)},this.hasClass=function(e){throw new Error(t)},this.addClass=function(e){throw new Error(t)},this.removeClass=function(e){throw new Error(t)},this.attr=function(){if(1===arguments.length){if(l(arguments[0]))return this.getAttribute(arguments[0]);h(arguments[0])&&p(arguments[0],function(t,e){
this.setAttribute(e,t)}.bind(this))}else 2===arguments.length&&this.setAttribute(arguments[0],arguments[1]);return this},this.removeAttr=function(t){var e=t.split(/\s+/);return 1===e.length?this.removeAttribute(t):e.forEach(function(t){this.removeAttribute(t)}.bind(this)),this},this.getAttribute=function(e){throw new Error(t)},this.setAttribute=function(e,n){throw new Error(t)},this.removeAttribute=function(e){throw new Error(t)},this.getAttributes=function(){throw new Error(t)},this.htmlProp=function(){if(1===arguments.length){if(l(arguments[0]))return this.getProperty(arguments[0]);h(arguments[0])&&p(arguments[0],function(t,e){this.setProperty(e,t)}.bind(this))}else 2===arguments.length&&this.setProperty(arguments[0],arguments[1]);return this},this.getProperty=function(e){throw new Error(t)},this.setProperty=function(e,n){throw new Error(t)},this.removeProperty=function(e){throw new Error(t)},this.getTagName=function(){throw new Error(t)},this.setTagName=function(e){throw new Error(t)},this.getId=function(){throw new Error(t)},this.setId=function(e){throw new Error(t)},this.val=function(t){return 0===arguments.length?this.getValue():(this.setValue(t),this)},this.getValue=function(){throw new Error(t)},this.setValue=function(e){throw new Error(t)},this.css=function(){if(1===arguments.length){if(l(arguments[0]))return this.getStyle(arguments[0]);if(!h(arguments[0]))throw new Error("Illegal arguments.");p(arguments[0],function(t,e){this.setStyle(e,t)}.bind(this))}else{if(2!==arguments.length)throw new Error("Illegal arguments.");this.setStyle(arguments[0],arguments[1])}return this},this.getStyle=function(e){throw new Error(t)},this.setStyle=function(e,n){throw new Error(t)},this.text=function(t){return 0===arguments.length?this.getTextContent():(this.setTextContent(t),this)},this.getTextContent=function(){throw new Error(t)},this.setTextContent=function(e){throw new Error(t)},this.html=function(t){return 0===arguments.length?this.getInnerHTML():(this.setInnerHTML(t),this)},this.getInnerHTML=function(){throw new Error(t)},this.setInnerHTML=function(e){throw new Error(t)},this.getOuterHTML=function(){throw new Error(t)},this.on=function(t,e,n,r){if(!l(t))throw new Error('Illegal argument: "event" must be a String.');if(r=r||{},n&&(r.context=n),r.selector&&!l(r.selector))throw new Error("Illegal argument: selector must be a string.");if(!e||!u(e))throw new Error("Illegal argument: invalid handler function for event "+t);return this.addEventListener(t,e,r),this},this.off=function(t,e){if(1!==arguments.length||l(t))this.removeEventListener(t,e);else{var n=arguments[0];this.getEventListeners().filter(function(t){return t.context===n}).forEach(function(t){this.removeEventListener(t)}.bind(this))}return this},this.addEventListener=function(e,n,r){throw new Error(t)},this.removeEventListener=function(e,n){throw new Error(t)},this.getEventListeners=function(){throw new Error(t)},this.getNodeType=function(){if(this.isTextNode())return"text";if(this.isCommentNode())return"comment";if(this.isElementNode())return"element";if(this.isDocumentNode())return"document";throw new Error("Unsupported node type")},this.getChildCount=function(){throw new Error(t)},this.getChildNodes=function(){throw new Error(t)},this.getChildren=function(){throw new Error(t)},this.getChildAt=function(e){throw new Error(t)},this.getChildIndex=function(e){throw new Error(t)},this.getChildNodeIterator=function(){return new g(this.getChildNodes())},this.getLastChild=function(){throw new Error(t)},this.getFirstChild=function(){throw new Error(t)},this.getNextSibling=function(){throw new Error(t)},this.getPreviousSibling=function(){throw new Error(t)},this.isTextNode=function(){throw new Error(t)},this.isElementNode=function(){throw new Error(t)},this.isCommentNode=function(){throw new Error(t)},this.isDocumentNode=function(){throw new Error(t)},this.clone=function(){throw new Error(t)},this.createElement=function(e){throw new Error(t)},this.createTextNode=function(e){throw new Error(t)},this.is=function(e){throw new Error(t)},this.getParent=function(){throw new Error(t)},this.getRoot=function(){throw new Error(t)},this.find=function(e){throw new Error(t)},this.findAll=function(e){throw new Error(t)},this.append=function(t){var e;if(1===arguments.length){if(!f(t))return this.appendChild(t),this;e=t}else e=arguments;return e&&Array.prototype.forEach.call(e,this.appendChild.bind(this)),this},this.appendChild=function(e){throw new Error(t)},this.insertAt=function(e,n){throw new Error(t)},this.insertBefore=function(e,n){throw new Error(t)},this.removeAt=function(e){throw new Error(t)},this.removeChild=function(e){throw new Error(t)},this.replaceChild=function(e,n){throw new Error(t)},this.remove=function(){var t=this.getParent();t&&t.removeChild(this)},this.empty=function(){throw new Error(t)},this.remove=function(){throw new Error(t)},this.serialize=function(){return this.outerHTML},this.isInDocument=function(){return!1},this.focus=function(){return this},this.blur=function(){return this},this.click=function(){return this},this.getWidth=function(){return 0},this.getHeight=function(){return 0},this.getOuterHeight=function(t){return 0},this.getOffset=function(){return{top:0,left:0}},this.getPosition=function(){return{top:0,left:0}}},c.initClass(r);var m={id:{configurable:!0,get:function(){return this.getId()},set:function(t){this.setId(t)}},tagName:{configurable:!0,get:function(){return this.getTagName()},set:function(t){this.setTagName(t)}},nodeName:{configurable:!0,get:function(){return this.getTagName()}},nodeType:{configurable:!0,get:function(){return this.getNodeType()},set:function(){throw new Error("ui/DOMElement#nodeType is readonly.")}},textContent:{configurable:!0,get:function(){return this.getTextContent()},set:function(t){this.setTextContent(t)}},innerHTML:{configurable:!0,get:function(){return this.getInnerHTML()},set:function(t){this.setInnerHTML(t)}},outerHTML:{configurable:!0,get:function(){return this.getOuterHTML()},set:function(){throw new Error("ui/DOMElement#outerHTML is readonly.")}},childNodes:{configurable:!0,get:function(){return this.getChildNodes()},set:function(){throw new Error("ui/DOMElement#childNodes is readonly.")}},children:{configurable:!0,get:function(){return this.getChildren()},set:function(){throw new Error("ui/DOMElement#children is readonly.")}},parentNode:{configurable:!0,get:function(){return this.getParent()},set:function(){throw new Error("ui/DOMElement#parentNode is readonly.")}},height:{configurable:!0,get:function(){return this.getHeight()}},width:{configurable:!0,get:function(){return this.getWidth()}}};r._propertyNames=Object.keys(m),r._defineProperties=function(t,e){e=e||r._propertyNames,e.forEach(function(e){var n=m[e];n&&Object.defineProperty(t.prototype,e,n)})},r.parseHTML=function(e){var n=t("./DefaultDOMElement");return n.parseHTML(e)},r.parseXML=function(e){var n=t("./DefaultDOMElement");return n.parseXML(e)},i.Prototype=function(){var t={getNativeElement:null,hasClass:!1,getAttribute:null,getAttributes:{},getProperty:null,getTagName:"throw",getId:"throw",getValue:null,getStyle:null,getTextContent:"",getInnerHTML:"",getOuterHTML:"",getChildCount:0,getChildNodes:[],getChildren:[],getChildAt:null,getParent:null,getRoot:null,getEventListeners:[],find:null,findAll:[],is:!1,isTextNode:!1,isElementNode:!1,isCommentNode:!1,isDocumentNode:!1,isInDocument:!1,position:null};p(t,function(t,e){this[e]=function(){if(!this.el){if("throw"===t)throw new Error("This component has not been rendered yet.");return t}return this.el[e].apply(this.el,arguments)}}.bind(this)),["addClass","removeClass","setAttribute","removeAttribute","setProperty","removeProperty","setTagName","setId","setValue","setStyle","setTextContent","setInnerHTML","addEventListener","removeEventListener","appendChild","insertAt","insertBefore","remove","removeAt","removeChild","replaceChild","empty","focus","blur","click"].forEach(function(t){this[t]=function(){if(!this.el)throw new Error("This component has not been rendered yet.");return this.el[t].apply(this.el,arguments),this}}.bind(this))},r.extend(i),r.Delegator=i,o.prototype._isDOMEventListener=!0,o.matches=function(t,e){return t.eventName===e.eventName&&t.originalHandler===e.originalHandler},r.EventListener=o,r._findEventListenerIndex=function(t,e,n){var r=-1;return r=arguments[1]._isDOMEventListener?t.indexOf(arguments[1]):d(t,o.matches.bind(null,{eventName:e,originalHandler:n}))},a.Prototype=function(){this._isDOMElement=!0,this.isTextNode=function(){return!0},this.getNodeType=function(){return"text"},this.isElementNode=this.isDocumentNode=this.isCommentNode=function(){return!1},["getParent","getNextSibling","getPreviousSibling","text","getTextContent","setTextContent","clone"].forEach(function(t){this[t]=r.prototype[t]}.bind(this))},c.initClass(a),r.TextNode=a,e.exports=r},{"../util/ArrayIterator":334,"../util/oo":342,"./DefaultDOMElement":321,"lodash/findIndex":203,"lodash/forEach":204,"lodash/isArray":209,"lodash/isFunction":215,"lodash/isObject":219,"lodash/isString":221}],321:[function(t,e,n){"use strict";var r,i=t("../util/inBrowser");r=t(i?"./BrowserDOMElement.js":"./CheerioDOMElement.js");var o={};o.createTextNode=function(t){var e=r.createTextNode(t);return new r(e)},o.createElement=function(t){var e=r.createElement(t);return new r(e)},o._create=function(t){return new r(t)},o.getBrowserWindow=function(){return i?r.getBrowserWindow():o.createElement("div")},o.parseHTML=function(t){return r.parseMarkup(t,"html")},o.parseXML=function(t,e){return r.parseMarkup(t,"xml",e)},o.wrapNativeElement=function(e){if(!e)return null;if(i&&(e instanceof window.Node||e===window)){var n=t("./BrowserDOMElement");return n.wrapNativeElement(e)}if(e.root&&"root"===e.root.type){var r=t("./CheerioDOMElement");return r.wrapNativeElement(e)}},o.isReverse=function(e,n,r,o){if(i){var s=t("./BrowserDOMElement");return s.isReverse(e,n,r,o)}throw new Error("Not implemented.")},e.exports=o},{"../util/inBrowser":340,"./BrowserDOMElement":316,"./BrowserDOMElement.js":316,"./CheerioDOMElement":317,"./CheerioDOMElement.js":317}],322:[function(t,e,n){"use strict";function r(t,e,n){this.owner=t,this.target=e,this.originalEvent=n}e.exports=r},{}],323:[function(t,e,n){"use strict";function r(){r.super.apply(this,arguments)}var i=t("lodash/isEqual"),o=t("lodash/startsWith"),s=t("../model/Coordinate"),a=t("./IsolatedNodeComponent");r.Prototype=function(){var t=r.super.prototype;this.__elementTag="span",this.__slugChar="\ufeff",this.render=function(e){var n=t.render.apply(this,arguments);return n.addClass("sc-inline-node").removeClass("sc-isolated-node").attr("data-id",this.props.node.id).attr("data-inline","1"),n},this._getContentClass=function(e){return t._getContentClass.call(this,e)},this._deriveStateFromSelectionState=function(t){var e=t.getSelection(),n=e.surfaceId;if(n){var r=this.getId(),s=this.props.node,a=this._getSurfaceParent().getId(),c=n===a;if(c){if(e.isPropertySelection()&&!e.isCollapsed()&&i(e.path,s.path)){var u=s.getSelection();if(u.equals(e))return{mode:"selected"};if(e.contains(u))return{mode:"co-selected"}}}else if(o(n,r)){var h=r.split("/"),l=n.split("/");return l.length>=h.length&&l.length<=h.length+1?{mode:"focused"}:{mode:"co-focused"}}}},this._selectNode=function(){var t=this.context.surface,e=t.getDocument(),n=this.props.node;t.setSelection(e.createSelection({type:"property",path:n.path,startOffset:n.startOffset,endOffset:n.endOffset}))}},a.extend(r),r.getCoordinate=function(t){var e=t.getParent();if(t.isTextNode()&&e.is(".se-slug")){var n=e,r=n.getParent();if(r.is(".sc-inline-node")){var i=Number(r.getAttribute("data-offset")),o=Number(r.getAttribute("data-length")),a=i;n.is("sm-after")&&(a+=o);for(var c;r=r.getParent();){var u=r.getAttribute("data-path");if(u){c=u.split(".");var h=new s(c,a);return h.__inInlineNode__=!0,h.__startOffset__=i,h.__endOffset__=i+o,h}}}}return null},e.exports=r},{"../model/Coordinate":7,"./IsolatedNodeComponent":324,"lodash/isEqual":214,"lodash/startsWith":234}],324:[function(t,e,n){"use strict";function r(){r.super.apply(this,arguments),this.name=this.props.node.id,this._id=s(this),this._state={selectionFragment:null},this.handleAction("escape",this._escape),this.ContentClass=this._getContentClass(this.props.node)||c}var i=t("lodash/startsWith"),o=t("../util/keys"),s=t("../util/createSurfaceId"),a=t("../model/Coordinate"),c=t("./Component");r.Prototype=function(){var t=r.super.prototype;this._isIsolatedNodeComponent=!0,this.__elementTag="div",this.__slugChar="|",this.getChildContext=function(){return{surfaceParent:this}},this.getInitialState=function(){var t=this.context.documentSession.getSelectionState();return this._deriveStateFromSelectionState(t)},this.didMount=function(){t.didMount.call(this);var e=this.context.documentSession;e.on("update",this.onSessionUpdate,this)},this.dispose=function(){t.dispose.call(this);var e=this.context.documentSession;e.off(this)},this.render=function(e){var n=this.props.node,r=t.render.apply(this,arguments);r.tagName=this.__elementTag;var i=this.ContentClass;r.addClass("sc-isolated-node").addClass("sm-"+this.props.node.type).attr("data-id",n.id),this.state.mode?r.addClass("sm-"+this.state.mode):r.addClass("sm-not-selected"),i.static.noStyle||r.addClass("sm-default-style"),r.on("mousedown",this.onMousedown),r.on("keydown",this.onKeydown).on("keypress",this._stopPropagation).on("keyup",this._stopPropagation).on("compositionstart",this._stopPropagation).on("textInput",this._stopPropagation),r.append(e(this.__elementTag).addClass("se-slug").addClass("sm-before").ref("before").append(this.__slugChar));var o=this._getLevel(),s=e(this.__elementTag).addClass("se-container").attr("contenteditable",!1).css({"z-index":2*o});if(i.static.fullWidth&&s.addClass("sm-full-width"),"cursor"===this.state.mode&&"before"===this.state.position&&s.append(e(this.__elementTag).addClass("se-cursor").addClass("sm-before").attr("contenteditable",!1)),s.append(this.renderContent(e,n)),this._isDisabled()||"co-focused"===this.state.mode){s.addClass("sm-disabled");var a=e(this.__elementTag).addClass("se-blocker").css({"z-index":2*o+1});s.append(a)}return"cursor"===this.state.mode&&"after"===this.state.position&&s.append(e(this.__elementTag).addClass("se-cursor").addClass("sm-after").attr("contenteditable",!1)),r.append(s),r.append(e(this.__elementTag).addClass("se-slug").addClass("sm-after").ref("after").append(this.__slugChar)),r},this.renderContent=function(t,e){var n=this.ContentClass;if(n){var r={node:e,disabled:this._isDisabled(),isolatedNodeState:this.state.mode};return"focused"===this.state.mode&&(r.focused=!0),t(n,r).ref("content")}return console.error("Could not resolve a component for type: "+e.type),t(this.__elementTag)},this.getId=function(){return this._id},this.getMode=function(){return this.state.mode},this.isNotSelected=function(){return!this.state.mode},this.isSelected=function(){return"selected"===this.state.mode},this.isCoSelected=function(){return"co-selected"===this.state.mode},this.isFocused=function(){return"focused"===this.state.mode},this.isCoFocused=function(){return"co-focused"===this.state.mode},this._getContentClass=function(t){var e=this.context.componentRegistry,n=e.get(t.type);return n},this._isDisabled=function(){return!this.state.mode||["co-selected","cursor"].indexOf(this.state.mode)>-1},this._getSurfaceParent=function(){return this.context.surface},this._getLevel=function(){for(var t=1,e=this._getSurfaceParent();e;)t++,e=e._getSurfaceParent();return t},this.onSessionUpdate=function(t){if(t.selection){var e=this.context.documentSession,n=this._deriveStateFromSelectionState(e.getSelectionState());!n&&this.state.mode?this.setState({}):n&&n.mode!==this.state.mode&&this.setState(n)}},this._deriveStateFromSelectionState=function(t){var e=t.getSelection(),n=e.surfaceId;if(n){var r=this.getId(),o=this.props.node.id,s=this._getSurfaceParent().getId(),a=n===s;if(!a)return e.isCustomSelection()&&r===n?{mode:"focused"}:i(n,r)?"/"===n[r.length]&&n.indexOf("/",r.length+1)<0?{mode:"focused"}:{mode:"co-focused"}:void 0;if(e.isNodeSelection()&&e.getNodeId()===o){if(e.isFull())return{mode:"selected"};if(e.isBefore())return{mode:"cursor",position:"before"};if(e.isAfter())return{mode:"cursor",position:"after"}}if(e.isContainerSelection()&&e.containsNodeFragment(o))return{mode:"co-selected"}}},this.onMousedown=function(t){switch(t.stopPropagation(),this.state.mode){case"selected":case"focused":break;default:t.preventDefault(),this._selectNode(),this.setState({mode:"selected"})}},this.onKeydown=function(t){t.stopPropagation(),t.keyCode===o.ESCAPE&&"focused"===this.state.mode&&(t.preventDefault(),this._escape())},this._escape=function(){this._selectNode(),this.setState({mode:"selected"})},this._stopPropagation=function(t){t.stopPropagation()},this._selectNode=function(){var t=this.context.surface,e=t.getDocument(),n=this.props.node.id;t.setSelection(e.createSelection({type:"node",containerId:t.getContainerId(),nodeId:n,mode:"full"}))}},c.extend(r),r.getCoordinate=function(t,e){var n=e.getParent();if(e.isTextNode()&&n.is(".se-slug")){var r=n,i=r.getParent(),o=i.getAttribute("data-id");if(o){var s=r.is("sm-after")?1:0;return new a([o],s)}console.error("FIXME: expecting a data-id attribute on IsolatedNodeComponent")}return null},r.getDOMCoordinate=function(t,e){var n;return n=0===e.offset?{container:t.refs.before.getNativeElement(),offset:0}:{container:t.refs.after.getNativeElement(),offset:1}},r.getDOMCoordinates=function(t){return{start:{container:t.refs.before.getNativeElement(),offset:0},end:{container:t.refs.after.getNativeElement(),offset:1}}},e.exports=r},{"../model/Coordinate":7,"../util/createSurfaceId":338,"../util/keys":341,"./Component":319,"lodash/startsWith":234}],325:[function(t,e,n){"use strict";function r(){r.super.apply(this,arguments)}var i=t("./Component");r.Prototype=function(){this.render=function(t){var e=this.getTagName(),n=t(e).attr("data-id",this.props.node.id).addClass("sc-node");return n},this.getTagName=function(){return"div"}},i.extend(r),e.exports=r},{"./Component":319}],326:[function(t,e,n){"use strict";function r(){i.apply(this,arguments),this.commandStates=this._getCommandStates()}var i=t("./Component");r.Prototype=function(){this.shouldRerender=function(){var t=this._getCommandStates();return t!==this.commandStates&&(this.commandStates=t,!0)},this.render=function(t){var e=t("div").addClass("sc-overlay sm-hidden"),n=this.context.commandManager.getCommandStates(),r=this.props.overlay;return e.append(t(r,{commandStates:n}).ref("overlayContent")),e},this.didMount=function(){this.context.documentSession.on("didUpdate",this._onSessionDidUpdate,this)},this.dispose=function(){this.context.documentSession.off(this)},this.position=function(t){var e=this.refs.overlayContent;e.childNodes.length>0&&(this._position(t),this.el.removeClass("sm-hidden"))},this._onSessionDidUpdate=function(){this.shouldRerender()&&this.rerender()},this._getCommandStates=function(){return this.context.commandManager.getCommandStates()},this._position=function(t){if(t){var e=this.el.htmlProp("offsetWidth"),n=t.rectangle.width;this.el.css("top",t.rectangle.top+t.rectangle.height);var r=t.rectangle.left+n/2-e/2;r=Math.max(r,0);var i=t.rectangle.left+n+t.rectangle.right-e;r=Math.min(r,i),this.el.css("left",r)}}},i.extend(r),e.exports=r},{"./Component":319}],327:[function(t,e,n){"use strict";function r(){r.super.apply(this,arguments)}function i(){i.super.apply(this,arguments)}function o(){i.super.apply(this,arguments)}function s(){s.super.apply(this,arguments)}function a(){u.apply(this,arguments)}function c(){s.super.apply(this,arguments)}var u=t("./Component");r.Prototype=function(){this.render=function(t){var e=t("div").addClass("sc-prompt");return e.append(t("div").addClass("se-arrow")),e.append(t("div").addClass("se-content").append(this.props.children)),e}},u.extend(r),i.Prototype=function(){this.render=function(t){var e=this.context.iconProvider.renderIcon(t,this.props.name),n=t("button").attr({title:this.props.title}).addClass("se-action").append(e);return n}},u.extend(i),o.Prototype=function(){this.render=function(t){var e=this.context.iconProvider.renderIcon(t,this.props.name),n=t("a").attr({href:this.props.href,title:this.props.title,target:"blank"}).addClass("se-action").append(e,"\ufeff");return n}},u.extend(o),s.Prototype=function(){this.render=function(t){var e=t("div").addClass("se-label").append(this.props.label);return e}},u.extend(s),a.Prototype=function(){this._onChange=function(){var t=this.context.documentSession,e=this.props.path,n=this.el.val();t.transaction(function(t){t.set(e,n)})},this.render=function(t){var e=this.context.documentSession,n=e.getDocument(),r=n.get(this.props.path),i=t("input").attr({value:r,type:this.props.type||"text",placeholder:this.props.placeholder}).on("change",this._onChange).addClass("se-input");return i}},u.extend(a),c.Prototype=function(){this.render=function(t){return t("div").addClass("se-separator")}},u.extend(c),r.Action=i,r.Label=s,r.Link=o,r.Input=a,r.Separator=c,e.exports=r},{"./Component":319}],328:[function(t,e,n){"use strict";function r(){}function i(t){this.owner=t,this.refs={},this.foreignRefs={},this.elements=[],this.components=[],this.$$=this._createComponent.bind(this),this.$$.capturing=!0}function o(t){var e=new l.Component(t.constructor);return e._comp=t,t.__htmlConfig__&&e._mergeHTMLConfig(t.__htmlConfig__),e}function s(){this.poluted=[],this.id="__"+u()}var a=t("lodash/each"),c=t("../util/oo"),u=t("../util/uuid"),h=t("../util/substanceGlobals"),l=t("./VirtualElement"),f=t("./DefaultDOMElement");r.Prototype=function(){function e(n,r){var i=t("./Component"),o=r._comp;console.assert(!o,"Component instance should not exist when this method is used.");var s=r.parent._comp;return s||(s=e(n,r.parent)),r._isVirtualComponent?(console.assert(s,"A Component should have a parent."),o=new r.ComponentClass(s,r.props),o.__htmlConfig__=r._copyHTMLConfig()):r._isVirtualHTMLElement?o=new i.Element(s,r):r._isVirtualTextNode&&(o=new i.TextNode(s,r)),r._ref&&(o._ref=r._ref),r._owner&&(o._owner=r._owner._comp),r._comp=o,o}function n(t,r,o){if(t.isCaptured(r))return r;var s=r._comp;if(s||(s=e(t,r),t.setNew(r)),r._isVirtualComponent){var a;if(o?a=!0:(a=!s.el||s.shouldRerender(r.props),s.__htmlConfig__=r._copyHTMLConfig(),t.setOldProps(r,s.props),t.setOldState(r,s.state),s._setProps(r.props),t.isNew(r)||t.setUpdated(r)),a){var c=new i(r),u=s.render(c.$$);if(!u||!u._isVirtualHTMLElement)throw new Error("Component.render must return VirtualHTMLElement");if(s.__htmlConfig__&&u._mergeHTMLConfig(s.__htmlConfig__),u._comp=s,r._content=u,!t.isNew(r)&&s.isMounted()&&t.setUpdated(r),y(t,s,u),h.DEBUG_RENDERING){for(var l=u.children.slice(0);l.length;){var f=l.shift();t.isCaptured(f)||f._isVirtualComponent||(f._comp||e(t,f),f._isVirtualHTMLElement&&f.children.length>0&&(l=l.concat(f.children)),t.setCaptured(f))}t.setCaptured(u);for(var d=new O(t,c);d.hasPendingCaptures();)d.reset(),s.render(d.$$)}else n(t,r._content)}else t.setSkipped(r)}else if(r._isVirtualHTMLElement)for(var p=0;p<r.children.length;p++)n(t,r.children[p]);return t.setCaptured(r),r}function s(t,e){if(!t.isSkipped(e)){console.assert(t.isCaptured(e),"VirtualElement must be captured before rendering");var n=e._comp;if(console.assert(n&&n._isComponent,"A captured VirtualElement must have a component instance attached."),e._isVirtualComponent)return void s(t,e._content);if(n.el||(n.el=w(e),n.el._comp=n),b(n,e),e._isVirtualHTMLElement&&!e.hasInnerHTML()){var r,i,o,c=e.children,u=0,h=0,l=[];for(n.el.getChildNodes().forEach(function(e){var r=e._comp;!r||t.isRelocated(r)?n.el.removeChild(e):l.push(r)});u<l.length||h<c.length;){do r=l[u++];while(r&&t.isDetached(r));if(i=c[h++],r&&!i){for(;r;)m(t,n,r),r=l[u++];break}r&&r.el.isTextNode()&&i&&i._isVirtualTextNode&&r.el.textContent===i.text||(t.isRendered(i)||s(t,i),o=i._comp,t.isRelocated(o)&&o._setParent(n),console.assert(o,"Component instance should now be available."),!i||r?t.isMapped(i)?o===r||(t.setDetached(r),m(t,n,r),h--):t.isMapped(r)?(g(t,n,o,r),u--):p(t,n,r,o):d(t,n,o))}}var f={},v={};e._context&&(a(e._context.refs,function(t,e){f[e]=t._comp}),a(e._context.foreignRefs,function(t,e){v[e]=t._comp})),n.refs=f,n.__foreignRefs__=v,t.setRendered(e)}}function u(t,e){e._isVirtualComponent?(t.isSkipped(e)||e._content.children.forEach(u.bind(null,t)),t.isUpdated(e)&&e._comp.didUpdate(t.getOldProps(e),t.getOldState(e))):e._isVirtualHTMLElement&&e.children.forEach(u.bind(null,t))}function d(t,e,n){e.el.appendChild(n.el),v(t,e,n)}function p(t,e,n,r){e.el.replaceChild(n.el,r.el),t.isDetached(n)||n.triggerDispose(),v(t,e,r)}function g(t,e,n,r){e.el.insertBefore(n.el,r.el),v(t,e,n)}function m(t,e,n){e.el.removeChild(n.el),t.isDetached(n)||n.triggerDispose()}function v(t,e,n){t.isDetached(n)||!e.isMounted()||n.isMounted()||n.triggerDidMount(!0)}function y(t,e,n){var r={},i={};n._context&&(r=n._context.refs,i=n._context.foreignRefs);var o=e.refs,s=e.__foreignRefs__;a(r,function(e,n){var r=o[n];r&&_(t,r,e)}),a(i,function(e,n){var r=s[n];r&&_(t,r,e)})}function _(t,e,n){if(!e&&!n)return!0;if(!e||!n)return!1;if(t.isMapped(n)||t.isMapped(e))return n._comp===e;if(n._comp)return n._comp===e&&(t.setMapped(n),t.setMapped(e),!0);if(!x(e,n))return!1;n._comp=e,t.setMapped(n),t.setMapped(e);var r,i=e.getParent();if(n.parent)r=_(t,i,n.parent);else if(n._preliminaryParent){for(;i&&i._isElementComponent;)i=i.getParent();r=_(t,i,n._preliminaryParent)}return r||(t.setRelocated(n),t.setRelocated(e)),r}function x(t,e){return t._isElementComponent&&e._isVirtualHTMLElement||t._isComponent&&e._isVirtualComponent&&t.constructor===e.ComponentClass||t._isTextNodeComponent&&e._isVirtualTextNode}function w(t){var e;return e=t._isVirtualTextNode?f.createTextNode(t.text):f.createElement(t.tagName)}function b(t,e){if(t._isTextNodeComponent)return void t.setTextContent(e.text);var n=t.el;console.assert(n,"Component's element should exist at this point.");var r=n.getTagName();if(e.tagName!==r&&n.setTagName(e.tagName),C({oldHash:n.getAttributes(),newHash:e.getAttributes(),update:function(t,e){n.setAttribute(t,e)},remove:function(t){n.removeAttribute(t)}}),C({oldHash:n.htmlProps,newHash:e.htmlProps,update:function(t,e){n.setProperty(t,e)},remove:function(t){n.removeProperty(t)}}),E({el:n,oldListeners:n.getEventListeners(),newListeners:e.getEventListeners()}),e.hasInnerHTML()){if(n._hasInnerHTML){var i=n.getInnerHTML(),o=e.getInnerHTML();i!==o&&n.setInnerHTML(o)}else n.empty(),n.setInnerHTML(e.getInnerHTML());n._hasInnerHTML=!0}}function C(t){var e,n=t.newHash,r=t.oldHash||{},i={},o=t.update,s=t.remove;for(e in n)if(n.hasOwnProperty(e)){var a=r[e],c=n[e];i[e]=!0,a!==c&&o(e,c)}for(e in r)r.hasOwnProperty(e)&&!i[e]&&s(e)}function E(t){var e=t.el,n=t.newListeners||[];e.removeAllEventListeners();for(var r=0;r<n.length;r++)e.addEventListener(n[r])}function O(t,e){this.state=t,this.owner=e.owner,this.refs={},this.foreignRefs={},this.elements=e.elements,this.pos=0,this.updates=e.components.length,this.remaining=this.updates,this.$$=this._createComponent.bind(this)}this._render=function(t,e,i){var a=o(t),c=new r.State;e&&c.setOldProps(a,e),i&&c.setOldState(a,i);try{n(c,a,"forceCapture"),a._isVirtualComponent?s(c,a._content):s(c,a),u(c,a)}finally{c.dispose()}},this._renderChild=function(t,e){var i=new r.State;e.parent={_comp:t};try{return n(i,e),s(i,e),e._comp}finally{i.dispose()}},O.Prototype=function(){this._createComponent=function(){var t=this.state,e=this.elements[this.pos++];return!t.isCaptured(e)&&e._isVirtualComponent&&e.parent&&t.isCaptured(e.parent)&&(n(t,e),this.updates++,this.remaining--),e=l.createElement.apply(null,arguments),e._context=this,e._owner=this.owner,e._attach=function(){},e._detach=function(){},e},this.hasPendingCaptures=function(){return this.updates>0&&this.remaining>0},this.reset=function(){this.pos=0,this.updates=0},this._ancestorsReady=function(t){for(;t;){if(this.state.isCaptured(t)||t===this.owner||t===this.owner._content)return!0;t=t.parent}return!1}},c.initClass(O),r._internal={_capture:n,_wrap:o}},c.initClass(r),i.prototype._createComponent=function(){var t=l.createElement.apply(null,arguments);return t._context=this,t._owner=this.owner,t._isVirtualComponent&&this.components.push(t),this.elements.push(t),t},r.createContext=function(t){var e=o(t);return new i(e)},s.Prototype=function(){this.dispose=function(){var t=this.id;this.poluted.forEach(function(e){delete e[t]})},this.set=function(t,e,n){var r=t[this.id];r||(r={},t[this.id]=r),r[e]=n},this.get=function(t,e){var n=t[this.id];if(n)return n[e]},this.setMapped=function(t){this.set(t,"mapped",!0)},this.isMapped=function(t){return Boolean(this.get(t,"mapped"))},this.setRelocated=function(t){this.set(t,"relocated",!0)},this.isRelocated=function(t){return Boolean(this.get(t,"relocated"))},this.setDetached=function(t){this.set(t,"detached",!0)},this.isDetached=function(t){return Boolean(this.get(t,"detached"))},this.setCaptured=function(t){this.set(t,"captured",!0)},this.isCaptured=function(t){return Boolean(this.get(t,"captured"))},this.setNew=function(t){this.set(t,"created",!0)},this.isNew=function(t){return Boolean(this.get(t,"created"))},this.setUpdated=function(t){this.set(t,"updated",!0)},this.isUpdated=function(t){return Boolean(this.get(t,"updated"))},this.setSkipped=function(t){this.set(t,"skipped",!0)},this.isSkipped=function(t){return Boolean(this.get(t,"skipped"))},this.setRendered=function(t){this.set(t,"rendered",!0)},this.isRendered=function(t){return Boolean(this.get(t,"rendered"))},this.setOldProps=function(t,e){this.set(t,"oldProps",e)},this.getOldProps=function(t){return this.get(t,"oldProps")},this.setOldState=function(t,e){this.set(t,"oldState",e)},this.getOldState=function(t){return this.get(t,"oldState")}},c.initClass(s),r.State=s,e.exports=r},{"../util/oo":342,"../util/substanceGlobals":343,"../util/uuid":344,"./Component":319,"./DefaultDOMElement":321,"./VirtualElement":333,"lodash/each":198}],329:[function(t,e,n){"use strict";function r(){r.super.apply(this,arguments)}var i=t("./BlockNodeComponent"),o=t("./TextPropertyComponent");r.Prototype=function(){var t=r.super.prototype;this.render=function(e){var n=t.render.call(this,e);return n.append(e(o,{path:[this.props.node.id,"content"]})),n}},i.extend(r),e.exports=r},{"./BlockNodeComponent":315,"./TextPropertyComponent":330}],330:[function(t,e,n){"use strict";function r(){r.super.apply(this,arguments)}function i(t,e,n){for(var r={el:null,path:null,node:e,offset:n};e&&e!==t;){if(e.isElementNode()){var i=e.getAttribute("data-path");if(i)return r.el=e,r.path=i.split("."),r;e.getAttribute("data-inline")&&(r.node=e,n>0&&(r.offset=1))}e=e.getParent()}return null}function o(t,e){var n,r,i=e;if(n=t.getParent(),t.isTextNode())if(t===n.firstChild){var a=n.getAttribute("data-path"),c=n.getAttribute("data-offset");i=a?e:c?parseInt(c,10)+e:o(n,0)+e}else r=n.getChildIndex(t),i=o(n,r)+e;else{if(!t.isElementNode())return null;var u=t.getAttribute("data-path"),h=t.getAttribute("data-offset");u?i=s(t,e):h?(r=n.getChildIndex(t),i=parseInt(h,10)+s(t,e)):(r=n.getChildIndex(t),i=o(n,r)+s(t,e))}return i}function s(t,e){var n=0;if(t.getAttribute("data-inline"))return 0===e?0:1;var r=t.getChildCount();1===arguments.length&&(e=r),e=Math.min(r,e);for(var i=0,o=t.getFirstChild();i<e;o=o.getNextSibling(),i++)if(o.isTextNode())n+=o.getTextContent().length;else if(o.isElementNode()){var a=o.getAttribute("data-length");n+=o.getAttribute("data-inline")?1:a?parseInt(a,10):s(o)}return n}var a=t("lodash/isNumber"),c=t("../model/Coordinate"),u=t("./AnnotatedTextComponent");r.Prototype=function(){var t=r.super.prototype;this.didMount=function(){t.didMount.call(this);var e=this.getSurface();e&&e._registerTextProperty(this)},this.dispose=function(){t.dispose.call(this);var e=this.getSurface();e&&e._unregisterTextProperty(this)},this.render=function(t){var e=this.getPath(),n=this._renderContent(t).addClass("sc-text-property").attr({
"data-path":e.join("."),spellCheck:!1}).css({"white-space":"pre-wrap"});return this.props.editable&&n.attr("contentEditable",!0),n.append(t("br")),n},this._renderFragment=function(e,n){var r,i=n.node,o=i.id;if("cursor"===i.type||"selection-fragment"===i.type)if(r=e("span").addClass("se-"+i.type),"cursor"===i.type&&(r.append("\ufeff"),r.append(e("div").addClass("se-cursor-inner"))),i.collaborator){var s=i.collaborator.colorIndex;r.addClass("sm-collaborator-"+s)}else r.addClass("sm-local-user");else r=t._renderFragment.apply(this,arguments),i.constructor.static.isInline?r.ref(o):this.context.config&&this.context.config.preservativeTextPropertyRendering&&r.ref(o+"@"+n.counter);return r.attr("data-offset",n.pos),r},this.getPath=function(){return this.props.path},this.getText=function(){return this.getDocument().get(this.getPath())},this.getAnnotations=function(){var t=this.getPath(),e=this.getDocument().getIndex("annotations").get(t),n=this.props.fragments;return n&&(e=e.concat(n)),e},this.setFragments=function(){this.children[0].extendProps({annotations:this.getAnnotations()})},this.getDocument=function(){return this.props.doc||this.context.doc},this.getController=function(){return this.props.controller||this.context.controller},this.getSurface=function(){return this.props.surface||this.context.surface},this.isEditable=function(){return this.getSurface().isEditable()},this.isReadonly=function(){return this.getSurface().isReadonly()},this.getDOMCoordinate=function(t){return this._getDOMCoordinate(this.el,t)},this._finishFragment=function(t,e,n){e.attr("data-length",t.length),n.append(e)},this._getDOMCoordinate=function(t,e){var n,r=0;if(0===e)return{container:t.getNativeElement(),offset:0};for(var i=t.getFirstChild();i;i=i.getNextSibling(),r++)if(i.isTextNode()){if(n=i.textContent.length,n>=e)return{container:i.getNativeElement(),offset:e};e-=n}else if(i.isElementNode()){var o=i.getAttribute("data-length");if(!o)return console.error("FIXME: Can not map to DOM coordinates."),null;if(n=parseInt(o,10),n>=e){if(i.attr("data-inline")){var s=i.getNextSibling();return s&&s.isTextNode()?{container:s.getNativeElement(),offset:0}:{container:t.getNativeElement(),offset:t.getChildIndex(i)+1}}return this._getDOMCoordinate(i,e,r)}e-=n}}},u.extend(r),r.getCoordinate=function(t,e,n){var r=i(t,e,n);if(!r)return null;e=r.node,n=r.offset;var s=o(r.node,r.offset);return a(s)?new c(r.path,s):null},e.exports=r},{"../model/Coordinate":7,"./AnnotatedTextComponent":311,"lodash/isNumber":218}],331:[function(t,e,n){"use strict";function r(){r.super.apply(this,arguments)}var i=t("lodash/capitalize"),o=t("lodash/extend"),s=t("./Component");r.Prototype=function(){this.render=function(t){var e=t("div").addClass("se-tool"),n=this.getClassNames();n&&e.addClass(n);var r=this.getTitle();return r&&(e.attr("title",r),e.attr("aria-label",r)),this.props.disabled&&e.addClass("sm-disabled"),this.props.active&&e.addClass("sm-active"),e.append(this.renderButton(t)),e},this.getClassNames=function(){return""},this.renderButton=function(t){var e=t("button").on("click",this.onClick).append(this.renderIcon(t));return this.props.disabled?e.attr("tabindex",-1).attr("disabled",!0):e.attr("tabindex",1),e},this.renderIcon=function(t){var e=this.getCommandName(),n=this.context.iconProvider.renderIcon(t,e);return n},this.getTitle=function(){var t=this.context.labelProvider,e=this.props.title||t.getLabel(this.getName());return this.props.mode&&(e=[i(this.props.mode),e].join(" ")),e},this.getName=function(){return this.constructor.static.name},this.getCommandName=function(){return this.constructor.static.command||this.constructor.static.name},this.onClick=function(t){t.preventDefault(),t.stopPropagation(),this.props.disabled||this.performAction()},this.performAction=function(t){this.context.commandManager.executeCommand(this.getCommandName(),o({mode:this.props.mode},t))}},s.extend(r),e.exports=r},{"./Component":319,"lodash/capitalize":195,"lodash/extend":200}],332:[function(t,e,n){"use strict";function r(){i.apply(this,arguments)}var i=t("./Component");r.Prototype=function(){this.render=function(t){var e=t("div").addClass("sc-tool-group");return e.append(this.props.children),e}},i.extend(r),e.exports=r},{"./Component":319}],333:[function(t,e,n){"use strict";function r(t){this.parent=null,this._owner=t,this._ref=null}function i(t){i.super.call(this),this._tagName=t,this.classNames=null,this.attributes=null,this.htmlProps=null,this.style=null,this.eventListeners=null,this.children=[]}function o(t,e){o.super.call(this),e=e||{},this.ComponentClass=t,this.props=e,e.children||(e.children=[]),this.children=e.children}function s(t){this.text=t}var a=t("lodash/isFunction"),c=t("lodash/isString"),u=t("lodash/isArray"),h=t("lodash/map"),l=t("lodash/clone"),f=t("lodash/extend"),d=t("lodash/omit"),p=t("lodash/without"),g=t("./DOMElement");r.Prototype=function(){this._isVirtualElement=!0,this.getParent=function(){return this.parent},this.ref=function(t){if(!t)throw new Error("Illegal argument");return this._ref=t,this._context&&(this._context.refs[t]=this),this}},g.extend(r),g._defineProperties(r,p(g._propertyNames,"children")),i.Prototype=function(){this._isVirtualHTMLElement=!0,this.getTagName=function(){return this._tagName},this.setTagName=function(t){return this._tagName=t,this},this.hasClass=function(t){return!!this.classNames&&this.classNames.indexOf(t)>-1},this.addClass=function(t){return this.classNames||(this.classNames=[]),this.classNames.push(t),this},this.removeClass=function(t){return this.classNames&&(this.classNames=p(this.classNames,t)),this},this.removeAttr=function(t){return this.attributes&&(c(t)?delete this.attributes[t]:this.attributes=d(this.attributes,t)),this},this.getAttribute=function(t){if(this.attributes)return this.attributes[t]},this.setAttribute=function(t,e){return this.attributes||(this.attributes={}),this.attributes[t]=e,this},this.getAttributes=function(){var t={};return this.attributes&&f(t,this.attributes),this.classNames&&(t.class=this.classNames.join(" ")),this.style&&(t.style=h(this.style,function(t,e){return e+":"+t}).join(";")),t},this.getId=function(){return this.getAttribute("id")},this.setId=function(t){return this.setAttribute("id",t),this},this.setTextContent=function(t){return t=t||"",this.empty(),this.appendChild(t),this},this.setInnerHTML=function(t){return t=t||"",this.empty(),this._innerHTMLString=t,this},this.getInnerHTML=function(){if(this.hasOwnProperty("_innerHTMLString"))return this._innerHTMLString;throw new Error("Not supported.")},this.getValue=function(){return this.htmlProp("value")},this.setValue=function(t){return this.htmlProp("value",t),this},this.getChildNodes=function(){return this.children},this.getChildren=function(){return this.children.filter(function(t){return"text"!==t.getNodeType()})},this.isTextNode=function(){return!1},this.isElementNode=function(){return!0},this.isCommentNode=function(){return!1},this.isDocumentNode=function(){return!1},this.append=function(){if(this._innerHTMLString)throw Error("It is not possible to mix $$.html() with $$.append(). You can call $$.empty() to reset this virtual element.");return this._append(this.children,arguments),this},this.appendChild=function(t){if(this._innerHTMLString)throw Error("It is not possible to mix $$.html() with $$.append(). You can call $$.empty() to reset this virtual element.");return this._appendChild(this.children,t),this},this.insertAt=function(t,e){if(e=this._normalizeChild(e),!e)throw new Error("Illegal child: "+e);if(!e._isVirtualElement)throw new Error("Illegal argument for $$.insertAt():"+e);if(t<0||t>this.children.length)throw new Error("insertAt(): index out of bounds.");return this._insertAt(this.children,t,e),this},this.insertBefore=function(t,e){var n=this.children.indexOf(e);if(!(n>-1))throw new Error("insertBefore(): reference node is not a child of this element.");return this.insertAt(n,t),this},this.removeAt=function(t){if(t<0||t>=this.children.length)throw new Error("removeAt(): Index out of bounds.");return this._removeAt(t),this},this.removeChild=function(t){if(!t||!t._isVirtualElement)throw new Error("removeChild(): Illegal arguments. Expecting a CheerioDOMElement instance.");var e=this.children.indexOf(t);if(e<0)throw new Error("removeChild(): element is not a child.");return this.removeAt(e),this},this.replaceChild=function(t,e){if(!(e&&t&&e._isVirtualElement&&t._isVirtualElement))throw new Error("replaceChild(): Illegal arguments. Expecting BrowserDOMElement instances.");var n=this.children.indexOf(t);if(n<0)throw new Error("replaceChild(): element is not a child.");return this.removeAt(n),this.insertAt(n,e),this},this.empty=function(){for(var t=this.children;t.length;){var e=t.pop();e.parent=null}return delete this._innerHTMLString,this},this.getProperty=function(t){if(this.htmlProps)return this.htmlProps[t]},this.setProperty=function(t,e){return this.htmlProps||(this.htmlProps={}),this.htmlProps[t]=e,this},this.removeProperty=function(t){return this.htmlProps&&delete this.htmlProps[t],this},this.getStyle=function(t){if(this.style)return this.style[t]},this.setStyle=function(t,e){return this.style||(this.style={}),this.style[t]=e,this},this.addEventListener=function(t,e,n){var r;return 1===arguments.length&&arguments[0]._isDOMEventListener?r=arguments[0]:(n=n||{},n.context=n.context||this._owner._comp,r=new g.EventListener(t,e,n)),this.eventListeners||(this.eventListeners=[]),this.eventListeners.push(r),this},this.removeEventListener=function(t,e){return this.eventListeners&&g._findEventListenerIndex(this.eventListeners,t,e),this},this.getEventListeners=function(){return this.eventListeners},this.getNodeType=function(){return"element"},this.hasInnerHTML=function(){return Boolean(this._innerHTMLString)},this._normalizeChild=function(t){return c(t)&&(t=new s(t)),t},this._append=function(t,e){if(1===e.length&&!u(e[0]))return void this._appendChild(t,e[0]);var n;if(u(e[0]))n=e[0];else{if(!(arguments.length>1))return;n=Array.prototype.slice.call(e,0)}n.forEach(this._appendChild.bind(this,t))},this._appendChild=function(t,e){if(e=this._normalizeChild(e))return t.push(e),this._attach(e),e},this._insertAt=function(t,e,n){n&&(t.splice(e,0,n),this._attach(n))},this._removeAt=function(t,e){var n=t[e];t.splice(e,1),this._detach(n)},this._attach=function(t){t.parent=this,this._context&&t._owner!==this._owner&&t._ref&&(this._context.foreignRefs[t._ref]=t)},this._detach=function(t){t.parent=null,this._context&&t._owner!==this._owner&&t._ref&&delete this.context.foreignRefs[t._ref]},this._mergeHTMLConfig=function(t){t.classNames&&(this.classNames||(this.classNames=[]),this.classNames=this.classNames.concat(t.classNames)),t.attributes&&(this.attributes||(this.attributes={}),f(this.attributes,t.attributes)),t.htmlProps&&(this.htmlProps||(this.htmlProps={}),f(this.htmlProps,t.htmlProps)),t.style&&(this.style||(this.style={}),f(this.style,t.style)),t.eventListeners&&(this.eventListeners||(this.eventListeners=[]),this.eventListeners=this.eventListeners.concat(t.eventListeners))}},r.extend(i),o.Prototype=function(){function t(t,e){this.virtualEl=t,this.name=e,Object.freeze(this)}this._isVirtualComponent=!0,this.getComponent=function(){return this._comp},this.getChildren=function(){return this.props.children},this.getNodeType=function(){return"component"},this.outlet=function(e){return new t(this,e)},this._attach=function(t){t._preliminaryParent=this},this._detach=function(t){t._preliminaryParent=null},this._copyHTMLConfig=function(){return{classNames:l(this.classNames),attributes:l(this.attributes),htmlProps:l(this.htmlProps),style:l(this.style),eventListeners:l(this.eventListeners)}},t.prototype._getOutlet=function(){var t=this.virtualEl.props[this.name];return t||(t=[],this.virtualEl.props[this.name]=t),t},t.prototype.append=function(){var t=this._getOutlet();return this.virtualEl._append(t,arguments),this},t.prototype.empty=function(){var t=this.virtualEl.props[this.name];return t.forEach(function(t){this._detach(t)}.bind(this)),t.splice(0,t.length),this}},i.extend(o),s.Prototype=function(){this._isVirtualTextNode=!0},r.extend(s),r.Component=o,r.TextNode=s,r.createElement=function(){var t=null;if(c(arguments[0])){if(1!==arguments.length)throw new Error("Illegal usage of VirtualElement.createElement()");t=new i(arguments[0])}else{if(!a(arguments[0])||!arguments[0].prototype._isComponent)throw void 0===arguments[0]?new Error("Provided Component was undefined."):new Error("Illegal usage of VirtualElement.createElement()");if(arguments.length<1||arguments.length>2)throw new Error("Illegal usage of VirtualElement.createElement()");var e={};2===arguments.length&&(e=l(arguments[1])),t=new o(arguments[0],e)}return t},e.exports=r},{"./DOMElement":320,"lodash/clone":196,"lodash/extend":200,"lodash/isArray":209,"lodash/isFunction":215,"lodash/isString":221,"lodash/map":227,"lodash/omit":230,"lodash/without":244}],334:[function(t,e,n){"use strict";function r(t){this.arr=t,this.pos=-1}var i=t("./oo");r.Prototype=function(){this._isArrayIterator=!0,this.hasNext=function(){return this.pos<this.arr.length-1},this.next=function(){this.pos+=1;var t=this.arr[this.pos];return t},this.back=function(){return this.pos>=0&&(this.pos-=1),this}},i.initClass(r),e.exports=r},{"./oo":342}],335:[function(t,e,n){"use strict";function r(){this.__events__={}}var i=t("./oo"),o=t("lodash/forEach"),s=t("lodash/isObject"),a=t("./warn");r.Prototype=function(){function t(t,e){return e.priority-t.priority}function e(t,e){if("string"==typeof t){if(void 0===e||null===e)throw new Error('Method name "'+t+'" has no context.');if(!(t in e))throw new Error('Method not found: "'+t+'"');if("function"!=typeof e[t])throw new Error('Property "'+t+'" is not a function')}else if("function"!=typeof t)throw new Error("Invalid callback. Function or method name expected.")}function n(t,n,r,i){var o;return e(n,r),o=this.__events__.hasOwnProperty(t)?this.__events__[t]:this.__events__[t]=[],o.push({method:n,context:r||null,priority:i}),this}function r(t,n,r){var i,o;if(1===arguments.length)return delete this.__events__[t],this;if(e(n,r),!(t in this.__events__&&this.__events__[t].length))return this;for(arguments.length<3&&(r=null),o=this.__events__[t],i=o.length;i--;)o[i].method===n&&o[i].context===r&&o.splice(i,1);return 0===o.length&&delete this.__events__[t],this}function i(e,r,i){var s=0;return 3===arguments.length&&(s=i.priority||s),o(r,function(r,i){n.call(this,i,r,e,s),this.__events__[i].sort(t)}.bind(this)),this}function c(t){return o(this.__events__,function(e,n){for(var i=e.length-1;i>=0;i--)e[i]&&e[i].context===t&&r.call(this,n,e[i].method,t)}.bind(this)),this}this.emit=function(t){if(t in this.__events__){for(var e=this.__events__[t].slice(),n=Array.prototype.slice.call(arguments,1),r=0,i=e.length;r<i;r++){var o=e[r];o.method.apply(o.context,n)}return!0}return!1},this.connect=function(t,e,n){return a("DEPRECATED: Use EventEmitter.on(event, method, context) instead."),i.apply(this,arguments)},this.disconnect=function(t){return a("DEPRECATED: Use EventEmitter.off(listener) instead."),c.call(this,t)},this.on=function(e,r,i,o){var s=0;4===arguments.length&&(s=o.priority||s),n.call(this,e,r,i,s),this.__events__[e].sort(t)},this.off=function(t,e,n){1===arguments.length&&s(arguments[0])?c.call(this,arguments[0]):r.apply(this,arguments)},this._debugEvents=function(){console.log("### EventEmitter: ",this),o(this.__events__,function(t,e){console.log("- %s listeners for %s: ",t.length,e,t)})}},i.initClass(r),e.exports=r},{"./oo":342,"./warn":345,"lodash/forEach":204,"lodash/isObject":219}],336:[function(t,e,n){"use strict";function r(){}function i(){}var o=t("lodash/isString"),s=t("lodash/isArray"),a=t("lodash/get"),c=t("lodash/setWith"),u=t("./oo"),h=t("./deleteFromArray");i.Prototype=function(){this.get=function(t){return arguments.length>1&&(t=Array.prototype.slice(arguments,0)),o(t)&&(t=[t]),a(this,t)},this.getAll=function(t){if(arguments.length>1&&(t=Array.prototype.slice(arguments,0)),o(t)&&(t=[t]),!s(t))throw new Error("Illegal argument for TreeIndex.get()");var e=a(this,t);return this._collectValues(e)},this.set=function(t,e){o(t)&&(t=[t]),c(this,t,e,function(t){if(!t)return new r})},this.delete=function(t){if(o(t))delete this[t];else if(1===t.length)delete this[t[0]];else{var e=t[t.length-1];t=t.slice(0,-1);var n=a(this,t);n&&delete n[e]}},this.clear=function(){var t=this;for(var e in t)t.hasOwnProperty(e)&&delete t[e]},this.traverse=function(t){this._traverse(this,[],t)},this.forEach=this.traverse,this._traverse=function(t,e,n){var i;for(i in t)if(t.hasOwnProperty(i)){var o=t[i],s=e.concat([i]);o instanceof r?this._traverse(o,s,n):n(o,s)}},this._collectValues=function(t){var e={};return this._traverse(t,[],function(t,n){var r=n[n.length-1];e[r]=t}),e}},u.initClass(i),i.Arrays=function(){},i.Arrays.Prototype=function(){var t=Object.getPrototypeOf(this);this.get=function(e){var n=t.get.call(this,e);return n instanceof r&&(n=n.__values__||[]),n},this.set=function(){throw new Error("TreeIndex.set() is not supported for array type.")},this.add=function(t,e){if(o(t)&&(t=[t]),!s(t))throw new Error("Illegal arguments.");var n;c(this,t.concat(["__values__","__dummy__"]),void 0,function(t,e){return"__values__"===e?(t||(t=[]),n=t):t||(t=new r),t}),delete n.__dummy__,n.push(e)},this.remove=function(t,e){var n=a(this,t);n instanceof r&&h(n.__values__,e)},this._collectValues=function(t){var e=[];return this._traverse(t,[],function(t){e.push(t)}),e=Array.prototype.concat.apply([],e)}},i.extend(i.Arrays),e.exports=i},{"./deleteFromArray":339,"./oo":342,"lodash/get":205,"lodash/isArray":209,"lodash/isString":221,"lodash/setWith":233}],337:[function(t,e,n){"use strict";function r(t){var e={};return t.root&&t.root.options&&(e=t.root.options),i({attribs:{},children:[],parent:null,root:null,options:e,next:null,prev:null},t)}var i=t("lodash/extend"),o=null;if(!o){var s=t("cheerio");if(s.prototype){s.prototype.prop=s.prototype.attr,s.prototype.removeProp=s.prototype.removeAttr,s.prototype.on=function(){},s.prototype.off=function(){},o=s.load("",{decodeEntities:!1}),o._createElement=function(t,e){return r({type:"tag",name:t,root:e})},o._createTextNode=function(t,e){return r({type:"text",data:t,root:e})};var a=function(t,e){var n=o.load(t,e),r=n.root()[0];return r.options||(r.options=e),r.children.slice()};o.parseHTML=function(t){return a(t,{xmlMode:!1})},o.parseXML=function(t){return a(t,{xmlMode:!0})},o._serialize=function(e){var n=t("dom-serializer"),r=e.options||e.root&&e.root.options;return n(e,r)}}}e.exports=o},{cheerio:1,"dom-serializer":1,"lodash/extend":200}],338:[function(t,e,n){"use strict";e.exports=function(t){var e=t._getSurfaceParent();return e?e.getId()+"/"+t.name:t.name}},{}],339:[function(t,e,n){"use strict";function r(t,e){for(var n=0;n<t.length;n++)t[n]===e&&(t.splice(n,1),n--)}e.exports=r},{}],340:[function(t,e,n){"use strict";var r="undefined"!=typeof window&&!window.process;e.exports=r},{}],341:[function(t,e,n){e.exports={UNDEFINED:0,BACKSPACE:8,DELETE:46,LEFT:37,RIGHT:39,UP:38,DOWN:40,ENTER:13,END:35,HOME:36,TAB:9,PAGEUP:33,PAGEDOWN:34,ESCAPE:27,SHIFT:16,SPACE:32}},{}],342:[function(t,e,n){"use strict";function r(t){if(!t.__is_initialized__){!t.Prototype||t.prototype instanceof t.Prototype||(t.prototype=new t.Prototype,t.prototype.constructor=t);var e=u();t.static=t.static||new e(t),t.__is_initialized__=!0}}function i(t,e){if(t.prototype instanceof e)throw new Error("Target already inherits from origin");var n=t.Prototype;t.super=e,n?(n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),t.prototype=new n,t.prototype.constructor=t):t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}});var r=u();e.static&&(r.prototype=e.static),t.static=new r(t),t.static._makeExtendFunction?t.extend=t.static._makeExtendFunction(t):c(t)}function o(t){var e=t.prototype;for(var n in e)"constructor"!==n&&"__class__"!==n&&e.hasOwnProperty(n)&&("static"!==n||h(t.static,e.static))}function s(t){function e(){t.apply(this,arguments),this.initialize&&this.initialize()}var n,r=Array.prototype.slice.call(arguments,1),o=[],s=0;for(f(r[0])?(n=r[0],s++):n=e;s<r.length;s++){if(f(r[s])){if(s!==r.length-1)throw new Error("Illegal use of Class.extend(): Prototype function must be last argument.");if(n.hasOwnProperty("Prototype"))throw new Error("Class "+n.name+" has defined "+n.name+".Prototype which would be overwritten by Class.extend().\nYou provided a prototype function when calling Class.extend().");n.Prototype=r[s];break}if(!l(r[s]))throw new Error("Illegal use of Class.extend");o.push(r[s])}i(n,t);for(var c=o.length-1;c>=0;c--)a(n,o[c]);return n}function a(t,e){var n=t.prototype;for(var r in e)if(e.hasOwnProperty(r)){if("static"===r){h(t.static,e.static);continue}n.hasOwnProperty(r)||(n[r]=e[r])}}function c(t){t.static||d.initClass(t),t.static._makeExtendFunction=function(e){return s.bind(t,e)},t.extend=t.static._makeExtendFunction(t)}function u(){return function(t){this.__class__=t}}function h(t,e){for(var n in e)"constructor"!==n&&"__class__"!==n&&e.hasOwnProperty(n)&&!t.hasOwnProperty(n)&&(t[n]=e[n])}var l=t("lodash/isObject"),f=t("lodash/isFunction"),d={};d.initClass=function(t){r(t),c(t)},d.inherit=function(t,e){t.__is_initialized__||d.initClass(t),i(t,e),o(t)},d.mixin=function(t,e){t.__is_initialized__||d.initClass(t),a(t,e)},d.makeExtensible=c,e.exports=d},{"lodash/isFunction":215,"lodash/isObject":219}],343:[function(t,e,n){(function(n){"use strict";var r=t("./warn"),i={};n.hasOwnProperty("Substance")?(r("global.Substance is already defined."),i=n.Substance):n.Substance=i,e.exports=i}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./warn":345}],344:[function(t,e,n){"use strict";function r(t,e){t&&"-"!==t[t.length-1]&&(t=t.concat("-"));var n,r="0123456789abcdefghijklmnopqrstuvwxyz".split(""),i=[],o=16;if(e=e||32)for(n=0;n<e;n++)i[n]=r[0|Math.random()*o];else{var s;for(i[8]=i[13]=i[18]=i[23]="-",i[14]="4",n=0;n<36;n++)i[n]||(s=0|16*Math.random(),i[n]=r[19===n?3&s|8:s])}return(t?t:"")+i.join("")}e.exports=r},{}],345:[function(t,e,n){"use strict";e.exports=function(){console.warn.apply(console,arguments)}},{}],346:[function(t,e,n){"use strict";var r=t("substance/packages/prose-editor/ProseEditorPackage"),i=t("substance/packages/image/ImagePackage");e.exports={name:"image-example",configure:function(t){t.import(r),t.import(i)}}},{"substance/packages/image/ImagePackage":276,"substance/packages/prose-editor/ProseEditorPackage":297}]},{},[346]);